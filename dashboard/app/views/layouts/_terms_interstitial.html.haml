#terms-modal.modal{'data-backdrop' => 'static', 'data-keyboard' => 'false', style: 'display: none;'}
  .modal-dialog
    .modal-content.no-modal-icon{style: 'margin: 0 20px; padding: 0 15px;'}
      %h2.custom-h2= t('terms_interstitial.title')

      .right{style: 'float: right'}
        %iframe#print-frame{src: '/terms-and-privacy', style: 'display: none'}
        %a#print-terms{href: "#"}
          %i.fa.fa-print.right-margin-5
          = t('terms_interstitial.print')
      .clear
      .scroll-box
        = t('terms_interstitial.intro_desc').html_safe
        %br
        %br
        = t('terms_interstitial.intro_instructions')
        %h1.custom-h1= t('terms_interstitial.tos')
        = render partial: 'home/tos'
        %hr
        %h1= t('terms_interstitial.privacy')
        = render partial: 'home/privacy'

      %br
      .left
        = form_for(current_user, url: registration_url('user'), html: {id: 'edit_user'}) do |f|
          .form-group
            = f.label :terms_of_service_version do
              = f.check_box :terms_of_service_version, {class: 'terms-checkbox'}, current_user.latest_terms_version
              = t('terms_interstitial.accept_label', tos_url: CDO.code_org_url('/tos'), privacy_url: CDO.code_org_url('/privacy')).html_safe
          .form-group{style: 'margin-top: 10px;'}
            = f.submit t('terms_interstitial.accept'), id: 'accept-terms-submit', class: 'btn primary-button disabled-button', disabled: true
      .right
        %a#later-link.dismiss-link{href: '#'}= t('terms_interstitial.later')
      .clear

:javascript
  $(document).ready(function() {
    $("#user_terms_of_service_version").on('change', function(event) {
      if ($(this).is(':checked')) {
        $("#accept-terms-submit").prop('disabled', false).removeClass("disabled-button");
      } else {
        $("#accept-terms-submit").prop('disabled', true).addClass("disabled-button");
      }
    });

    $( "#edit_user" ).submit(function( event ) {
      event.preventDefault();
      $.ajax({
        type: 'POST',
        url: $(this).attr('action'),
        data: $(this).serialize(),
        dataType: 'json',
        success: function(data) {$("#terms-modal").modal('hide'); location.reload();}
      });
    });

    $('#later-link').click(function () {
      $("#terms-modal").modal('hide');
    });
  });

  $(document).ready(function () {
    var printLink = $('#print-terms');
    if (printLink) {
      printLink.click(function () {
        var item = $("#print-frame")[0];
        item.contentWindow.print();
      });
    }
  });

  function setCookie(key, value) {
    var expires = new Date();
    expires.setHours(23,59,59,0);
    document.cookie = key + '=' + value + ';expires=' + expires.toUTCString();
  }

  function getCookie(key) {
    var keyValue = document.cookie.match('(^|;) ?' + key + '=([^;]*)(;|$)');
    return keyValue ? keyValue[2] : null;
  }

  $( document ).ready(function() {
    already_shown = !!getCookie('_tos');
    if(!already_shown) {
      $("#terms-modal").modal('show');
      setCookie('_tos', '1');
    }
  });
