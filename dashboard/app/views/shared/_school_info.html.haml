- require 'country_codes'
- require 'state_abbr'

- content_for(:head) do
  %script{src: minifiable_asset_path('js/schoolInfo.js')}

#pl-application-form
  #pl-application-facets.form-section
    .form-group
      .question School Country
      %select#school-country.form-control{name: "#{form_name}[country]", type: "select", required: false}
        %option{value: "", selected: true, disabled: true}
        - COUNTRY_CODE_TO_COUNTRY_NAME.keys.each do |code|
          %option{value: code}= country_name_from_code(code)

    .form-group
      .question Select school type
      %select#school-type.form-control{name: "#{form_name}[school_type]", type: "select", required: false}
        %option{value: "", selected: true, disabled: true}
        %option{value: SchoolInfo::SCHOOL_TYPE_CHARTER} Charter
        %option{value: SchoolInfo::SCHOOL_TYPE_PRIVATE} Private
        %option{value: SchoolInfo::SCHOOL_TYPE_PUBLIC} Public
        %option{value: SchoolInfo::SCHOOL_TYPE_OTHER} Other

    .form-group{style: "display: none;"}
      .question Schoolâ€™s ZIP code
      %input#school-zipcode.form-control{name: "#{form_name}[school_zip]", type: "text", required: false}

    .form-group{style: "display: none;"}
      .question State
      %select#school-state.form-control{name: "#{form_name}[school_state]", type: "select", required: false}
        %option{value: "", selected: true, disabled: true}
        - get_all_states_with_dc.each do |state_abbr, state_name|
          %option{value: state_abbr}= state_name

    .form-group{style: "display: none;"}
      .question District
      #school-district

        -# We'll apply the Selectize UI control to this input.
        %input#school-district-id.form-control{name: "school_district_id_source", type: "text", required: false}

        -# This is the input we'll actually submit as part of the form.  We'll copy the Selectized value into
        -# here whenever it's changed.  Sometimes we'll override this with code, say 0 for "unknown district".
        -# Selectize was showing this 0 as a character when it was disabled, hence giving Selectize its own
        -# input to work with above.
        %input#school-district-id-form.form-control{name: "#{form_name}[school_district_id]", type: "hidden", required: false}

        %label
          %input#school-district-other{name: "#{form_name}[school_district_other]", type: "checkbox", value: "true", style: "margin-top: 0px"}
          %span{style: "font-size: 12px"}
            Other district not listed above

        .form-group{style: "display: none;"}
          .question District Name
          %div.controls
            %input#school-district-name.form-control{name: "school_info[school_district_name]", type: "text", required: false, style: "width: calc(100% - 15px);"}

    .form-group{style: "display: none;"}
      .question School
      #school

        -# We'll apply the Selectize UI control to this input.
        %input#school-id.form-control{name: "school_id_source", type: "text", required: false}

        -# This is the input we'll actually submit as part of the form.  We'll copy the Selectized value into
        -# here whenever it's changed.  Sometimes we'll override this with code, say 0 for "unknown school".
        -# Selectize was showing this 0 as a character when it was disabled, hence giving Selectize its own
        -# input to work with above.
        %input#school-id-form.form-control{name: "#{form_name}[school_id]", type: "hidden", required: false}

        %label
          %input#school-other{name: "#{form_name}[school_other]", type: "checkbox", value: "true", style: "margin-top: 0px"}
          %span{style: "font-size: 12px"}
            Other school not listed above

    -# '#school-name' is outside of '#school' so that we can still show it when the school dropdown is hidden.
    .form-group{style: "display: none;"}
      %label
        School Name
      %div.controls
        %input#school-name.form-control{name: "school_info[school_name]", type: "text", required: false, style: "width: calc(100% - 15px);"}

    .form-group{style: "display: none;"}
      %label
        School Address
      %div.controls
        %textarea#school-address.form-control{name: "school_info[full_address]", required: false, rows: 4, style: "width: calc(100% - 15px);"}

:javascript

  $(document).ready(function() {
    var options = #{existing_school_info.to_json};

    // Send through some values that the JavaScript will need.
    window.schoolInfoManager = new SchoolInfoManager(options);
  });
