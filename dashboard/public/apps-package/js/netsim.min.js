require=function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};b[g][0].call(k.exports,function(a){var c=b[g][1][a];return e(c?c:a)},k,k.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({182:[function(a){var b=a("../appMain"),c=a("../StudioApp").singleton,d=a("./netsim"),e=a("./levels"),f=a("./skins");window.netsimMain=function(a){a.skinsModule=f,a.isEditorless=!0;var g=new d;g.injectStudioApp(c),b(g,e,a)}},{"../StudioApp":4,"../appMain":5,"./levels":181,"./netsim":183,"./skins":188}],188:[function(a,b,c){var d=a("../skins");c.load=function(a,b){var c=d.load(a,b);return c}},{"../skins":192}],183:[function(a,b){"use strict";var c=a("./page.html"),d=a("../../locale/current/netsim"),e=a("./netsimUtils"),f=a("./netsimConstants").DnsMode,g=a("./NetSimConnection"),h=a("./DashboardUser"),i=a("./NetSimLobby"),j=a("./NetSimTabsComponent"),k=a("./NetSimSendPanel"),l=a("./NetSimLogPanel"),m=a("./NetSimStatusPanel"),n=a("./NetSimVisualization"),o=a("../RunLoop"),p=b.exports=function(){this.skin=null,this.level={},this.heading=0,this.currentUser_=h.getCurrentUser(),this.connection_=null,this.myConnectedRouter_=null,this.runLoop_=new o,this.chunkSize_=8,this.routerBandwidth_=1/0,this.dnsMode_=f.NONE};p.prototype.injectStudioApp=function(a){this.studioApp_=a},p.prototype.init=function(b){if(!this.studioApp_)throw new Error("NetSim requires a StudioApp");this.skin=b.skin,this.level=e.scrubLevelConfiguration_(b.level),b.html=c({assetUrl:this.studioApp_.assetUrl,data:{visualization:"",localeDirection:this.studioApp_.localeDirection(),controls:a("./controls.html")({assetUrl:this.studioApp_.assetUrl})},hideRunButton:!0}),b.enableShowCode=!1,b.loadAudio=this.loadAudio_.bind(this),this.studioApp_.configureDom=this.configureDomOverride_.bind(this.studioApp_),this.studioApp_.onResize=this.onResizeOverride_.bind(this.studioApp_),this.studioApp_.init(b),this.currentUser_.whenReady(function(){this.initWithUserName_(this.currentUser_)}.bind(this)),this.runLoop_.begin()},p.prototype.getOverrideShardID=function(){var a=location.search.split("?");if(1===a.length)return void 0;var b;return a[1].split("&").forEach(function(a){var c=a.split("=");c.length>1&&"s"===c[0]&&(b=c[1])}),b},p.prototype.shouldEnableCleanup=function(){return!location.search.match(/disableCleaning/i)},p.prototype.shouldShowAnyTabs=function(){return this.level.showTabs.length>0},p.prototype.initWithUserName_=function(a){this.mainContainer_=$("#netsim"),this.receivedMessageLog_=new l($("#netsim_received"),{logTitle:d.receivedMessageLog(),isMinimized:!1,packetSpec:this.level.clientInitialPacketHeader}),this.sentMessageLog_=new l($("#netsim_sent"),{logTitle:d.sentMessageLog(),isMinimized:!0,packetSpec:this.level.clientInitialPacketHeader}),this.connection_=new g({window:window,levelConfig:this.level,sentLog:this.sentMessageLog_,receivedLog:this.receivedMessageLog_,enableCleanup:this.shouldEnableCleanup()}),this.connection_.attachToRunLoop(this.runLoop_),this.connection_.statusChanges.register(this.refresh_.bind(this)),this.connection_.shardChange.register(this.onShardChange_.bind(this)),this.statusPanel_=new m($("#netsim_status"),this.connection_.disconnectFromRouter.bind(this.connection_)),this.visualization_=new n($("svg"),this.runLoop_,this.connection_);var b=document.getElementById("netsim_lobby_container");this.lobbyControl_=i.createWithin(b,this.level,this.connection_,a,this.getOverrideShardID()),this.shouldShowAnyTabs()&&(this.tabs_=new j($("#netsim_tabs"),this.level,{chunkSizeChangeCallback:this.setChunkSize.bind(this),encodingChangeCallback:this.changeEncodings.bind(this),routerBandwidthChangeCallback:this.changeRemoteRouterBandwidth.bind(this),dnsModeChangeCallback:this.changeRemoteDnsMode.bind(this),becomeDnsCallback:this.becomeDnsNode.bind(this)})),this.sendWidget_=new k($("#netsim_send"),this.level,this.connection_),this.changeEncodings(this.level.defaultEnabledEncodings),this.setChunkSize(this.chunkSize_),this.setRouterBandwidth(this.level.defaultRouterBandwidth),this.setDnsMode(this.level.defaultDnsMode),this.refresh_()},p.prototype.refresh_=function(){this.connection_.isConnectedToRouter()?(this.mainContainer_.find(".leftcol_disconnected").hide(),this.mainContainer_.find(".leftcol_connected").show()):(this.mainContainer_.find(".leftcol_disconnected").show(),this.mainContainer_.find(".leftcol_connected").hide()),this.render()},p.prototype.changeEncodings=function(a){this.tabs_&&this.tabs_.setEncodings(a),this.receivedMessageLog_.setEncodings(a),this.sentMessageLog_.setEncodings(a),this.sendWidget_.setEncodings(a)},p.prototype.setChunkSize=function(a){this.chunkSize_=a,this.tabs_&&this.tabs_.setChunkSize(a),this.receivedMessageLog_.setChunkSize(a),this.sentMessageLog_.setChunkSize(a),this.sendWidget_.setChunkSize(a)},p.prototype.setRouterBandwidth=function(a){this.routerBandwidth_=a,this.tabs_&&this.tabs_.setRouterBandwidth(a)},p.prototype.changeRemoteRouterBandwidth=function(a){this.setRouterBandwidth(a),this.myConnectedRouter_&&this.myConnectedRouter_.setBandwidth(a)},p.prototype.setDnsMode=function(a){this.dnsMode_=a,this.tabs_&&this.tabs_.setDnsMode(a),this.visualization_.setDnsMode(a)},p.prototype.changeRemoteDnsMode=function(a){this.setDnsMode(a),this.myConnectedRouter_&&this.myConnectedRouter_.setDnsMode(a)},p.prototype.setIsDnsNode=function(a){this.tabs_&&this.tabs_.setIsDnsNode(a),this.myConnectedRouter_&&this.setDnsTableContents(this.myConnectedRouter_.getAddressTable())},p.prototype.setDnsNodeID=function(a){this.visualization_.setDnsNodeID(a)},p.prototype.becomeDnsNode=function(){if(this.setIsDnsNode(!0),this.connection_&&this.connection_.myNode&&this.connection_.myNode.myRouter){var a=this.connection_.myNode,b=a.myRouter;b.dnsNodeID=a.entityID,b.update()}},p.prototype.setDnsTableContents=function(a){this.tabs_&&this.tabs_.setDnsTableContents(a)},p.prototype.setRouterLogData=function(a){this.tabs_&&this.tabs_.setRouterLogData(a)},p.prototype.loadAudio_=function(){},p.prototype.configureDomOverride_=function(a){var b=document.getElementById(a.containerId);b.innerHTML=a.html},p.prototype.onResizeOverride_=function(){var a=document.getElementById("appcontainer"),b=a.parentNode,c=window.getComputedStyle(b),d=parseInt(c.width,10);a.style.top=b.offsetTop+"px",a.style.width=d+"px"},p.prototype.render=function(){var a,b,c,e,f,g;a=!1,b=d.disconnected(),this.connection_&&this.connection_.myNode&&(b="In Lobby",c=this.connection_.myNode.getHostname(),this.connection_.myNode.myWire&&(e=this.connection_.myNode.myWire.localAddress)),this.myConnectedRouter_&&(a=!0,b=d.connected(),f=this.myConnectedRouter_.getDisplayName()),this.statusPanel_&&this.statusPanel_.render({isConnected:a,statusString:b,myHostname:c,myAddress:e,remoteNodeName:f,shareLink:g})},p.prototype.onShardChange_=function(a,b){b&&b.routerChange.register(this.onRouterChange_.bind(this)),this.render()},p.prototype.onRouterChange_=function(a,b){void 0!==this.routerStateChangeKey&&(this.myConnectedRouter_.stateChange.unregister(this.routerStateChangeKey),this.routerStateChangeKey=void 0),void 0!==this.routerWireChangeKey&&(this.myConnectedRouter_.wiresChange.unregister(this.routerWireChangeKey),this.routerWireChangeKey=void 0),void 0!==this.routerLogChangeKey&&(this.myConnectedRouter_.logChange.unregister(this.routerLogChangeKey),this.routerLogChangeKey=void 0),this.myConnectedRouter_=b,this.render(),b&&(this.onRouterStateChange_(b),this.routerStateChangeKey=b.stateChange.register(this.onRouterStateChange_.bind(this)),this.routerWireChangeKey=b.wiresChange.register(this.onRouterWiresChange_.bind(this)),this.routerLogChangeKey=b.logChange.register(this.onRouterLogChange_.bind(this)))},p.prototype.onRouterStateChange_=function(a){var b={};this.connection_&&this.connection_.myNode&&(b=this.connection_.myNode),this.setRouterBandwidth(a.bandwidth),this.setDnsMode(a.dnsMode),this.setDnsNodeID(a.dnsMode===f.NONE?void 0:a.dnsNodeID),this.setIsDnsNode(a.dnsMode===f.MANUAL&&a.dnsNodeID===b.entityID)},p.prototype.onRouterWiresChange_=function(){this.myConnectedRouter_&&this.setDnsTableContents(this.myConnectedRouter_.getAddressTable())},p.prototype.onRouterLogChange_=function(){this.myConnectedRouter_&&this.setRouterLogData(this.myConnectedRouter_.getLog())}},{"../../locale/current/netsim":248,"../RunLoop":3,"./DashboardUser":122,"./NetSimConnection":128,"./NetSimLobby":142,"./NetSimLogPanel":147,"./NetSimSendPanel":165,"./NetSimStatusPanel":169,"./NetSimTabsComponent":172,"./NetSimVisualization":173,"./controls.html":179,"./netsimConstants":184,"./netsimUtils":186,"./page.html":187}],187:[function(require,module,exports){module.exports=function(){var t=function anonymous(locals,filters,escape){escape=escape||function(a){return String(a).replace(/&(?!\w+;)/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")};var buf=[];with(locals||{})!function(){buf.push("");var a=require("../../locale/current/common");buf.push('\n\n<div id="rotateContainer" style="background-image: url(',escape(assetUrl("media/mobile_tutorial_turnphone.png")),')">\n  <div id="rotateText">\n    <p>',escape(a.rotateText()),"<br>",escape(a.orientationLock()),"</p>\n  </div>\n</div>\n\n");var b=function(){buf.push('  <div id="bubble" class="clearfix">\n    <table id="prompt-table">\n      <tr>\n        <td id="prompt-icon-cell">\n          <img id="prompt-icon"/>\n        </td>\n        <td id="prompt-cell">\n          <p id="prompt">\n          </p>\n        </td>\n      </tr>\n    </table>\n    <div id="ani-gif-preview-wrapper">\n      <div id="ani-gif-preview">\n        <img id="play-button" src="',escape(assetUrl("media/play-circle.png")),'"/>\n      </div>\n    </div>\n  </div>\n')};buf.push('\n<div id="appcontainer">\n  <!-- Should disable spell-check on all netsim elements -->\n  <div id="netsim"  autocapitalize="false" autocorrect="false" autocomplete="false" spellcheck="false">\n    <div id="netsim_rightcol">\n      <div id="netsim_status"></div>\n      <div id="netsim_vizualization">\n        <svg version="1.1" width="300" height="300" xmlns="http://www.w3.org/2000/svg">\n\n          <filter id="backgroundBlur">\n            <feGaussianBlur in="SourceGraphic" stdDeviation="5" />\n            <feComponentTransfer>\n              <feFuncA slope="0.5" type="linear"></feFuncA>\n            </feComponentTransfer>\n          </filter>\n\n          <g id="centered_group" transform="translate(150,150)">\n            <g id="background_group" filter="url(#backgroundBlur)"></g>\n            <g id="foreground_group"></g>\n          </g>\n        </svg>\n      </div>\n      <div id="netsim_tabs"></div>\n    </div>\n    <div id="netsim_leftcol">\n      <div class="leftcol_disconnected">\n        <div id="netsim_lobby_container"></div>\n      </div>\n      <div class="leftcol_connected">\n        <div id="netsim_received"></div>\n        <div id="netsim_sent"></div>\n        <div id="netsim_send"></div>\n      </div>\n    </div>\n  </div>\n  <div id="footers" dir="',escape(data.localeDirection),'">\n    '),b(),buf.push('\n  </div>\n</div>\n\n<div class="clear"></div>\n')}();return buf.join("")};return function(a){return t(a,require("ejs").filters)}}()},{"../../locale/current/common":243,ejs:259}],181:[function(a,b){var c=(a("../../locale/current/netsim"),a("../utils")),d=a("./netsimConstants"),e=a("./Packet"),f=d.BITS_PER_NIBBLE,g=d.DnsMode,h=d.EncodingType,i=d.NetSimTabType,j=b.exports={};j["default"]={showClientsInLobby:!0,showRoutersInLobby:!0,showAddRouterButton:!0,routerExpectsPacketHeader:[{key:e.HeaderType.TO_ADDRESS,bits:f},{key:e.HeaderType.FROM_ADDRESS,bits:f},{key:e.HeaderType.PACKET_INDEX,bits:f},{key:e.HeaderType.PACKET_COUNT,bits:f}],clientInitialPacketHeader:[{key:e.HeaderType.TO_ADDRESS,bits:f},{key:e.HeaderType.FROM_ADDRESS,bits:f},{key:e.HeaderType.PACKET_INDEX,bits:f},{key:e.HeaderType.PACKET_COUNT,bits:f}],showAddPacketButton:!0,showPacketSizeControl:!0,defaultPacketSizeLimit:1/0,showTabs:[i.INSTRUCTIONS,i.MY_DEVICE,i.ROUTER,i.DNS],defaultTabIndex:0,showEncodingControls:[h.BINARY,h.A_AND_B,h.HEXADECIMAL,h.DECIMAL,h.ASCII],defaultEnabledEncodings:[h.ASCII,h.BINARY],showRouterBandwidthControl:!0,defaultRouterBandwidth:1/0,showDnsModeControl:!0,defaultDnsMode:g.NONE},j.variant1=c.extend(j["default"],{showAddRouterButton:!1,clientInitialPacketHeader:[],showAddPacketButton:!1,showPacketSizeControl:!1,showTabs:[i.INSTRUCTIONS],defaultEnabledEncodings:[h.A_AND_B]}),j.variant2=c.extend(j["default"],{showAddRouterButton:!1,clientInitialPacketHeader:[],showAddPacketButton:!1,showPacketSizeControl:!1,showTabs:[i.INSTRUCTIONS,i.MY_DEVICE],showEncodingControls:[h.ASCII],defaultEnabledEncodings:[h.BINARY,h.ASCII]}),j.variant3=c.extend(j["default"],{showClientsInLobby:!1,showAddRouterButton:!0,showAddPacketButton:!0,showPacketSizeControl:!0,defaultPacketSizeLimit:1/0,showTabs:[i.INSTRUCTIONS,i.MY_DEVICE,i.ROUTER,i.DNS],showEncodingControls:[h.ASCII],defaultEnabledEncodings:[h.BINARY,h.ASCII],showDnsModeControl:!1,defaultDnsMode:g.AUTOMATIC})},{"../../locale/current/netsim":248,"../utils":238,"./Packet":178,"./netsimConstants":184}],179:[function(require,module,exports){module.exports=function(){var t=function anonymous(locals,filters,escape){escape=escape||function(a){return String(a).replace(/&(?!\w+;)/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")};var buf=[];with(locals||{})!function(){buf.push('<div id="slider-cell">\n  <img id="spinner" style="visibility: hidden;" src="',escape(assetUrl("media/turtle/loading.gif")),'" height=15 width=15>\n</div>\n')}();return buf.join("")};return function(a){return t(a,require("ejs").filters)}}()},{ejs:259}],173:[function(a,b){"use strict";var c=a("../utils"),d=c.getLodash(),e=a("./netsimNodeFactory"),f=a("./NetSimWire"),g=a("./NetSimVizNode"),h=a("./NetSimVizWire"),i=a("./tweens"),j=b.exports=function(a,b,c){this.svgRoot_=a,this.shard_=null,c.shardChange.register(this.onShardChange_.bind(this)),this.entities_=[],this.visualizationWidth=300,this.visualizationHeight=300,this.nodeTableChangeKey=void 0,this.wireTableChangeKey=void 0,b.tick.register(this.tick.bind(this)),b.render.register(this.render.bind(this))};j.prototype.tick=function(a){this.entities_.forEach(function(b){b.tick(a)}),this.entities_=this.entities_.filter(function(a){return a.isDead()?(a.getRoot().remove(),!1):!0})},j.prototype.render=function(){this.entities_.forEach(function(a){a.render()})},j.prototype.onShardChange_=function(a,b){this.setShard(a),this.setLocalNode(b)},j.prototype.setShard=function(a){void 0!==this.nodeTableChangeKey&&(this.shard_.nodeTable.tableChange.unregister(this.nodeTableChangeKey),this.nodeTableChangeKey=void 0),void 0!==this.wireTableChangeKey&&(this.shard_.wireTable.tableChange.unregister(this.wireTableChangeKey),this.wireTableChangeKey=void 0),this.shard_=a,this.shard_&&(this.nodeTableChangeKey=this.shard_.nodeTable.tableChange.register(this.onNodeTableChange_.bind(this)),this.wireTableChangeKey=this.shard_.wireTable.tableChange.register(this.onWireTableChange_.bind(this)))},j.prototype.setLocalNode=function(a){a?(this.localNode?this.localNode.configureFrom(a):(this.localNode=new g(a),this.entities_.push(this.localNode),this.svgRoot_.find("#background_group").append(this.localNode.getRoot())),this.localNode.isLocalNode=!0):this.localNode.kill(),this.pullElementsToForeground()},j.prototype.getEntityByID=function(a,b){return d.find(this.entities_,function(c){return c instanceof a&&c.id===b})},j.prototype.getWiresAttachedToNode=function(a){return this.entities_.filter(function(b){return b instanceof h&&(b.localVizNode===a||b.remoteVizNode===a)})},j.prototype.onNodeTableChange_=function(a){var b=e.nodesFromRows(this.shard_,a);this.updateVizEntitiesOfType_(g,b,function(a){var b=new g(a);return b.snapToPosition(Math.random()*this.visualizationWidth-this.visualizationWidth/2,Math.random()*this.visualizationHeight-this.visualizationHeight/2),b}.bind(this))},j.prototype.onWireTableChange_=function(a){var b=a.map(function(a){return new f(this.shard_,a)}.bind(this));this.updateVizEntitiesOfType_(h,b,function(a){return new h(a,this.getEntityByID.bind(this))}.bind(this)),this.pullElementsToForeground(),this.distributeForegroundNodes()},j.prototype.updateVizEntitiesOfType_=function(a,b,c){this.killVizEntitiesOfTypeMissingMatch_(a,b),b.forEach(function(b){var d=this.getEntityByID(a,b.entityID);d?d.configureFrom(b):this.addVizEntity_(c(b))},this)},j.prototype.killVizEntitiesOfTypeMissingMatch_=function(a,b){this.entities_.forEach(function(c){var d=c instanceof a,e=b.some(function(a){return a.entityID===c.id});d&&!e&&c.kill()})},j.prototype.addVizEntity_=function(a){this.entities_.push(a),this.svgRoot_.find("#background_group").prepend(a.getRoot())};var k=function(a,b){a.getRoot().detach(),a instanceof h?a.getRoot().prependTo(b):a.getRoot().appendTo(b)};j.prototype.pullElementsToForeground=function(){this.entities_.forEach(function(a){a.visited=!1});var a=[];this.localNode&&a.push(this.localNode);for(var b;a.length>0;)b=a.pop(),b.visited=!0,a=a.concat(this.getUnvisitedNeighborsOf_(b));var c=this.svgRoot_.find("#foreground_group"),d=this.svgRoot_.find("#background_group");this.entities_.forEach(function(a){var b=$.contains(c[0],a.getRoot()[0]);a.visited&&!b?(k(a,c),a.onDepthChange(!0)):!a.visited&&b&&(k(a,d),a.onDepthChange(!1))},this)},j.prototype.getUnvisitedNeighborsOf_=function(a){var b=[];return a instanceof g?b=this.getWiresAttachedToNode(a):a instanceof h&&(a.localVizNode&&b.push(a.localVizNode),a.remoteVizNode&&b.push(a.remoteVizNode)),b.filter(function(a){return!a.visited})},j.prototype.distributeForegroundNodes=function(){var a=this.entities_.filter(function(a){return a instanceof g&&a.isForeground});if(0!==a.length){if(1===a.length)return void a[0].tweenToPosition(0,0,600,i.easeOutQuad);var b;if(2===a.length){b=this.localNode;var c=d.find(a,function(a){return a!==b});return b.tweenToPosition(-75,0,400,i.easeOutQuad),void c.tweenToPosition(75,0,600,i.easeOutQuad)}b=this.localNode;var e=d.find(a,function(a){return a.isRouter}),f=a.filter(function(a){return a!==b&&a!==e});b.tweenToPosition(-100,0,400,i.easeOutQuad),e.tweenToPosition(0,0,500,i.easeOutQuad);for(var h=2*Math.PI/(f.length+1),j=0;j<f.length;j++){var k=100,l=Math.PI+(j+1)*h,m=Math.cos(l)*k,n=Math.sin(l)*k;f[j].tweenToPosition(m,n,600,i.easeOutQuad)}}},j.prototype.setDnsMode=function(a){this.entities_.forEach(function(b){b instanceof g&&b.setDnsMode(a)})},j.prototype.setDnsNodeID=function(a){this.entities_.forEach(function(b){b instanceof g&&b.setIsDnsNode(b.id===a)})}},{"../utils":238,"./NetSimVizNode":175,"./NetSimVizWire":176,"./NetSimWire":177,"./netsimNodeFactory":185,"./tweens":189}],176:[function(a,b){"use strict";a("../utils");var c=a("./netsimUtils").jQuerySvgElement,d=a("./NetSimVizEntity"),e=a("./NetSimVizNode"),f=b.exports=function(a,b){d.call(this,a);var e=this.getRoot();e.addClass("viz-wire"),this.line_=c("path").appendTo(e),this.getEntityByID_=b,this.localVizNode=null,this.remoteVizNode=null,this.configureFrom(a),this.render()};f.inherits(d),f.prototype.configureFrom=function(a){this.localVizNode=this.getEntityByID_(e,a.localNodeID),this.remoteVizNode=this.getEntityByID_(e,a.remoteNodeID),this.localVizNode&&this.localVizNode.setAddress(a.localAddress),this.remoteVizNode&&this.remoteVizNode.setAddress(a.remoteAddress)},f.prototype.render=function(){f.superPrototype.render.call(this);var a="M 0 0";this.localVizNode&&this.remoteVizNode&&(a="M "+this.localVizNode.posX+" "+this.localVizNode.posY+" L "+this.remoteVizNode.posX+" "+this.remoteVizNode.posY),this.line_.attr("d",a)},f.prototype.kill=function(){f.superPrototype.kill.call(this),this.localVizNode=null,this.remoteVizNode=null}},{"../utils":238,"./NetSimVizEntity":174,"./NetSimVizNode":175,"./netsimUtils":186}],175:[function(a,b){"use strict";a("../utils");var c=a("./netsimConstants"),d=a("./netsimUtils").jQuerySvgElement,e=a("./NetSimVizEntity"),f=a("./tweens"),g=c.DnsMode,h=c.NodeType,i=b.exports=function(a){e.call(this,a),this.address_=void 0,this.dnsMode_=void 0,this.nodeID=void 0,this.isRouter=!1,this.isLocalNode=!1,this.isDnsNode=!1;var b=this.getRoot();b.addClass("viz-node");var c=37,g=4;d("circle").attr("cx",0).attr("cy",0).attr("r",c).appendTo(b),this.displayName_=d("text").attr("x",0).attr("y",g).appendTo(b),this.addressGroup_=d("g").attr("transform","translate(0,30)").hide().appendTo(b);var h=15,i=12;d("rect").addClass("address-box").attr("x",-h).attr("y",-i).attr("rx",5).attr("ry",10).attr("width",2*h).attr("height",2*i).appendTo(this.addressGroup_),this.addressText_=d("text").addClass("address-box").attr("x",0).attr("y",g).text("?").appendTo(this.addressGroup_),this.snapToScale(0),this.tweenToScale(.5,800,f.easeOutElastic),this.configureFrom(a),this.render()};i.inherits(e),i.prototype.configureFrom=function(a){this.displayName_.text(a.getDisplayName()),this.nodeID=a.entityID,a.getNodeType()===h.ROUTER&&(this.isRouter=!0,this.getRoot().addClass("router-node"))},i.prototype.kill=function(){i.superPrototype.kill.call(this),this.stopAllAnimation(),this.tweenToScale(0,200,f.easeInQuad)},i.prototype.tick=function(a){if(i.superPrototype.tick.call(this,a),!this.isForeground&&0===this.tweens_.length){var b=300*Math.random()-150,c=300*Math.random()-150;this.tweenToPosition(b,c,2e4,f.easeInOutQuad)}},i.prototype.onDepthChange=function(a){i.superPrototype.onDepthChange.call(this,a),this.tweens_.length=0,a?this.tweenToScale(1,600,f.easeOutElastic):this.tweenToScale(.5,600,f.easeOutElastic)},i.prototype.setAddress=function(a){this.address_=a,this.updateAddressDisplay()},i.prototype.setDnsMode=function(a){this.dnsMode_=a,this.updateAddressDisplay()},i.prototype.setIsDnsNode=function(a){this.isDnsNode=a,this.updateAddressDisplay()},i.prototype.updateAddressDisplay=function(){return this.isRouter||void 0===this.dnsMode_?void this.addressGroup_.hide():(this.addressGroup_.show(),void this.addressText_.text(this.dnsMode_===g.NONE?void 0!==this.address_?this.address_:"?":this.isLocalNode||this.isDnsNode?this.address_:"?"))}},{"../utils":238,"./NetSimVizEntity":174,"./netsimConstants":184,"./netsimUtils":186,"./tweens":189}],174:[function(a,b){"use strict";var c=a("./netsimUtils").jQuerySvgElement,d=a("./tweens"),e=b.exports=function(a){this.id=a.entityID,this.posX=0,this.posY=0,this.scale=1,this.isForeground=!1,this.rootGroup_=c("g"),this.tweens_=[],this.isDead_=!1};e.prototype.getRoot=function(){return this.rootGroup_},e.prototype.kill=function(){this.id=void 0,this.isDead_=!0},e.prototype.isDead=function(){return this.isDead_&&0===this.tweens_.length},e.prototype.tick=function(a){this.tweens_.forEach(function(b){b.tick(a)}),this.tweens_=this.tweens_.filter(function(a){return!a.isFinished})},e.prototype.render=function(){var a="translate("+this.posX+" "+this.posY+") scale("+this.scale+")";this.rootGroup_.attr("transform",a)},e.prototype.onDepthChange=function(a){this.isForeground=a},e.prototype.stopAllAnimation=function(){this.tweens_.length=0},e.prototype.tweenToPosition=function(a,b,c,e){this.tweens_.filter(function(a){return a.target!==this||"posX"!==a.propertyName&&"posY"!==a.propertyName}),c>0?(this.tweens_.push(new d.TweenValueTo(this,"posX",a,c,e)),this.tweens_.push(new d.TweenValueTo(this,"posY",b,c,e))):(this.posX=a,this.posY=b)},e.prototype.snapToPosition=function(a,b){this.tweenToPosition(a,b,0)},e.prototype.tweenToScale=function(a,b,c){this.tweens_.filter(function(a){return a.target!==this||"scale"!==a.propertyName}),b>0?this.tweens_.push(new d.TweenValueTo(this,"scale",a,b,c)):this.scale=a},e.prototype.snapToScale=function(a){this.tweenToScale(a,0)}},{"./netsimUtils":186,"./tweens":189}],189:[function(a,b,c){"use strict";var d=a("../utils").valueOr,e=600;c.easeOutElastic=function(a,b,c,d){var e,f,g;return e=1.70158,f=0,g=c,0===a?b:1==(a/=d)?b+c:(f||(f=.3*d),g<Math.abs(c)?(g=c,e=f/4):e=f/(2*Math.PI)*Math.asin(c/g),g*Math.pow(2,-10*a)*Math.sin(2*(a*d-e)*Math.PI/f)+c+b)},c.easeInQuad=function(a,b,c,d){return c*(a/=d)*a+b},c.easeOutQuad=function(a,b,c,d){return-c*(a/=d)*(a-2)+b},c.easeInOutQuad=function(a,b,c,d){return(a/=d/2)<1?c/2*a*a+b:-c/2*(--a*(a-2)-1)+b},c.linear=function(a,b,c,d){return c*(a/d)+b},c.TweenValueTo=function(a,b,f,g,h){this.isFinished=!1,this.startTime_=void 0,this.target=a,this.propertyName=b,this.tweenFunction_=d(h,c.linear),this.startValue_=a[b],this.deltaValue_=f-this.startValue_,this.duration_=d(g,e)},c.TweenValueTo.prototype.tick=function(a){void 0===this.startTime_&&(this.startTime_=a.time);var b=a.time-this.startTime_;0!==this.deltaValue_&&(this.target[this.propertyName]=this.tweenFunction_(b,this.startValue_,this.deltaValue_,this.duration_)),b>=this.duration_&&(this.target[this.propertyName]=this.startValue_+this.deltaValue_,this.isFinished=!0)}},{"../utils":238}],172:[function(a,b){"use strict";var c=a("./NetSimTabsComponent.html"),d=a("./NetSimRouterTab"),e=a("./NetSimMyDeviceTab"),f=a("./NetSimDnsTab"),g=a("./netsimConstants").NetSimTabType,h=a("./netsimUtils").shouldShowTab,i=b.exports=function(a,b,c){this.rootDiv_=a,this.levelConfig_=b,this.chunkSizeChangeCallback_=c.chunkSizeChangeCallback,this.encodingChangeCallback_=c.encodingChangeCallback,this.routerBandwidthChangeCallback_=c.routerBandwidthChangeCallback,this.dnsModeChangeCallback_=c.dnsModeChangeCallback,this.becomeDnsCallback_=c.becomeDnsCallback,this.routerTab_=null,this.myDeviceTab_=null,this.dnsTab_=null,this.render()};i.prototype.render=function(){var a=c({level:this.levelConfig_}),b=$(a);this.rootDiv_.html(b),this.rootDiv_.find(".netsim-tabs").tabs({active:this.levelConfig_.defaultTabIndex}),h(this.levelConfig_,g.MY_DEVICE)&&(this.myDeviceTab_=new e(this.rootDiv_.find("#tab_my_device"),this.levelConfig_,this.chunkSizeChangeCallback_,this.encodingChangeCallback_)),h(this.levelConfig_,g.ROUTER)&&(this.routerTab_=new d(this.rootDiv_.find("#tab_router"),this.levelConfig_,this.routerBandwidthChangeCallback_)),h(this.levelConfig_,g.DNS)&&(this.dnsTab_=new f(this.rootDiv_.find("#tab_dns"),this.levelConfig_,this.dnsModeChangeCallback_,this.becomeDnsCallback_))},i.prototype.setChunkSize=function(a){this.myDeviceTab_&&this.myDeviceTab_.setChunkSize(a)},i.prototype.setEncodings=function(a){this.myDeviceTab_&&this.myDeviceTab_.setEncodings(a)},i.prototype.setRouterBandwidth=function(a){this.routerTab_&&this.routerTab_.setBandwidth(a)},i.prototype.setDnsMode=function(a){this.dnsTab_&&this.dnsTab_.setDnsMode(a)},i.prototype.setIsDnsNode=function(a){this.dnsTab_&&this.dnsTab_.setIsDnsNode(a)},i.prototype.setDnsTableContents=function(a){this.dnsTab_&&this.dnsTab_.setDnsTableContents(a)},i.prototype.setRouterLogData=function(a){this.routerTab_&&this.routerTab_.setRouterLogData(a)}},{"./NetSimDnsTab":134,"./NetSimMyDeviceTab":151,"./NetSimRouterTab":163,"./NetSimTabsComponent.html":171,"./netsimConstants":184,"./netsimUtils":186}],171:[function(require,module,exports){module.exports=function(){var t=function anonymous(locals,filters,escape){escape=escape||function(a){return String(a).replace(/&(?!\w+;)/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")};var buf=[];with(locals||{})!function(){buf.push("");var a=require("../../locale/current/netsim"),b=require("./netsimUtils").shouldShowTab,c=require("./netsimConstants").NetSimTabType,d=b(level,c.INSTRUCTIONS),e=b(level,c.MY_DEVICE),f=b(level,c.ROUTER),g=b(level,c.DNS),h=level.instructions||"";buf.push('\n<div class="netsim-tabs">\n  <ul>\n    '),d&&buf.push('\n    <li><a href="#tab_instructions">',escape(a.instructions()),"</a></li>\n    "),buf.push("\n    "),e&&buf.push('\n      <li><a href="#tab_my_device">',escape(a.myDevice()),"</a></li>\n    "),buf.push("\n    "),f&&buf.push('\n      <li><a href="#tab_router">',escape(a.router()),"</a></li>\n    "),buf.push("\n    "),g&&buf.push('\n      <li><a href="#tab_dns">',escape(a.dns()),"</a></li>\n    "),buf.push("\n  </ul>\n  "),d&&buf.push('\n    <div id="tab_instructions"><p>',escape(h),"</p></div>\n  "),buf.push("\n  "),e&&buf.push('\n    <div id="tab_my_device"></div>\n  '),buf.push("\n  "),f&&buf.push('\n    <div id="tab_router"></div>\n  '),buf.push("\n  "),g&&buf.push('\n    <div id="tab_dns"></div>\n  '),buf.push("\n</div>")}();return buf.join("")};return function(a){return t(a,require("ejs").filters)}}()},{"../../locale/current/netsim":248,"./netsimConstants":184,"./netsimUtils":186,ejs:259}],169:[function(a,b){"use strict";a("../utils");var c=a("./NetSimStatusPanel.html"),d=a("./NetSimPanel.js"),e=b.exports=function(a,b){this.disconnectCallback_=b,d.call(this,a,{className:"netsim_status_panel",panelTitle:"Status",beginMinimized:!0})};e.inherits(d),e.prototype.render=function(a){a=a||{},this.setPanelTitle(a.statusString),e.superPrototype.render.call(this);var b=$(c({remoteNodeName:a.remoteNodeName,myHostname:a.myHostname,myAddress:a.myAddress,shareLink:a.shareLink}));this.getBody().html(b),a.isConnected&&this.addButton("Disconnect",this.disconnectCallback_)}},{"../utils":238,"./NetSimPanel.js":158,"./NetSimStatusPanel.html":168}],168:[function(require,module,exports){module.exports=function(){var t=function anonymous(locals,filters,escape){escape=escape||function(a){return String(a).replace(/&(?!\w+;)/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")};var buf=[];with(locals||{})!function(){buf.push(""),remoteNodeName&&buf.push("\n<p>Connected to ",escape(remoteNodeName),"</p>\n"),buf.push("\n\n"),myHostname&&buf.push("\n<p>My hostname: ",escape(myHostname),"</p>\n"),buf.push("\n\n"),myAddress&&buf.push("\n<p>My address: ",escape(myAddress),"</p>\n"),buf.push("\n\n"),shareLink&&buf.push('\n<p><a href="',escape(shareLink),'">Share this private network.</a></p>\n'),buf.push("\n")}();return buf.join("")};return function(a){return t(a,require("ejs").filters)}}()},{ejs:259}],165:[function(a,b){"use strict";a("../utils");var c=a("../../locale/current/netsim"),d=a("./NetSimSendPanel.html"),e=a("./NetSimPanel"),f=a("./NetSimPacketEditor"),g=a("./NetSimPacketSizeControl"),h=a("./Packet"),i=a("./netsimConstants").BITS_PER_BYTE,j=b.exports=function(a,b,d){this.levelConfig_=b,this.packetSpec_=b.clientInitialPacketHeader,this.connection_=d,this.connection_.statusChanges.register(this.onConnectionStatusChange_.bind(this)),this.packets_=[],this.fromAddress_=0,this.maxPacketSize_=b.defaultPacketSizeLimit,this.chunkSize_=i,this.enabledEncodings_=b.defaultEnabledEncodings,this.packetsDiv_=null,this.packetSizeControl_=null,e.call(this,a,{className:"netsim-send-panel",panelTitle:c.sendAMessage()})};j.inherits(e),j.prototype.render=function(){j.superPrototype.render.call(this);var a=$(d({level:this.levelConfig_}));this.getBody().html(a),this.levelConfig_.showPacketSizeControl&&(this.packetSizeControl_=new g(this.rootDiv_.find(".packet_size"),this.packetSizeChangeCallback_.bind(this),{minimumPacketSize:h.Encoder.getHeaderLength(this.packetSpec_),sliderStepValue:1}),this.packetSizeControl_.setPacketSize(this.maxPacketSize_)),this.packetsDiv_=this.getBody().find(".send-widget-packets"),this.getBody().find("#add_packet_button").click(this.addPacket_.bind(this)),this.getBody().find("#send_button").click(this.onSendButtonPress_.bind(this)),this.resetPackets_()},j.prototype.addPacket_=function(){var a=this.packets_.length+1;this.packets_.forEach(function(b){b.setPacketCount(a)});var b=0;this.packets_.length>0&&(b=this.packets_[this.packets_.length-1].toAddress);var c=new f({packetSpec:this.packetSpec_,toAddress:b,fromAddress:this.fromAddress_,packetIndex:a,packetCount:a,maxPacketSize:this.maxPacketSize_,chunkSize:this.chunkSize_,enabledEncodings:this.enabledEncodings_,removePacketCallback:this.removePacket_.bind(this)});c.getRoot().appendTo(this.packetsDiv_),c.getRoot().hide().slideDown("fast"),this.packets_.push(c)},j.prototype.removePacket_=function(a){a.getRoot().slideUp("fast",function(){$(this).remove()
}),this.packets_=this.packets_.filter(function(b){return b!==a});for(var b,c=this.packets_.length,d=0;c>d;d++)b=d+1,this.packets_[d].setPacketIndex(b),this.packets_[d].setPacketCount(c)},j.prototype.resetPackets_=function(){this.packetsDiv_.empty(),this.packets_.length=0,this.addPacket_()},j.prototype.onConnectionStatusChange_=function(){this.fromAddress_=0,this.connection_.myNode&&this.connection_.myNode.myWire&&(this.fromAddress_=this.connection_.myNode.myWire.localAddress),this.packets_.forEach(function(a){a.setFromAddress(this.fromAddress_)}.bind(this))},j.prototype.onSendButtonPress_=function(){var a=this.packets_.map(function(a){return a.getPacketBinary().substr(0,this.maxPacketSize_)}.bind(this)),b=this.connection_.myNode;b&&a.length>0&&(this.disableEverything(),b.sendMessages(a,function(){this.resetPackets_(),this.enableEverything()}.bind(this)))},j.prototype.disableEverything=function(){this.getBody().find("input, textarea").prop("disabled",!0)},j.prototype.enableEverything=function(){this.getBody().find("input, textarea").prop("disabled",!1)},j.prototype.setEncodings=function(a){this.enabledEncodings_=a,this.packets_.forEach(function(b){b.setEncodings(a)})},j.prototype.setChunkSize=function(a){this.chunkSize_=a,this.packets_.forEach(function(b){b.setChunkSize(a)})},j.prototype.packetSizeChangeCallback_=function(a){this.maxPacketSize_=a,this.packets_.forEach(function(b){b.setMaxPacketSize(a)})}},{"../../locale/current/netsim":248,"../utils":238,"./NetSimPacketEditor":154,"./NetSimPacketSizeControl":156,"./NetSimPanel":158,"./NetSimSendPanel.html":164,"./Packet":178,"./netsimConstants":184}],164:[function(require,module,exports){module.exports=function(){var t=function anonymous(locals,filters,escape){escape=escape||function(a){return String(a).replace(/&(?!\w+;)/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")};var buf=[];with(locals||{})!function(){buf.push("");var a=require("../../locale/current/netsim");buf.push('\n<div class="send-widget-packets"></div>\n<div class="send_widget_footer">\n  <div class="right-side-controls">\n    '),level.showAddPacketButton&&buf.push('\n      <span class="netsim-button" id="add_packet_button">',escape(a.addPacket()),"</span>\n    "),buf.push('\n    <span class="netsim-button" id="send_button">',escape(a.send()),'</span>\n  </div>\n  <div class="packet_size"></div>\n</div>\n')}();return buf.join("")};return function(a){return t(a,require("ejs").filters)}}()},{"../../locale/current/netsim":248,ejs:259}],163:[function(a,b){"use strict";var c=a("./NetSimRouterTab.html"),d=a("./NetSimBandwidthControl"),e=a("./NetSimRouterLogTable"),f=b.exports=function(a,b,c){this.rootDiv_=a,this.levelConfig_=b,this.bandwidthChangeCallback_=c,this.routerLogTable_=null,this.bandwidthControl_=null,this.render()};f.prototype.render=function(){var a=$(c({level:this.levelConfig_}));this.rootDiv_.html(a),this.routerLogTable_=new e(this.rootDiv_.find(".router_log_table"),this.levelConfig_),this.levelConfig_.showRouterBandwidthControl&&(this.bandwidthControl_=new d(this.rootDiv_.find(".bandwidth-control"),this.bandwidthChangeCallback_))},f.prototype.setRouterLogData=function(a){this.routerLogTable_.setRouterLogData(a)},f.prototype.setBandwidth=function(a){this.bandwidthControl_&&this.bandwidthControl_.setBandwidth(a)}},{"./NetSimBandwidthControl":124,"./NetSimRouterLogTable":160,"./NetSimRouterTab.html":162}],162:[function(require,module,exports){module.exports=function(){var t=function anonymous(locals,filters,escape){escape=escape||function(a){return String(a).replace(/&(?!\w+;)/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")};var buf=[];with(locals||{})!function(){buf.push('<div class="netsim-router-tab">\n  '),level.showRouterBandwidthControl&&buf.push('\n    <div class="bandwidth-control"></div>\n  '),buf.push('\n  <div class="router_log_table"></div>\n</div>\n')}();return buf.join("")};return function(a){return t(a,require("ejs").filters)}}()},{ejs:259}],160:[function(a,b){"use strict";var c=a("./NetSimRouterLogTable.html"),d=b.exports=function(a,b){this.rootDiv_=a,this.levelConfig_=b,this.routerLogData_=[],this.render()};d.prototype.render=function(){var a=$(c({level:this.levelConfig_,tableData:this.routerLogData_}));this.rootDiv_.html(a)},d.prototype.setRouterLogData=function(a){this.routerLogData_=a,this.render()}},{"./NetSimRouterLogTable.html":159}],159:[function(require,module,exports){module.exports=function(){var t=function anonymous(locals,filters,escape){escape=escape||function(a){return String(a).replace(/&(?!\w+;)/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")};var buf=[];with(locals||{})!function(){buf.push("");var a=require("../../locale/current/netsim"),b=(require("./netsimConstants"),require("./Packet")),c=level.routerExpectsPacketHeader.map(function(a){return a.key}),d=c.indexOf(b.HeaderType.TO_ADDRESS)>-1,e=c.indexOf(b.HeaderType.FROM_ADDRESS)>-1,f=c.indexOf(b.HeaderType.PACKET_INDEX)>-1&&c.indexOf(b.HeaderType.PACKET_COUNT)>-1;buf.push('\n<div class="netsim-router-log">\n  <h1>Router Traffic</h1>\n  <table>\n    <thead>\n    <tr>\n      '),d&&buf.push("\n        <th nowrap>",escape(a.to()),"</th>\n      "),buf.push("\n      "),e&&buf.push("\n        <th nowrap>",escape(a.from()),"</th>\n      "),buf.push("\n      "),f&&buf.push("\n        <th nowrap>",escape(a.packetInfo()),"</th>\n      "),buf.push("\n      <th nowrap>",escape(a.message()),"</th>\n      <th nowrap>",escape(a.bits()),"</th>\n    </tr>\n    </thead>\n    <tbody>\n    "),tableData.sort(function(a,b){return a.timestamp>b.timestamp?-1:1}),tableData.forEach(function(c){var g=[];buf.push('\n    <tr class="',escape(g.join(" ")),'">\n      '),d&&buf.push("\n        <td nowrap>",escape(c.getHeaderField(b.HeaderType.TO_ADDRESS)),"</td>\n      "),buf.push("\n      "),e&&buf.push("\n        <td nowrap>",escape(c.getHeaderField(b.HeaderType.FROM_ADDRESS)),"</td>\n      "),buf.push("\n      "),f&&buf.push("\n        <td nowrap>",escape(a.xOfYPackets({x:c.getHeaderField(b.HeaderType.PACKET_INDEX),y:c.getHeaderField(b.HeaderType.PACKET_COUNT)})),"</td>\n      "),buf.push("\n      <td>",escape(c.getMessageAscii()),"</td>\n      <td nowrap>",escape(c.binary.length),"</td>\n    </tr>\n    ")}),buf.push("\n    </tbody>\n  </table>\n</div>")}();return buf.join("")};return function(a){return t(a,require("ejs").filters)}}()},{"../../locale/current/netsim":248,"./Packet":178,"./netsimConstants":184,ejs:259}],156:[function(a,b){"use strict";var c=a("./NetSimPacketSizeControl.html"),d=a("../../locale/current/netsim"),e=1025,f=b.exports=function(a,b,c){this.rootDiv_=a,this.packetSizeChangeCallback_=b,this.minimumPacketSize_=c.minimumPacketSize,this.sliderStepValue_=c.sliderStepValue,this.maxPacketSize_=1/0,this.render()};f.prototype.render=function(){var a=$(c({minValue:this.minimumPacketSize_,maxValue:d.unlimited()}));this.rootDiv_.html(a),this.rootDiv_.find(".packet-size-slider").slider({value:this.maxPacketSize_,min:this.minimumPacketSize_,max:e,step:this.sliderStepValue_,slide:this.onPacketSizeChange_.bind(this)}),this.setPacketSize(this.maxPacketSize_)},f.prototype.packetSizeToSliderValue_=function(a){return 1/0===a?e:a},f.prototype.sliderValueToPacketSize_=function(a){return a===e?1/0:a},f.prototype.onPacketSizeChange_=function(a,b){var c=this.sliderValueToPacketSize_(b.value);this.setPacketSize(c),this.packetSizeChangeCallback_(c)},f.prototype.setPacketSize=function(a){var b=this.rootDiv_;this.maxPacketSize_=a,b.find(".packet-size-slider").slider("option","value",this.packetSizeToSliderValue_(a)),b.find(".packet_size_value").text(this.getPacketSizeText(a))},f.prototype.getPacketSizeText=function(a){return 1/0===a?d.unlimited():d.numBitsPerPacket({x:a})}},{"../../locale/current/netsim":248,"./NetSimPacketSizeControl.html":155}],155:[function(require,module,exports){module.exports=function(){var t=function anonymous(locals,filters,escape){escape=escape||function(a){return String(a).replace(/&(?!\w+;)/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")};var buf=[];with(locals||{})!function(){buf.push("");require("../../locale/current/netsim");buf.push('\n<div class="netsim_packet_size_control">\n  <div class="slider-inline-wrap">\n    <div class="packet-size-slider"></div>\n    <div class="slider-labels">\n      <div class="max-value">',escape(maxValue),'</div>\n      <div class="min-value">',escape(minValue),'</div>\n      <div class="current-value">\n        <label for="packet-size-slider"><span class="packet_size_value"></span></label>\n      </div>\n    </div>\n  </div>\n</div>\n')}();return buf.join("")};return function(a){return t(a,require("ejs").filters)}}()},{"../../locale/current/netsim":248,ejs:259}],154:[function(a,b){"use strict";a("../utils");var c=a("../../locale/current/netsim"),d=a("./NetSimPacketEditor.html"),e=a("../constants").KeyCodes,f=a("./NetSimEncodingControl"),g=a("./Packet"),h=a("./dataConverters"),i=a("./netsimConstants"),j=i.EncodingType,k=i.BITS_PER_BYTE,l=h.minifyBinary,m=h.formatBinary,n=h.formatHex,o=h.alignDecimal,p=h.binaryToInt,q=h.intToBinary,r=h.hexToInt,s=h.intToHex,t=h.hexToBinary,u=h.binaryToHex,v=h.decimalToBinary,w=h.binaryToDecimal,x=h.asciiToBinary,y=h.binaryToAscii,z=b.exports=function(a){this.rootDiv_=$("<div>").addClass("netsim-packet"),this.packetSpec_=a.packetSpec,this.toAddress=a.toAddress||0,this.fromAddress=a.fromAddress||0,this.packetIndex=void 0!==a.packetIndex?a.packetIndex:1,this.packetCount=void 0!==a.packetCount?a.packetCount:1,this.message=a.message||"",this.maxPacketSize_=a.maxPacketSize||1/0,this.currentChunkSize_=a.chunkSize||k,this.enabledEncodings_=a.enabledEncodings||[],this.removePacketCallback_=a.removePacketCallback,this.removePacketButton_=null,this.bitCounter_=null,this.render()};z.prototype.getRoot=function(){return this.rootDiv_},z.prototype.render=function(){var a=$(d({packetSpec:this.packetSpec_}));this.rootDiv_.html(a),this.bindElements_(),this.updateFields_(),this.removePacketButton_.toggle(this.packetCount>1),f.hideRowsByEncoding(this.rootDiv_,this.enabledEncodings_)};var A=function(a){var b=$(a.target);b.hasClass("watermark")&&(b.val(""),b.removeClass("watermark"))},B=function(a){return function(b){if(b.metaKey||b.ctrlKey)return!0;if(b.which<e.SPACE||b.which>=e.DELETE)return!0;var c=String.fromCharCode(b.which);return a.test(c)?void 0:(b.preventDefault(),!1)}};z.prototype.makeKeyupHandler=function(a,b){return function(c){var d=b(c.target.value);isNaN(d)||(this[a]=d,this.updateFields_(c.target))}.bind(this)},z.prototype.makeBlurHandler=function(a,b){return function(c){var d=b(c.target.value);isNaN(d)&&(d=b("0")),this[a]=d,this.updateFields_()}.bind(this)},z.prototype.bindElements_=function(){var a=this.rootDiv_,b=[g.HeaderType.TO_ADDRESS,g.HeaderType.FROM_ADDRESS,g.HeaderType.PACKET_INDEX,g.HeaderType.PACKET_COUNT],c=[{typeName:j.BINARY,shortNumberAllowedCharacters:/[01]/,shortNumberConversion:p,messageAllowedCharacters:/[01\s]/,messageConversion:l},{typeName:j.HEXADECIMAL,shortNumberAllowedCharacters:/[0-9a-f]/i,shortNumberConversion:r,messageAllowedCharacters:/[0-9a-f\s]/i,messageConversion:t},{typeName:j.DECIMAL,shortNumberAllowedCharacters:/[0-9]/,shortNumberConversion:parseInt,messageAllowedCharacters:/[0-9\s]/,messageConversion:function(a){return v(a,this.currentChunkSize_)}.bind(this)},{typeName:j.ASCII,shortNumberAllowedCharacters:/[0-9]/,shortNumberConversion:parseInt,messageAllowedCharacters:/./,messageConversion:function(a){return x(a,this.currentChunkSize_)}.bind(this)}];c.forEach(function(c){var d=a.find("tr."+c.typeName),e=c.typeName+"UI";this[e]={};var f=this[e];b.forEach(function(a){f[a]=d.find("input."+a),f[a].keypress(B(c.shortNumberAllowedCharacters)),f[a].keyup(this.makeKeyupHandler(a,c.shortNumberConversion)),f[a].blur(this.makeBlurHandler(a,c.shortNumberConversion))},this),f.message=d.find("textarea.message"),f.message.focus(A),f.message.keypress(B(c.messageAllowedCharacters)),f.message.keyup(this.makeKeyupHandler("message",c.messageConversion)),f.message.blur(this.makeBlurHandler("message",c.messageConversion))},this),this.removePacketButton_=a.find(".remove-packet-button"),this.removePacketButton_.click(this.onRemovePacketButtonClick_.bind(this)),this.bitCounter_=a.find(".bit-counter")},z.prototype.updateFields_=function(a){var b=this.currentChunkSize_,d=[];[g.HeaderType.TO_ADDRESS,g.HeaderType.FROM_ADDRESS,g.HeaderType.PACKET_INDEX,g.HeaderType.PACKET_COUNT].forEach(function(a){d.push({inputElement:this.binaryUI[a],newValue:q(this[a],4)}),d.push({inputElement:this.hexadecimalUI[a],newValue:s(this[a],1)}),d.push({inputElement:this.decimalUI[a],newValue:this[a].toString(10)}),d.push({inputElement:this.asciiUI[a],newValue:this[a].toString(10)})},this),d.push({inputElement:this.binaryUI.message,newValue:m(this.message,b),watermark:c.binary()}),d.push({inputElement:this.hexadecimalUI.message,newValue:n(u(this.message),b),watermark:c.hexadecimal()}),d.push({inputElement:this.decimalUI.message,newValue:o(w(this.message,b)),watermark:c.decimal()}),d.push({inputElement:this.asciiUI.message,newValue:y(this.message,b),watermark:c.ascii()}),d.forEach(function(b){b.inputElement[0]!==a&&(b.watermark&&""===b.newValue?(b.inputElement.val(b.watermark),b.inputElement.addClass("watermark")):(b.inputElement.val(b.newValue),b.inputElement.removeClass("watermark")))}),this.updateBitCounter()},z.prototype.getPacketBinary=function(){var a=new g.Encoder(this.packetSpec_);return a.concatenateBinary(a.makeBinaryHeaders({toAddress:this.toAddress,fromAddress:this.fromAddress,packetIndex:this.packetIndex,packetCount:this.packetCount}),this.message)},z.prototype.setFromAddress=function(a){this.fromAddress=a,this.updateFields_()},z.prototype.setPacketIndex=function(a){this.packetIndex=a,this.updateFields_()},z.prototype.setPacketCount=function(a){this.packetCount=a,this.removePacketButton_.toggle(a>1),this.updateFields_()},z.prototype.setMaxPacketSize=function(a){this.maxPacketSize_=a,this.updateBitCounter()},z.prototype.setEncodings=function(a){this.enabledEncodings_=a,f.hideRowsByEncoding(this.rootDiv_,a)},z.prototype.setChunkSize=function(a){this.currentChunkSize_=a,this.updateFields_()},z.prototype.updateBitCounter=function(){var a=this.getPacketBinary().length,b=1/0===this.maxPacketSize_?c.infinity():this.maxPacketSize_;this.bitCounter_.html(c.bitCounter({x:a,y:b})),this.bitCounter_.toggleClass("oversized",a>this.maxPacketSize_)},z.prototype.onRemovePacketButtonClick_=function(){this.removePacketCallback_(this)}},{"../../locale/current/netsim":248,"../constants":53,"../utils":238,"./NetSimEncodingControl":138,"./NetSimPacketEditor.html":153,"./Packet":178,"./dataConverters":180,"./netsimConstants":184}],153:[function(require,module,exports){module.exports=function(){var t=function anonymous(locals,filters,escape){escape=escape||function(a){return String(a).replace(/&(?!\w+;)/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")};var buf=[];with(locals||{})!function(){function a(a){buf.push('\n      <tr class="',escape(a),'">\n        <th nowrap class="',escape(f.ENCODING_LABEL),'">',escape(h(a)),"</th>\n        "),k&&buf.push('\n        <td nowrap class="',escape(f.TO_ADDRESS),'"><input type="text" class="',escape(e.HeaderType.TO_ADDRESS),'" /></td>\n        '),buf.push("\n        "),l&&buf.push('\n        <td nowrap class="',escape(f.FROM_ADDRESS),'"><input type="text" readonly class="',escape(e.HeaderType.FROM_ADDRESS),'" /></td>\n        '),buf.push("\n        "),m&&buf.push('\n        <td nowrap class="',escape(f.PACKET_INFO),'"><input type="text" readonly class="',escape(e.HeaderType.PACKET_INDEX),'" />',escape(b._of_()),'<input type="text" readonly class="',escape(e.HeaderType.PACKET_COUNT),'" /></td>\n        '),buf.push('\n        <td class="',escape(f.MESSAGE),'"><div><textarea class="message"></textarea></div></td>\n      </tr>\n    ')}buf.push("");var b=require("../../locale/current/netsim"),c=require("./netsimConstants"),d=c.EncodingType,e=require("./Packet"),f=c.PacketUIColumnType,g=require("./netsimUtils"),h=g.getEncodingLabel,i=g.forEachEnumValue,j=packetSpec.map(function(a){return a.key}),k=j.indexOf(e.HeaderType.TO_ADDRESS)>-1,l=j.indexOf(e.HeaderType.FROM_ADDRESS)>-1,m=j.indexOf(e.HeaderType.PACKET_INDEX)>-1&&j.indexOf(e.HeaderType.PACKET_COUNT)>-1;buf.push('\n<table>\n  <thead>\n  <tr>\n    <th nowrap class="',escape(f.ENCODING_LABEL),'"></th>\n    '),k&&buf.push('\n      <th nowrap class="',escape(f.TO_ADDRESS),'">',escape(b.to()),"</th>\n    "),buf.push("\n    "),l&&buf.push('\n      <th nowrap class="',escape(f.FROM_ADDRESS),'">',escape(b.from()),"</th>\n    "),buf.push("\n    "),m&&buf.push('\n      <th nowrap class="',escape(f.PACKET_INFO),'">',escape(b.packet()),"</th>\n    "),buf.push('\n    <th class="',escape(f.MESSAGE),'">\n      ',escape(b.message()),'\n      <div class="packet-controls">\n        <span class="netsim-button remove-packet-button" title="',escape(b.removePacket()),'"><i class="fa fa-times"></i></span>\n      </div>\n    </th>\n  </tr>\n  </thead>\n  <tbody>\n  '),i(d,function(b){a(b)}),buf.push('\n  </tbody>\n</table>\n<div class="bit-counter"></div>\n')}();return buf.join("")};return function(a){return t(a,require("ejs").filters)}}()},{"../../locale/current/netsim":248,"./Packet":178,"./netsimConstants":184,"./netsimUtils":186,ejs:259}],151:[function(a,b){"use strict";var c=a("./NetSimMyDeviceTab.html"),d=a("./NetSimChunkSizeControl"),e=a("./NetSimEncodingControl"),f=b.exports=function(a,b,c,d){this.rootDiv_=a,this.levelConfig_=b,this.chunkSizeChangeCallback_=c,this.encodingChangeCallback_=d,this.chunkSizeControl_=null,this.encodingControl_=null,this.render()};f.prototype.render=function(){var a=$(c({}));this.rootDiv_.html(a),this.chunkSizeControl_=new d(this.rootDiv_.find(".chunk_size"),this.chunkSizeChangeCallback_),this.levelConfig_.showEncodingControls.length>0&&(this.encodingControl_=new e(this.rootDiv_.find(".encoding"),this.levelConfig_,this.encodingChangeCallback_))},f.prototype.setChunkSize=function(a){this.chunkSizeControl_.setChunkSize(a)},f.prototype.setEncodings=function(a){this.encodingControl_&&this.encodingControl_.setEncodings(a),this.chunkSizeControl_.setEncodings(a)}},{"./NetSimChunkSizeControl":126,"./NetSimEncodingControl":138,"./NetSimMyDeviceTab.html":150}],150:[function(require,module,exports){module.exports=function(){var t=function anonymous(locals,filters,escape){escape=escape||function(a){return String(a).replace(/&(?!\w+;)/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")};var buf=[];with(locals||{})!function(){buf.push('<div class="netsim-my-device-tab">\n  <div class="encoding"></div>\n  <div class="chunk_size"></div>\n</div>\n')}();return buf.join("")};return function(a){return t(a,require("ejs").filters)}}()},{ejs:259}],147:[function(a,b){"use strict";a("../utils");var c=a("../../locale/current/netsim"),d=a("./NetSimLogPanel.html"),e=a("./NetSimLogPacket.html"),f=a("./NetSimPanel"),g=a("./NetSimEncodingControl"),h=b.exports=function(a,b){this.packetSpec_=b.packetSpec,this.packets_=[],this.currentEncodings_=[],this.currentChunkSize_=8,f.call(this,a,{className:"netsim-log-panel",panelTitle:b.logTitle,beginMinimized:b.isMinimized})};h.inherits(f),h.prototype.render=function(){h.superPrototype.render.call(this);var a=$(d({}));this.getBody().html(a),this.addButton(c.clear(),this.onClearButtonPress_.bind(this)),this.scrollArea_=this.getBody().find(".scroll_area")},h.prototype.onClearButtonPress_=function(){this.scrollArea_.empty(),this.packets_.length=0},h.prototype.log=function(a){var b=this.scrollArea_,c=b[0].scrollHeight-b[0].scrollTop<=b.outerHeight(),d=new i(a,{packetSpec:this.packetSpec_,encodings:this.currentEncodings_,chunkSize:this.currentChunkSize_});d.getRoot().appendTo(this.scrollArea_),this.packets_.push(d),c&&b.scrollTop(b[0].scrollHeight)},h.prototype.setEncodings=function(a){this.currentEncodings_=a,this.packets_.forEach(function(b){b.setEncodings(a)})},h.prototype.setChunkSize=function(a){this.currentChunkSize_=a,this.packets_.forEach(function(b){b.setChunkSize(a)})};var i=function(a,b){this.packetBinary_=a,this.packetSpec_=b.packetSpec,this.encodings_=b.encodings,this.chunkSize_=b.chunkSize,this.rootDiv_=$("<div>").addClass("packet"),this.render()};i.prototype.render=function(){var a=e({packetBinary:this.packetBinary_,packetSpec:this.packetSpec_,chunkSize:this.chunkSize_}),b=$(a);g.hideRowsByEncoding(b,this.encodings_),this.rootDiv_.html(b)},i.prototype.getRoot=function(){return this.rootDiv_},i.prototype.setEncodings=function(a){this.encodings_=a,this.render()},i.prototype.setChunkSize=function(a){this.chunkSize_=a,this.render()}},{"../../locale/current/netsim":248,"../utils":238,"./NetSimEncodingControl":138,"./NetSimLogPacket.html":145,"./NetSimLogPanel.html":146,"./NetSimPanel":158}],158:[function(a,b){"use strict";var c=a("./NetSimPanel.html"),d=b.exports=function(a,b){this.instanceID_=d.uniqueIDCounter,d.uniqueIDCounter++,this.rootDiv_=a,this.className_=b.className||"",this.panelTitle_=b.panelTitle||"",this.isMinimized_=void 0!==b.beginMinimized?b.beginMinimized:!1,this.render()};d.uniqueIDCounter=0,d.prototype.render=function(){var a=$(c({instanceID:this.instanceID_,className:this.className_,panelTitle:this.panelTitle_}));this.rootDiv_.html(a),this.rootDiv_.find(".minimizer").click(this.onMinimizerClick_.bind(this)),this.setMinimized(this.isMinimized_)},d.prototype.setPanelTitle=function(a){this.panelTitle_=a},d.prototype.onMinimizerClick_=function(){this.setMinimized(!this.isMinimized_)},d.prototype.setMinimized=function(a){var b=this.rootDiv_.find(".netsim-panel"),c=b.find(".minimizer");a?(b.addClass("minimized"),c.find(".fa").addClass("fa-plus-square").removeClass("fa-minus-square")):(b.removeClass("minimized"),c.find(".fa").addClass("fa-minus-square").removeClass("fa-plus-square")),this.isMinimized_=a},d.prototype.addButton=function(a,b){$("<span>").addClass("netsim-button").html(a).click(b).appendTo(this.rootDiv_.find(".panel_controls"))},d.prototype.getBody=function(){return this.rootDiv_.find(".panel-body")}},{"./NetSimPanel.html":157}],157:[function(require,module,exports){module.exports=function(){var t=function anonymous(locals,filters,escape){escape=escape||function(a){return String(a).replace(/&(?!\w+;)/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")};var buf=[];with(locals||{})!function(){buf.push('<div id="netsim_panel_',escape(instanceID),'"\n     class="netsim-panel ',escape(className),'">\n  <h1>\n    <span class="minimizer">\n      <i class="fa fa-minus-square"></i>\n      ',escape(panelTitle),'\n    </span>\n    <div class="panel_controls">\n    </div>\n  </h1>\n  <div class="panel-body">\n  </div>\n</div>\n')}();return buf.join("")};return function(a){return t(a,require("ejs").filters)}}()},{ejs:259}],146:[function(require,module,exports){module.exports=function(){var t=function anonymous(locals,filters,escape){escape=escape||function(a){return String(a).replace(/&(?!\w+;)/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")};var buf=[];with(locals||{})!function(){buf.push('<div class="log_body">\n  <div class="scroll_area">\n  </div>\n</div>\n')}();return buf.join("")};return function(a){return t(a,require("ejs").filters)}}()},{ejs:259}],145:[function(require,module,exports){module.exports=function(){var t=function anonymous(locals,filters,escape){escape=escape||function(a){return String(a).replace(/&(?!\w+;)/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")};var buf=[];with(locals||{})!function(){function a(a,b,c,d,f){buf.push('\n      <tr class="',escape(a),'">\n        <th nowrap class="',escape(h.ENCODING_LABEL),'">',escape(e(a)),"</th>\n        "),r&&buf.push('\n          <td nowrap class="',escape(h.TO_ADDRESS),'">',escape(b),"</td>\n        "),buf.push("\n        "),s&&buf.push('\n          <td nowrap class="',escape(h.FROM_ADDRESS),'">',escape(c),"</td>\n        "),buf.push("\n        "),t&&buf.push('\n          <td nowrap class="',escape(h.PACKET_INFO),'">',escape(d),"</td>\n        "),buf.push('\n        <td class="',escape(h.MESSAGE),'">',escape(f),"</td>\n      </tr>\n  ")}buf.push("");var b=require("./netsimConstants"),c=require("./dataConverters"),d=require("../../locale/current/netsim"),e=require("./netsimUtils").getEncodingLabel,f=require("./Packet"),g=b.EncodingType,h=b.PacketUIColumnType,i=c.formatBinary,j=c.formatHex,k=c.alignDecimal,l=c.binaryToInt,m=c.binaryToHex,n=c.binaryToDecimal,o=c.binaryToAscii,p=new f(packetSpec,packetBinary),q=packetSpec.map(function(a){return a.key}),r=q.indexOf(f.HeaderType.TO_ADDRESS)>-1,s=q.indexOf(f.HeaderType.FROM_ADDRESS)>-1,t=q.indexOf(f.HeaderType.PACKET_INDEX)>-1&&q.indexOf(f.HeaderType.PACKET_COUNT)>-1;buf.push('\n<table>\n  <thead>\n    <tr>\n      <th nowrap class="',escape(h.ENCODING_LABEL),'"></th>\n      '),r&&buf.push('\n        <th nowrap class="',escape(h.TO_ADDRESS),'">',escape(d.to()),"</th>\n      "),buf.push("\n      "),s&&buf.push('\n        <th nowrap class="',escape(h.FROM_ADDRESS),'">',escape(d.from()),"</th>\n      "),buf.push("\n      "),t&&buf.push('\n        <th nowrap class="',escape(h.PACKET_INFO),'">',escape(d.packet()),"</th>\n      "),buf.push('\n      <th nowrap class="',escape(h.MESSAGE),'">',escape(d.message()),"</th>\n    </tr>\n  </thead>\n  <tbody>\n  ");var u=r?p.getHeaderAsBinary(f.HeaderType.TO_ADDRESS):"",v=s?p.getHeaderAsBinary(f.HeaderType.FROM_ADDRESS):"",w=t?p.getHeaderAsBinary(f.HeaderType.PACKET_INDEX):"",x=t?p.getHeaderAsBinary(f.HeaderType.PACKET_COUNT):"",y=p.getBodyAsBinary();a(g.ASCII,l(u),l(v),d.xOfYPackets({x:l(w),y:l(x)}),o(y,chunkSize)),a(g.DECIMAL,l(u),l(v),d.xOfYPackets({x:l(w),y:l(x)}),k(n(y,chunkSize))),a(g.HEXADECIMAL,m(u),m(v),d.xOfYPackets({x:m(w),y:m(x)}),j(m(y),chunkSize)),a(g.BINARY,i(u,4),i(v,4),i(w,4)+" "+i(x,4),i(y,chunkSize)),buf.push("\n  </tbody>\n</table>")}();return buf.join("")};return function(a){return t(a,require("ejs").filters)}}()},{"../../locale/current/netsim":248,"./Packet":178,"./dataConverters":180,"./netsimConstants":184,"./netsimUtils":186,ejs:259}],142:[function(a,b){"use strict";var c=a("../utils"),d=a("./netsimNodeFactory"),e=a("./NetSimLogger"),f=a("./NetSimLobby.html"),g=a("./netsimConstants").NodeType,h=new e(console,e.LogLevel.VERBOSE),i="none",j=b.exports=function(a,b,c,d){this.levelConfig_=a,this.connection_=b,this.connection_.statusChanges.register(this.refresh_.bind(this)),h.info("NetSimLobby registered to connection statusChanges"),this.connection_.shardChange.register(this.onShardChange_.bind(this)),h.info("NetSimLobby registered to connection shardChanges"),this.shard_=null,this.user_=c,this.overrideShardID_=d,this.selectedID_=void 0,this.selectedListItem_=void 0};j.createWithin=function(a,b,c,d,e){var g=new j(b,c,d,e);return a.innerHTML=f({level:b}),g.bindElements_(),g.refresh_(),g},j.prototype.bindElements_=function(){this.openRoot_=$("#netsim_lobby_open"),this.displayNameView_=this.openRoot_.find("#display_name_view"),this.shardView_=this.openRoot_.find("#shard_view"),this.nameInput_=this.displayNameView_.find("#netsim_lobby_name"),this.setNameButton_=this.displayNameView_.find("#netsim_lobby_set_name_button"),this.setNameButton_.click(this.setNameButtonClick_.bind(this)),this.shardSelector_=this.shardView_.find("#netsim_shard_select"),this.shardSelector_.change(this.onShardSelectorChange_.bind(this)),this.notConnectedNote_=this.shardView_.find("#netsim_not_connected_note"),this.notConnectedNote_.hide(),this.addRouterButton_=this.shardView_.find("#netsim_lobby_add_router"),this.addRouterButton_.click(this.addRouterButtonClick_.bind(this)),this.lobbyList_=this.shardView_.find("#netsim_lobby_list"),this.connectButton_=this.shardView_.find("#netsim_lobby_connect"),this.connectButton_.click(this.connectButtonClick_.bind(this)),this.shardLinks_=$(".shardLink"),this.shardLinks_.hide(),this.user_.isSignedIn&&(this.nameInput_.val(this.user_.name),this.refreshShardList_())},j.prototype.onShardChange_=function(a){this.shard_=a,null!==this.shard_&&(this.shard_.nodeTable.tableChange.register(this.onNodeTableChange_.bind(this)),h.info("NetSimLobby registered to nodeTable tableChange"))},j.prototype.onNodeTableChange_=function(a){var b=d.nodesFromRows(this.shard_,a);this.refreshLobbyList_(b)},j.prototype.setNameButtonClick_=function(){this.nameInput_.prop("disabled",!0),this.setNameButton_.hide(),this.shardSelector_.attr("disabled",!1),this.refreshShardList_()},j.prototype.onShardSelectorChange_=function(){var a=this.shardSelector_.val();this.connection_.isConnectedToShard()?this.connection_.disconnectFromShard(this.selectShard_.bind(this,a)):this.selectShard_(a)},j.prototype.selectShard_=function(a){this.shardSelector_.val(a),this.nameInput_.disabled=!1,a!==i&&(this.nameInput_.disabled=!0,this.connection_.connectToShard(a,this.nameInput_.val()))},j.prototype.addRouterButtonClick_=function(){this.connection_.addRouterToLobby()},j.prototype.connectButtonClick_=function(){this.selectedID_&&this.connection_.connectToRouter(this.selectedID_)},j.prototype.disconnectButtonClick_=function(){this.connection_.disconnectFromRouter()},j.prototype.refreshShardList_=function(){var a=this,b="demo",c=this.shardSelector_;return void 0!==this.overrideShardID_?void this.useShard(this.overrideShardID_):this.user_.isSignedIn?void this.getUserSections_(function(d){return 0===d.length?void this.useRandomShard():($(c).empty(),d.length>1&&$("<option>").val(i).html("-- PICK ONE --").appendTo(c),d.forEach(function(a){$("<option>").val("netsim_"+b+"_"+a.id).html(a.name).appendTo(c)}),void a.onShardSelectorChange_())}.bind(this)):void this.useRandomShard()},j.prototype.useRandomShard=function(){this.useShard("netsim_"+c.createUuid())},j.prototype.useShard=function(a){this.shardSelector_.empty(),$("<option>").val(a).html("My Private Network").appendTo(this.shardSelector_),this.shardLinks_.attr("href",this.buildShareLink(a)).show(),this.onShardSelectorChange_()},j.prototype.buildShareLink=function(a){var b=document.location.protocol+"//"+document.location.host+document.location.pathname;return b+"?s="+a},j.prototype.refresh_=function(){if(!this.connection_.isConnectedToRouter()){if(this.openRoot_.show(),""===this.nameInput_.val())return this.nameInput_.prop("disabled",!1),this.setNameButton_.show(),void this.shardView_.hide();if(this.nameInput_.prop("disabled",!0),this.setNameButton_.hide(),this.shardView_.show(),!this.connection_.isConnectedToShard())return this.shardSelector_.val(i),this.notConnectedNote_.show(),this.addRouterButton_.hide(),this.lobbyList_.hide(),void this.connectButton_.hide();this.notConnectedNote_.hide(),this.addRouterButton_.show(),this.lobbyList_.show(),this.connectButton_.show(),this.connection_.getAllNodes(function(a){this.refreshLobbyList_(a)}.bind(this))}},j.prototype.refreshLobbyList_=function(a){this.lobbyList_.empty();var b=a.filter(function(a){var b=this.levelConfig_.showClientsInLobby,c=this.levelConfig_.showRoutersInLobby,d=a.getNodeType();return d===g.CLIENT&&b||d===g.ROUTER&&c}.bind(this));b.sort(function(a,b){return a.getDisplayName()>b.getDisplayName()?1:-1}),this.selectedListItem_=void 0,b.forEach(function(a){var b=$("<li>").html(a.getDisplayName()+" : "+a.getStatus()+" "+a.getStatusDetail());a.getNodeType()===g.ROUTER?b.addClass("router-row"):(b.addClass("user-row"),a.entityID===this.connection_.myNode.entityID&&b.addClass("own-row")),a.entityID===this.selectedID_&&(b.addClass("selected-row"),this.selectedListItem_=b),b.click(this.onRowClick_.bind(this,b,a)),b.appendTo(this.lobbyList_)}.bind(this)),this.onSelectionChange()},j.prototype.onRowClick_=function(a,b){if(g.CLIENT!==b.getNodeType()){var c=this.selectedID_,d=this.selectedListItem_;d&&d.removeClass("selected-row"),this.selectedID_=void 0,this.selectedListItem_=void 0,b.entityID!==c&&(this.selectedID_=b.entityID,this.selectedListItem_=a,this.selectedListItem_.addClass("selected-row")),this.onSelectionChange()
}},j.prototype.onSelectionChange=function(){this.connectButton_.attr("disabled",void 0===this.selectedListItem_)},j.prototype.getUserSections_=function(a){var b=$.ajax({dataType:"json",url:"/v2/sections/membership"}),c=$.ajax({dataType:"json",url:"/v2/sections"});$.when(b,c).done(function(b,c){var d=b[0],e=c[0];a(d.concat(e))})}},{"../utils":238,"./NetSimLobby.html":141,"./NetSimLogger":148,"./netsimConstants":184,"./netsimNodeFactory":185}],185:[function(a,b){"use strict";var c=a("./netsimConstants"),d=a("./NetSimClientNode"),e=a("./NetSimRouterNode"),f=c.NodeType,g=b.exports;g.nodesFromRows=function(a,b){return b.map(function(b){if(b.type===f.CLIENT)return new d(a,b);if(b.type==f.ROUTER)return new e(a,b);throw new Error("Unable to map row to node.")})}},{"./NetSimClientNode":127,"./NetSimRouterNode":161,"./netsimConstants":184}],141:[function(require,module,exports){module.exports=function(){var t=function anonymous(locals,filters,escape){escape=escape||function(a){return String(a).replace(/&(?!\w+;)/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")};var buf=[];with(locals||{})!function(){buf.push('<div id="netsim_lobby_open" class="netsim-panel netsim-lobby">\n  <h1>Lobby</h1>\n  <div class="panel-body">\n    <div id="display_name_view">\n      <label for="netsim_lobby_name">My Name:</label>\n      <input id="netsim_lobby_name" type="text" />\n      <input id="netsim_lobby_set_name_button" type="button" value="Set Name" />\n    </div>\n    <div id="shard_view">\n      <label for="netsim_shard_select">My Section:</label>\n      <select id="netsim_shard_select"></select>\n      <span id="netsim_not_connected_note">You are not connected. Select a class section from the list to connect.</span>\n      <a class="shardLink" href="#">Share this private network</a>\n      '),level.showAddRouterButton&&buf.push('\n        <input type="button" id="netsim_lobby_add_router" value="Add Router" />\n      '),buf.push('\n      <ul id="netsim_lobby_list"></ul>\n      <input type="button" id="netsim_lobby_connect" value="Connect" />\n    </div>\n  </div>\n</div>\n')}();return buf.join("")};return function(a){return t(a,require("ejs").filters)}}()},{ejs:259}],138:[function(a,b){"use strict";var c=a("./NetSimEncodingControl.html"),d=a("./netsimConstants").EncodingType,e=b.exports=function(a,b,c){this.rootDiv_=a,this.levelConfig_=b,this.changeEncodingCallback_=c,this.checkboxes_=null,this.render()};e.prototype.render=function(){var a=$(c({level:this.levelConfig_}));this.rootDiv_.html(a),this.checkboxes_=this.rootDiv_.find('input[type="checkbox"][name="encoding_checkboxes"]'),this.checkboxes_.change(this.onCheckboxesChange_.bind(this))},e.prototype.onCheckboxesChange_=function(){var a=[];this.checkboxes_.filter(":checked").each(function(b,c){a.push(c.value)}),this.changeEncodingCallback_(a)},e.prototype.setEncodings=function(a){this.checkboxes_.each(function(b,c){$(c).attr("checked",a.indexOf(c.value)>-1)})};var f=function(a){return a.map(function(a){return"tr."+a}).join(", ")};e.hideRowsByEncoding=function(a,b){var c=[];for(var e in d)d.hasOwnProperty(e)&&-1===b.indexOf(d[e])&&c.push(d[e]);a.find(f(b)).show(),a.find(f(c)).hide()}},{"./NetSimEncodingControl.html":137,"./netsimConstants":184}],137:[function(require,module,exports){module.exports=function(){var t=function anonymous(locals,filters,escape){escape=escape||function(a){return String(a).replace(/&(?!\w+;)/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")};var buf=[];with(locals||{})!function(){function a(a,b){var c=["encoding_checkboxes_"+a];-1===level.showEncodingControls.indexOf(a)&&c.push("hidden-control"),buf.push('\n    <div class="',escape(c.join(" ")),'">\n      <input type="checkbox"\n             name="encoding_checkboxes"\n             id="encoding_checkboxes_',escape(a),'"\n             value="',escape(a),'"\n          />\n      <label for="encoding_checkboxes_',escape(a),'">',escape(b),"</label>\n    </div>\n    ")}buf.push("");var b=require("./netsimConstants").EncodingType,c=require("../../locale/current/netsim");buf.push('\n<div class="netsim-encoding-selector">\n  <h1>',escape(c.encoding()),"</h1>\n  "),a(b.ASCII,c.ascii()),buf.push("\n  "),a(b.DECIMAL,c.decimal()),buf.push("\n  "),a(b.HEXADECIMAL,c.hexadecimal()),buf.push("\n  "),a(b.BINARY,c.binary()),buf.push("\n  "),a(b.A_AND_B,c.a_and_b()),buf.push("\n</div>")}();return buf.join("")};return function(a){return t(a,require("ejs").filters)}}()},{"../../locale/current/netsim":248,"./netsimConstants":184,ejs:259}],134:[function(a,b){"use strict";var c=a("./NetSimDnsTab.html"),d=a("./netsimConstants").DnsMode,e=a("./NetSimDnsModeControl"),f=a("./NetSimDnsManualControl"),g=a("./NetSimDnsTable"),h=b.exports=function(a,b,c,d){this.rootDiv_=a,this.levelConfig_=b,this.dnsModeChangeCallback_=c,this.becomeDnsCallback_=d,this.dnsModeControl_=null,this.dnsManualControl_=null,this.dnsTable_=null,this.render()};h.prototype.render=function(){var a=$(c({level:this.levelConfig_}));this.rootDiv_.html(a),this.levelConfig_.showDnsModeControl&&(this.dnsModeControl_=new e(this.rootDiv_.find(".dns_mode"),this.dnsModeChangeCallback_)),this.dnsManualControl_=new f(this.rootDiv_.find(".dns_manual_control"),this.becomeDnsCallback_),this.dnsTable_=new g(this.rootDiv_.find(".dns_table"))},h.prototype.setDnsMode=function(a){this.dnsModeControl_&&this.dnsModeControl_.setDnsMode(a),this.dnsTable_.setDnsMode(a),this.rootDiv_.find(".dns_manual_control").toggle(a===d.MANUAL),this.rootDiv_.find(".dns-notes").toggle(a!==d.NONE)},h.prototype.setIsDnsNode=function(a){this.dnsManualControl_.setIsDnsNode(a)},h.prototype.setDnsTableContents=function(a){this.dnsTable_.setDnsTableContents(a)}},{"./NetSimDnsManualControl":130,"./NetSimDnsModeControl":132,"./NetSimDnsTab.html":133,"./NetSimDnsTable":136,"./netsimConstants":184}],136:[function(a,b){"use strict";var c=a("./NetSimDnsTable.html"),d=a("./netsimConstants").DnsMode,e=b.exports=function(a){this.rootDiv_=a,this.dnsMode_=d.NONE,this.addressTableData_=[],this.render()};e.prototype.render=function(){var a=$(c({dnsMode:this.dnsMode_,tableData:this.addressTableData_}));this.rootDiv_.html(a)},e.prototype.setDnsMode=function(a){this.dnsMode_=a,this.render()},e.prototype.setDnsTableContents=function(a){this.addressTableData_=a,this.render()}},{"./NetSimDnsTable.html":135,"./netsimConstants":184}],135:[function(require,module,exports){module.exports=function(){var t=function anonymous(locals,filters,escape){escape=escape||function(a){return String(a).replace(/&(?!\w+;)/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")};var buf=[];with(locals||{})!function(){buf.push("");var a=require("./netsimConstants").DnsMode;buf.push('\n<div class="netsim-dns-table">\n  <h1>My Network</h1>\n  <table>\n    <thead>\n    <tr>\n      <th>Hostname</th>\n      <th>Address</th>\n    </tr>\n    </thead>\n    <tbody>\n    '),tableData.forEach(function(b){var c=b.hostname,d="",e=[];(dnsMode===a.NONE||b.isDnsNode||b.isLocal)&&(d=b.address),b.isLocal&&(c+=" (Me)",e.push("local-node")),b.isDnsNode&&dnsMode!==a.NONE&&(c+=" (DNS)",e.push("dns-node")),buf.push('\n        <tr class="',escape(e.join(" ")),'">\n          <td>',escape(c),"</td>\n          <td>",escape(d),"</td>\n        </tr>\n      ")}),buf.push("\n    </tbody>\n  </table>\n</div>")}();return buf.join("")};return function(a){return t(a,require("ejs").filters)}}()},{"./netsimConstants":184,ejs:259}],133:[function(require,module,exports){module.exports=function(){var t=function anonymous(locals,filters,escape){escape=escape||function(a){return String(a).replace(/&(?!\w+;)/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")};var buf=[];with(locals||{})!function(){buf.push('<div class="netsim-dns-tab">\n  '),level.showDnsModeControl&&buf.push('\n  <div class="dns_mode"></div>\n  '),buf.push('\n  <div class="dns_manual_control"></div>\n  <div class="dns_table"></div>\n  <div class="dns-notes">\n    <h1>Notes</h1>\n    <div>\n      <textarea></textarea>\n    </div>\n  </div>\n</div>\n')}();return buf.join("")};return function(a){return t(a,require("ejs").filters)}}()},{ejs:259}],132:[function(a,b){"use strict";var c=a("./NetSimDnsModeControl.html"),d=a("./netsimConstants").DnsMode,e=b.exports=function(a,b){this.rootDiv_=a,this.dnsModeChangeCallback_=b,this.dnsModeRadios_=null,this.currentDnsMode_=d.NONE,this.render()};e.prototype.render=function(){var a=$(c({}));this.rootDiv_.html(a),this.dnsModeRadios_=this.rootDiv_.find('input[type="radio"][name="dns_mode"]'),this.dnsModeRadios_.change(this.onDnsModeChange_.bind(this)),this.setDnsMode(this.currentDnsMode_)},e.prototype.onDnsModeChange_=function(){var a=this.dnsModeRadios_.filter(":checked").val();this.dnsModeChangeCallback_(a)},e.prototype.setDnsMode=function(a){this.currentDnsMode_=a,this.dnsModeRadios_.filter('[value="'+a+'"]').prop("checked",!0)}},{"./NetSimDnsModeControl.html":131,"./netsimConstants":184}],131:[function(require,module,exports){module.exports=function(){var t=function anonymous(locals,filters,escape){escape=escape||function(a){return String(a).replace(/&(?!\w+;)/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")};var buf=[];with(locals||{})!function(){function a(a,b){buf.push('\n    <div class="dns_mode_',escape(a),'">\n      <input id="dns_mode_',escape(a),'"\n                   type="radio"\n                   name="dns_mode"\n                   value="',escape(a),'" />\n      <label for="dns_mode_',escape(a),'">',escape(b),"</label>\n    </div>\n    ")}buf.push("");var b=require("./netsimConstants").DnsMode,c=require("../../locale/current/netsim");buf.push('\n<div class="dns-mode-control">\n  <h1>',escape(c.dnsMode()),"</h1>\n  "),a(b.NONE,c.dnsMode_NONE()),buf.push("\n  "),a(b.MANUAL,c.dnsMode_MANUAL()),buf.push("\n  "),a(b.AUTOMATIC,c.dnsMode_AUTOMATIC()),buf.push("\n</div>\n")}();return buf.join("")};return function(a){return t(a,require("ejs").filters)}}()},{"../../locale/current/netsim":248,"./netsimConstants":184,ejs:259}],130:[function(a,b){"use strict";var c=a("./NetSimDnsManualControl.html"),d=b.exports=function(a,b){this.rootDiv_=a,this.becomeDnsCallback_=b,this.render()};d.prototype.render=function(){var a=$(c({}));this.rootDiv_.html(a),this.rootDiv_.find('input[type="button"]').click(this.onBecomeDnsButtonClick_.bind(this))},d.prototype.onBecomeDnsButtonClick_=function(){this.becomeDnsCallback_()},d.prototype.setIsDnsNode=function(a){this.rootDiv_.find('input[type="button"]').attr("disabled",a)}},{"./NetSimDnsManualControl.html":129}],129:[function(require,module,exports){module.exports=function(){var t=function anonymous(locals,filters,escape){escape=escape||function(a){return String(a).replace(/&(?!\w+;)/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")};var buf=[];with(locals||{})!function(){buf.push('<div class="netsim_dns_manual_control">\n  <h1>Manual Control</h1>\n  <input id="become_dns_button" type="button" value="Take over as DNS" />\n</div>')}();return buf.join("")};return function(a){return t(a,require("ejs").filters)}}()},{ejs:259}],128:[function(a,b){"use strict";var c=a("./netsimConstants").NodeType,d=a("./NetSimLogger"),e=a("./NetSimClientNode"),f=a("./NetSimRouterNode"),g=a("./NetSimLocalClientNode"),h=a("../ObservableEvent"),i=a("./NetSimShard"),j=a("./NetSimShardCleaner"),k=d.getSingleton(),l=b.exports=function(a){this.displayName_="",this.levelConfig_=a.levelConfig||{},this.sentLog_=a.sentLog,this.receivedLog_=a.receivedLog,this.shard_=null,this.enableCleanup_=void 0!==a.enableCleanup?a.enableCleanup:!0,this.shardCleaner_=null,this.myNode=null,this.shardChange=new h,this.statusChanges=new h,a.window.addEventListener("beforeunload",this.onBeforeUnload_.bind(this))};l.prototype.attachToRunLoop=function(a){a.tick.register(this.tick.bind(this))},l.prototype.tick=function(a){this.myNode&&(this.myNode.tick(a),this.shard_.tick(a),this.shardCleaner_.tick(a))},l.prototype.getLogger=function(){return k},l.prototype.onBeforeUnload_=function(){this.isConnectedToShard()&&this.disconnectFromShard()},l.prototype.connectToShard=function(a,b){return this.isConnectedToShard()?(k.warn("Auto-closing previous connection..."),void this.disconnectFromShard(this.connectToShard.bind(this,a,b))):(this.shard_=new i(a),this.enableCleanup_&&(this.shardCleaner_=new j(this.shard_)),void this.createMyClientNode_(b))},l.prototype.disconnectFromShard=function(a){return a=a||function(){},this.isConnectedToShard()?(this.isConnectedToRouter()&&this.disconnectFromRouter(),this.myNode.stopSimulation(),void this.myNode.destroy(function(b,c){return b?void a(b,c):(this.myNode=null,this.shardChange.notifyObservers(null,null),this.statusChanges.notifyObservers(),void a(b,c))}.bind(this))):(k.warn("Redundant disconnect call."),void a(null,null))},l.prototype.createMyClientNode_=function(a){g.create(this.shard_,function(b,c){return null!==b?void k.error("Failed to create client node; "+b.message):(this.myNode=c,this.myNode.setDisplayName(a),this.myNode.setLostConnectionCallback(this.disconnectFromShard.bind(this)),this.myNode.initializeSimulation(this.levelConfig_,this.sentLog_,this.receivedLog_),void this.myNode.update(function(){this.shardChange.notifyObservers(this.shard_,this.myNode),this.statusChanges.notifyObservers()}.bind(this)))}.bind(this))},l.prototype.isConnectedToShard=function(){return null!==this.myNode},l.prototype.getAllNodes=function(a){if(!this.isConnectedToShard())return k.warn("Can't get lobby rows, not connected to shard."),void a([]);var b=this;this.shard_.nodeTable.readAll(function(d,g){if(null!==d)return k.warn("Lobby data request failed, using empty list."),void a([]);var h=g.map(function(a){return a.type===c.CLIENT?new e(b.shard_,a):a.type===c.ROUTER?new f(b.shard_,a):void 0}).filter(function(a){return void 0!==a});a(h)})},l.prototype.addRouterToLobby=function(){f.create(this.shard_,function(a,b){b.bandwidth=this.levelConfig_.defaultRouterBandwidth,b.dnsMode=this.levelConfig_.defaultDnsMode,b.update(function(){this.statusChanges.notifyObservers()}.bind(this))}.bind(this))},l.prototype.isConnectedToRouter=function(){return this.myNode&&this.myNode.myRouter},l.prototype.connectToRouter=function(a){this.isConnectedToRouter()&&(k.warn("Auto-disconnecting from previous router."),this.disconnectFromRouter());var b=this;f.get(a,this.shard_,function(c,d){return null!==c?void k.warn("Failed to find router with ID "+a+"; "+c.message):void b.myNode.connectToRouter(d,function(a){a&&k.warn("Failed to connect to "+d.getDisplayName()+"; "+a.message),b.statusChanges.notifyObservers()})})},l.prototype.disconnectFromRouter=function(){if(!this.isConnectedToRouter())return void k.warn("Cannot disconnect: Not connected.");var a=this;this.myNode.disconnectRemote(function(){a.statusChanges.notifyObservers()})}},{"../ObservableEvent":1,"./NetSimClientNode":127,"./NetSimLocalClientNode":143,"./NetSimLogger":148,"./NetSimRouterNode":161,"./NetSimShard":166,"./NetSimShardCleaner":167,"./netsimConstants":184}],167:[function(a,b){"use strict";var c=a("../utils"),d=a("../commands"),e=d.Command,f=d.CommandSequence,g=a("./NetSimEntity"),h=a("./NetSimHeartbeat"),i=a("./NetSimNode"),j=a("./NetSimWire"),k=a("./NetSimMessage"),l=a("./NetSimLogEntry"),m=a("./NetSimLogger"),n=m.getSingleton(),o=12e4,p=6e5,q=6e4,r=function(a,b){b=void 0!==b?b:{},h.call(this,a,b),this.nodeID_=0};r.inherits(h),r.create=function(a,b){g.create(r,a,b)},r.getAllCurrent=function(a,b){a.heartbeatTable.readAll(function(c,d){if(c)return void b(c,null);var e=d.filter(function(a){return a.cleaner===!0&&Date.now()-a.time<q}).map(function(b){return new r(a,b)});b(null,e)})},r.prototype.buildRow_=function(){return c.extend(r.superPrototype.buildRow_.call(this),{cleaner:!0})};var s=b.exports=function(a){this.shard_=a,this.nextAttemptTime_=Date.now(),this.heartbeat_=null};s.prototype.tick=function(a){Date.now()>=this.nextAttemptTime_&&(this.nextAttemptTime_=Date.now()+o,this.cleanShard()),this.heartbeat_&&this.heartbeat_.tick(a),this.steps_&&(this.steps_.tick(a),this.steps_.isFinished()&&(this.steps_=void 0))},s.prototype.cleanShard=function(){this.getCleaningLock(function(a){return a?void n.warn(a.message):(this.steps_=new f([new t(this,"heartbeat",this.shard_.heartbeatTable),new w(this),new t(this,"heartbeat",this.shard_.heartbeatTable),new t(this,"node",this.shard_.nodeTable),new x(this),new t(this,"node",this.shard_.nodeTable),new t(this,"wire",this.shard_.wireTable),new y(this),new t(this,"message",this.shard_.messageTable),new z(this),new t(this,"log",this.shard_.logTable),new A(this),new v(this)]),void this.steps_.begin())}.bind(this))},s.prototype.hasCleaningLock=function(){return null!==this.heartbeat_},s.prototype.getCleaningLock=function(a){r.create(this.shard_,function(b,c){return b?void a(b,null):void r.getAllCurrent(this.shard_,function(b,d){return b||d.length>1?void c.destroy(function(){a(new Error("Failed to acquire cleaning lock"),null)}):(this.heartbeat_=c,n.info("Cleaning lock acquired"),void a(null,null))}.bind(this))}.bind(this))},s.prototype.releaseCleaningLock=function(a){this.heartbeat_.destroy(function(b){this.heartbeat_=null,this.nextAttemptTime_=Date.now()+p,n.info("Cleaning lock released"),a(b,null)}.bind(this))},s.prototype.cacheTable=function(a,b){void 0===this.tableCache&&(this.tableCache={}),this.tableCache[a]=b},s.prototype.getTableCache=function(a){return this.tableCache[a]},s.prototype.getShard=function(){return this.shard_};var t=function(a,b,c){e.call(this),this.cleaner_=a,this.key_=b,this.table_=c};t.inherits(e),t.prototype.onBegin_=function(){this.table_.readAll(function(a,b){this.cleaner_.cacheTable(this.key_,b),this.succeed()}.bind(this))};var u=function(a){e.call(this),this.entity_=a};u.inherits(e),u.prototype.onBegin_=function(){this.entity_.destroy(function(a){return a?void this.fail():(n.info("Deleted entity"),void this.succeed())}.bind(this))};var v=function(a){e.call(this),this.cleaner_=a};v.inherits(e),v.prototype.onBegin_=function(){this.cleaner_.releaseCleaningLock(function(a){a?this.succeed():this.fail()}.bind(this))};var w=function(a){f.call(this),this.cleaner_=a};w.inherits(f),w.prototype.onBegin_=function(){var a=this.cleaner_.getTableCache("heartbeat");this.commandList_=a.filter(function(a){return Date.now()-a.time>q}).map(function(a){return new u(new h(this.cleaner_.getShard(),a))}.bind(this)),f.prototype.onBegin_.call(this)};var x=function(a){f.call(this),this.cleaner_=a};x.inherits(f),x.prototype.onBegin_=function(){var a=this.cleaner_.getTableCache("heartbeat"),b=this.cleaner_.getTableCache("node");this.commandList_=b.filter(function(b){return a.every(function(a){return a.nodeID!==b.id})}).map(function(a){return new u(new i(this.cleaner_.getShard(),a))}.bind(this)),f.prototype.onBegin_.call(this)};var y=function(a){f.call(this),this.cleaner_=a};y.inherits(f),y.prototype.onBegin_=function(){var a=this.cleaner_.getTableCache("node"),b=this.cleaner_.getTableCache("wire");this.commandList_=b.filter(function(b){return!(a.some(function(a){return a.id===b.localNodeID})&&a.some(function(a){return a.id===b.remoteNodeID}))}).map(function(a){return new u(new j(this.cleaner_.getShard(),a))}.bind(this)),f.prototype.onBegin_.call(this)};var z=function(a){f.call(this),this.cleaner_=a};z.inherits(f),z.prototype.onBegin_=function(){var a=this.cleaner_.getTableCache("node"),b=this.cleaner_.getTableCache("message");this.commandList_=b.filter(function(b){return a.every(function(a){return a.id!==b.toNodeID})}).map(function(a){return new u(new k(this.cleaner_.getShard(),a))}.bind(this)),f.prototype.onBegin_.call(this)};var A=function(a){f.call(this),this.cleaner_=a};A.inherits(f),A.prototype.onBegin_=function(){var a=this.cleaner_.getTableCache("node"),b=this.cleaner_.getTableCache("log");this.commandList_=b.filter(function(b){return a.every(function(a){return a.id!==b.nodeID})}).map(function(a){return new u(new l(this.cleaner_.getShard(),a))}.bind(this)),f.prototype.onBegin_.call(this)}},{"../commands":52,"../utils":238,"./NetSimEntity":139,"./NetSimHeartbeat":140,"./NetSimLogEntry":144,"./NetSimLogger":148,"./NetSimMessage":149,"./NetSimNode":152,"./NetSimWire":177}],166:[function(a,b){"use strict";var c=a("../clientApi").SharedTable,d=a("./NetSimTable"),e="HQJ8GCCMGP7Yh8MrtDusIA==";window&&window.location&&window.location.hostname&&"localhost"===window.location.hostname.split(".")[0]&&(e="JGW2rHUp_UCMW_fQmRf6iQ==");var f=b.exports=function(a){this.nodeTable=new d(new c(e,a+"_n")),this.wireTable=new d(new c(e,a+"_w")),this.messageTable=new d(new c(e,a+"_m")),this.messageTable.setPollingInterval(3e3),this.logTable=new d(new c(e,a+"_l")),this.logTable.setPollingInterval(1e4),this.heartbeatTable=new d(new c(e,a+"_h"))};f.prototype.tick=function(a){this.nodeTable.tick(a),this.wireTable.tick(a),this.messageTable.tick(a),this.logTable.tick(a)}},{"../clientApi":50,"./NetSimTable":170}],170:[function(a,b){"use strict";var c=a("../utils").getLodash(),d=a("../ObservableEvent"),e=5e3,f=b.exports=function(a){this.remoteTable_=a,this.tableChange=new d,this.cache_={},this.lastFullUpdateTime_=0,this.pollingInterval_=e};f.prototype.readAll=function(a){this.remoteTable_.readAll(function(b,c){a(b,c),null===b&&this.fullCacheUpdate_(c)}.bind(this))},f.prototype.read=function(a,b){this.remoteTable_.read(a,function(c,d){b(c,d),null===c&&this.updateCacheRow_(a,d)}.bind(this))},f.prototype.create=function(a,b){this.remoteTable_.create(a,function(a,c){b(a,c),null===a&&this.addRowToCache_(c)}.bind(this))},f.prototype.update=function(a,b,c){this.remoteTable_.update(a,b,function(d,e){c(d,e),null===d&&this.updateCacheRow_(a,b)}.bind(this))},f.prototype["delete"]=function(a,b){this.remoteTable_["delete"](a,function(c,d){b(c,d),null===c&&this.removeRowFromCache_(a)}.bind(this))},f.prototype.fullCacheUpdate_=function(a){var b=a.reduce(function(a,b){return a[b.id]=b,a},{});c.isEqual(this.cache_,b)||(this.cache_=b,this.tableChange.notifyObservers(this.arrayFromCache_())),this.lastFullUpdateTime_=Date.now()},f.prototype.addRowToCache_=function(a){this.cache_[a.id]=a,this.tableChange.notifyObservers(this.arrayFromCache_())},f.prototype.removeRowFromCache_=function(a){void 0!==this.cache_[a]&&(delete this.cache_[a],this.tableChange.notifyObservers(this.arrayFromCache_()))},f.prototype.updateCacheRow_=function(a,b){var d=this.cache_[a],e=b;e.id=a,c.isEqual(d,e)||(this.cache_[a]=e,this.tableChange.notifyObservers(this.arrayFromCache_()))},f.prototype.arrayFromCache_=function(){var a=[];for(var b in this.cache_)this.cache_.hasOwnProperty(b)&&a.push(this.cache_[b]);return a},f.prototype.setPollingInterval=function(a){this.pollingInterval_=a},f.prototype.tick=function(){var a=Date.now();a-this.lastFullUpdateTime_>this.pollingInterval_&&(this.lastFullUpdateTime_=a,this.readAll(function(){}))}},{"../ObservableEvent":1,"../utils":238}],161:[function(a,b){"use strict";var c=a("../utils"),d=a("../../locale/current/netsim"),e=a("./netsimConstants"),f=a("./netsimUtils"),g=a("./NetSimNode"),h=a("./NetSimEntity"),i=a("./NetSimLogEntry"),j=a("./NetSimLogger"),k=a("./NetSimWire"),l=a("./NetSimMessage"),m=a("./NetSimHeartbeat"),n=a("../ObservableEvent"),o=a("./Packet"),p=a("./dataConverters"),q=c.getLodash(),r=f.serializeNumber,s=f.deserializeNumber,t=p.intToBinary,u=p.asciiToBinary,v=e.DnsMode,w=e.NodeType,x=e.BITS_PER_BYTE,y=e.BITS_PER_NIBBLE,z=j.getSingleton(),A=6,B=0,C=15,D="dns",E="NOT_FOUND",F=b.exports=function(a,b){b=void 0!==b?b:{},g.call(this,a,b),this.dnsMode=c.valueOr(b.dnsMode,v.NONE),this.dnsNodeID=b.dnsNodeID,this.bandwidth=c.valueOr(s(b.bandwidth),1/0),this.simulateForSender_=void 0,this.simulationTime_=0,this.packetSpec_=[],this.heartbeat_=null,this.stateCache_={},this.stateChange=new n,this.myWireRowCache_=[],this.wiresChange=new n,this.myLogRowCache_=[],this.logChange=new n,this.isRouterProcessing_=!1,this.routerQueueCache_=[],this.localRoutingSchedule_=[],this.isAutoDnsProcessing_=!1,this.autoDnsQueue_=[]};F.inherits(g),F.create=function(a,b){h.create(F,a,function(c,d){return null!==c?void b(c,null):void m.getOrCreate(a,d.entityID,function(a,c){return null!==a?void b(a,null):(d.heartbeat_=c,d.heartbeat_.setBeatInterval(12e3),void d.update(function(a){b(a,d)}))})})},F.get=function(a,b,c){h.get(F,a,b,function(d,e){return null!==d?void c(d,null):void m.getOrCreate(b,a,function(a,b){return null!==a?void c(a,null):(e.heartbeat_=b,e.heartbeat_.setBeatInterval(12e3),void c(null,e))})})},F.RouterStatus={INITIALIZING:"Initializing",READY:"Ready",FULL:"Full"};var G=F.RouterStatus;F.prototype.buildRow_=function(){return c.extend(F.superPrototype.buildRow_.call(this),{bandwidth:r(this.bandwidth),dnsMode:this.dnsMode,dnsNodeID:this.dnsNodeID})},F.prototype.onMyStateChange_=function(a){this.bandwidth=s(a.bandwidth),this.dnsMode=a.dnsMode,this.dnsNodeID=a.dnsNodeID,this.stateChange.notifyObservers(this)},F.prototype.tick=function(a){this.simulationTime_=a.time,this.heartbeat_.tick(a),this.routeOverdueMessages_.call(this,a),this.dnsMode===v.AUTOMATIC&&this.tickAutoDns_(a)},F.prototype.routeOverdueMessages_=function(a){if(!this.isRouterProcessing_){var b=[];if(this.localRoutingSchedule_.forEach(function(c){a.time>=c.processingCompleteTime&&(c.beingRouted=!0,b.push(c))}),0!==b.length){var c=b.map(function(a){return new l(this.shard_,a.row)}.bind(this));this.isRouterProcessing_=!0,this.routeMessages_(c,function(){this.localRoutingSchedule_=this.localRoutingSchedule_.filter(function(a){return!a.beingRouted}),this.isRouterProcessing_=!1}.bind(this))}}},F.prototype.scheduleNewPackets=function(){for(var a,b,c,d=0;d<this.routerQueueCache_.length;d++)if(a=this.routerQueueCache_[d],b=this.localSimulationOwnsMessageRow_(a),c=!this.isScheduled(a),b&&c){var e=this.routerQueueCache_.slice(0,d+1).reduce(function(a,b){return a+this.calculateProcessingDurationForMessage_(b)}.bind(this),this.simulationTime_);this.scheduleRouting(a,e)}},F.prototype.scheduleRouting=function(a,b){this.localRoutingSchedule_.push({row:a,processingCompleteTime:b,beingRouted:!1})},F.prototype.isScheduled=function(a){return void 0!==q.find(this.localRoutingSchedule_,function(b){return b.row.id===a.id})},F.prototype.tickAutoDns_=function(){if(!this.isAutoDnsProcessing_){var a=this.autoDnsQueue_.filter(this.localSimulationOwnsMessageRow_.bind(this)).map(function(a){return new l(this.shard_,a)}.bind(this));0!==a.length&&(this.isAutoDnsProcessing_=!0,this.processAutoDnsRequests_(a,function(){this.isAutoDnsProcessing_=!1}.bind(this)))}},F.prototype.update=function(a){a=a||function(){};var b=this;this.countConnections(function(c,d){b.status_=d>=A?G.FULL:G.READY,b.statusDetail_="("+d+"/"+A+")",F.superPrototype.update.call(b,a)})},F.prototype.getDisplayName=function(){return d.routerX({x:this.entityID})},F.prototype.getHostname=function(){return this.getDisplayName().replace(/[^\w\d]/g,"").toLowerCase()},F.prototype.getNodeType=function(){return w.ROUTER},F.prototype.validatePacketSpec_=function(a){a.some(function(a){return a.key===o.HeaderType.TO_ADDRESS})||z.error("Packet specification does not have a toAddress field."),a.some(function(a){return a.key===o.HeaderType.FROM_ADDRESS})||z.error("Packet specification does not have a fromAddress field.")},F.prototype.initializeSimulation=function(a,b){if(this.simulateForSender_=a,this.packetSpec_=b,this.validatePacketSpec_(b),void 0!==a){var c=this.shard_.nodeTable.tableChange,d=this.onNodeTableChange_.bind(this);this.nodeChangeKey_=c.register(d),z.info("Router registered for nodeTable tableChange");var e=this.shard_.wireTable.tableChange,f=this.onWireTableChange_.bind(this);this.wireChangeKey_=e.register(f),z.info("Router registered for wireTable tableChange");var g=this.shard_.logTable.tableChange,h=this.onLogTableChange_.bind(this);this.logChangeKey_=g.register(h),z.info("Router registered for logTable tableChange");var i=this.shard_.messageTable.tableChange,j=this.onMessageTableChange_.bind(this);this.newMessageEventKey_=i.register(j),z.info("Router registered for messageTable tableChange")}},F.prototype.stopSimulation=function(){if(void 0!==this.nodeChangeKey_){var a=this.shard_.messageTable.tableChange;a.unregister(this.nodeChangeKey_),this.nodeChangeKey_=void 0,z.info("Router unregistered from nodeTable tableChange")}if(void 0!==this.wireChangeKey_){var b=this.shard_.messageTable.tableChange;b.unregister(this.wireChangeKey_),this.wireChangeKey_=void 0,z.info("Router unregistered from wireTable tableChange")}if(void 0!==this.logChangeKey_){var c=this.shard_.messageTable.tableChange;c.unregister(this.logChangeKey_),this.logChangeKey_=void 0,z.info("Router unregistered from logTable tableChange")}if(void 0!==this.newMessageEventKey_){var d=this.shard_.messageTable.tableChange;d.unregister(this.newMessageEventKey_),this.newMessageEventKey_=void 0,z.info("Router unregistered from messageTable tableChange")}},F.prototype.setDnsMode=function(a){this.dnsMode!==a&&(this.dnsMode===v.NONE?this.dnsNodeID=void 0:this.dnsMode===v.AUTOMATIC&&(this.dnsNodeID=C),this.dnsMode=a,this.update())},F.prototype.setBandwidth=function(a){this.bandwidth!==a&&(this.bandwidth=a,this.update())},F.prototype.getConnections=function(a){a=a||function(){};var b=this.shard_,c=this.entityID;this.shard_.wireTable.readAll(function(d,e){if(d)return void a(d,[]);var f=e.map(function(a){return new k(b,a)}).filter(function(a){return a.remoteNodeID===c});a(null,f)})},F.prototype.countConnections=function(a){a=a||function(){},this.getConnections(function(b,c){a(b,c.length)})},F.prototype.log=function(a){i.create(this.shard_,this.entityID,a,function(){})};var H=function(a,b){return a.some(function(a){return a===b})};F.prototype.acceptConnection=function(a,b){var c=this;this.countConnections(function(a,d){return a?void b(a,!1):d>A?void b(new Error("Too many connections"),!1):void c.update(function(a){b(a,null===a)})})},F.prototype.requestAddress=function(a,b,c){c=c||function(){};var d=this;this.getConnections(function(e,f){if(e)return void c(e);for(var g=f.filter(function(a){return void 0!==a.localAddress}).map(function(a){return a.localAddress}),h=1;H(g,h);)h++;a.localAddress=h,a.localHostname=b,a.remoteAddress=B,a.remoteHostname=d.getHostname(),a.update(c)})},F.prototype.getAddressTable=function(){var a=this.myWireRowCache_.map(function(a){return{hostname:a.localHostname,address:a.localAddress,isLocal:a.localNodeID===this.simulateForSender_,isDnsNode:a.localNodeID===this.dnsNodeID}}.bind(this));return this.dnsMode===v.AUTOMATIC&&a.push({hostname:D,address:C,isLocal:!1,isDnsNode:!0}),a},F.prototype.getAddressForNodeID_=function(a){var b=q.find(this.myWireRowCache_,function(b){return b.localNodeID===a});return void 0!==b?b.localAddress:void 0},F.prototype.getAddressForHostname_=function(a){if(a===this.getHostname())return B;if(this.dnsMode===v.AUTOMATIC&&a===D)return C;var b=q.find(this.myWireRowCache_,function(b){return b.localHostname===a});return void 0!==b?b.localAddress:void 0},F.prototype.getNodeIDForAddress_=function(a){if(a===B)return this.entityID;if(this.dnsMode===v.AUTOMATIC&&a===C)return this.entityID;var b=q.find(this.myWireRowCache_,function(b){return b.localAddress===a});return void 0!==b?b.localNodeID:void 0},F.prototype.onNodeTableChange_=function(a){var b=q.find(a,function(a){return a.id===this.entityID}.bind(this));if(void 0===b)throw new Error("Unable to find router node in node table listing.");q.isEqual(this.stateCache_,b)||(this.stateCache_=b,z.info("Router state changed."),this.onMyStateChange_(b))},F.prototype.onWireTableChange_=function(a){var b=a.filter(function(a){return a.remoteNodeID===this.entityID}.bind(this));q.isEqual(this.myWireRowCache_,b)||(this.myWireRowCache_=b,this.wiresChange.notifyObservers())},F.prototype.onLogTableChange_=function(a){var b=a.filter(function(a){return a.nodeID===this.entityID}.bind(this));q.isEqual(this.myLogRowCache_,b)||(this.myLogRowCache_=b,z.info("Router logs changed."),this.logChange.notifyObservers())},F.prototype.getLog=function(){return this.myLogRowCache_.map(function(a){return new i(this.shard_,a,this.packetSpec_)
}.bind(this))},F.prototype.onMessageTableChange_=function(a){if(!this.simulateForSender_)throw new Error("Non-simulating router got message table change notifiction");this.updateRouterQueue_(a),this.dnsMode===v.AUTOMATIC&&this.updateAutoDnsQueue_(a)},F.prototype.updateRouterQueue_=function(a){var b=a.filter(this.isMessageToRouter_.bind(this));q.isEqual(this.routerQueueCache_,b)||(this.routerQueueCache_=b,this.scheduleNewPackets())},F.prototype.isMessageToRouter_=function(a){return this.dnsMode===v.AUTOMATIC&&this.isMessageToAutoDns_(a)?!1:a.toNodeID===this.entityID},F.prototype.routeMessages_=function(a,b){return 0===a.length?void b(null):void this.routeMessage_(a[0],function(c,d){return c?void b(c,d):void this.routeMessages_(a.slice(1),b)}.bind(this))},F.prototype.routeMessage_=function(a,b){z.info("Destroying message..."),a.destroy(function(c,d){return c?void b(c,d):(z.info("Message destroyed."),void this.forwardMessageToRecipient_(a,b))}.bind(this))},F.prototype.forwardMessageToRecipient_=function(a,b){z.info("Forwarding message...");var c,d=this.entityID;try{var e=new o(this.packetSpec_,a.payload);c=e.getHeaderAsInt(o.HeaderType.TO_ADDRESS)}catch(f){return z.warn("Packet not readable by router"),this.log(a.payload),void b(null)}if(c===B)return z.warn("Packet stopped at router."),this.log(a.payload),void b(null);var g=this.getNodeIDForAddress_(c);return void 0===g?(z.warn("Destination address not in local network"),this.log(a.payload),void b(null)):void l.send(this.shard_,d,g,a.payload,function(c,d){this.log(a.payload),b(c,d)}.bind(this))},F.prototype.localSimulationOwnsMessageRow_=function(a){if(!this.simulateForSender_)return!1;var b,c,d,e,f=this.entityID;if(this.dnsMode===v.AUTOMATIC){b=new o(this.packetSpec_,a.payload),c=b.getHeaderAsInt(o.HeaderType.FROM_ADDRESS),d=b.getHeaderAsInt(o.HeaderType.TO_ADDRESS),e=this.getAddressForNodeID_(this.simulateForSender_);var g=a.fromNodeID===f&&a.toNodeID===f,h=c===e&&d===C||c===C&&d===e;if(g&&h)return!0}return a.fromNodeID===this.simulateForSender_&&a.toNodeID===f},F.prototype.calculateProcessingDurationForMessage_=function(a){return 1/0===this.bandwidth?0:1e3*a.payload.length/this.bandwidth},F.prototype.updateAutoDnsQueue_=function(a){var b=a.filter(this.isMessageToAutoDns_.bind(this));q.isEqual(this.autoDnsQueue_,b)||(this.autoDnsQueue_=b)},F.prototype.isMessageToAutoDns_=function(a){var b,c;try{b=new o(this.packetSpec_,a.payload),c=b.getHeaderAsInt(o.HeaderType.TO_ADDRESS)}catch(d){return z.warn("Packet not readable by auto-DNS: "+d),!1}return a.toNodeID===this.entityID&&a.fromNodeID===this.entityID&&c===C},F.prototype.processAutoDnsRequests_=function(a,b){h.destroyEntities(a,function(c,d){return c?void b(c,d):void this.generateDnsResponses_(a,b)}.bind(this))},F.prototype.generateDnsResponses_=function(a,b){return 0===a.length?void b(null):void this.generateDnsResponse_(a[0],function(c,d){return c?void b(c,d):void this.generateDnsResponses_(a.slice(1),b)}.bind(this))},F.prototype.generateDnsResponse_=function(a,b){var e,f,g,h,i,j,k=this.entityID,m=this.entityID;try{e=new o(this.packetSpec_,a.payload),f=e.getHeaderAsInt(o.HeaderType.FROM_ADDRESS),g=e.getBodyAsAscii(x)}catch(n){return void b(n)}var p=g.match(/GET\s+(\S.*)/);if(null!==p){var q=p[1].split(/\s+/).map(function(a){var b=this.getAddressForHostname_(a);return a+":"+c.valueOr(b,E)}.bind(this));i=q.join(" ")}else i=d.autoDnsUsageMessage();h={fromAddress:t(C,y),toAddress:t(f,y),packetIndex:t(1,y),packetCount:t(1,y)},j=e.encoder.concatenateBinary(h,u(i,x)),l.send(this.shard_,m,k,j,b)}},{"../../locale/current/netsim":248,"../ObservableEvent":1,"../utils":238,"./NetSimEntity":139,"./NetSimHeartbeat":140,"./NetSimLogEntry":144,"./NetSimLogger":148,"./NetSimMessage":149,"./NetSimNode":152,"./NetSimWire":177,"./Packet":178,"./dataConverters":180,"./netsimConstants":184,"./netsimUtils":186}],186:[function(a,b,c){"use strict";var d=a("../utils").getLodash(),e=a("../../locale/current/netsim"),f=a("./netsimConstants"),g=f.EncodingType;c.jQuerySvgElement=function(a){var b=$(document.createElementNS("http://www.w3.org/2000/svg",a));return b.addClass=function(a){var c=b.attr("class");return c?c.split(/\s+/g).some(function(b){return b===a})||b.attr("class",c+" "+a):b.attr("class",a),b},b},c.shouldShowTab=function(a,b){return a.showTabs.indexOf(b)>-1},c.getEncodingLabel=function(a){return a===g.ASCII?e.ascii():a===g.DECIMAL?e.decimal():a===g.HEXADECIMAL?e.hex():a===g.BINARY?e.binary():a===g.A_AND_B?e.a_and_b():""},c.forEachEnumValue=function(a,b){for(var c in a)a.hasOwnProperty(c)&&b(a[c])};var h=[{jsVal:1/0,jsonVal:"Infinity"},{jsVal:-1/0,jsonVal:"-Infinity"},{jsVal:0/0,jsonVal:"NaN"},{jsVal:void 0,jsonVal:"undefined"}],i=function(a){return a!==a};c.serializeNumber=function(a){var b=d.find(h,function(b){return b.jsVal===a||i(b.jsVal)&&i(a)});return b?b.jsonVal:a},c.deserializeNumber=function(a){var b=d.find(h,function(b){return b.jsonVal===a});return b?b.jsVal:a},c.scrubLevelConfiguration_=function(a){var b=d.clone(a,!0);return b.defaultPacketSizeLimit=c.deserializeNumber(b.defaultPacketSizeLimit),b.defaultRouterBandwidth=c.deserializeNumber(b.defaultRouterBandwidth),b}},{"../../locale/current/netsim":248,"../utils":238,"./netsimConstants":184}],144:[function(a,b){"use strict";a("../utils");var c=a("./NetSimEntity"),d=a("./Packet"),e=a("./dataConverters"),f=e.formatBinary,g=8,h=b.exports=function(a,b,e){b=void 0!==b?b:{},c.call(this,a,b),this.nodeID=b.nodeID,this.binary=void 0!==b.binary?b.binary:"",this.packet_=new d(e?e:[],this.binary),this.timestamp=void 0!==b.timestamp?b.timestamp:Date.now()};h.inherits(c),h.prototype.getTable_=function(){return this.shard_.logTable},h.prototype.buildRow_=function(){return{nodeID:this.nodeID,binary:this.binary,timestamp:this.timestamp}},h.create=function(a,b,c,d){var e=new h(a);e.nodeID=b,e.binary=c,e.timestamp=Date.now(),e.getTable_().create(e.buildRow_(),function(b,c){return null!==b?void d(b,null):void d(b,new h(a,c))})},h.prototype.getHeaderField=function(a){try{return this.packet_.getHeaderAsInt(a)}catch(b){return""}},h.prototype.getMessageBinary=function(){return f(this.packet_.getBodyAsBinary(),g)},h.prototype.getMessageAscii=function(){return this.packet_.getBodyAsAscii(g)}},{"../utils":238,"./NetSimEntity":139,"./Packet":178,"./dataConverters":180}],178:[function(a,b){"use strict";var c=a("./dataConverters").minifyBinary,d=a("./dataConverters"),e=b.exports=function(a,b){f(a),this.encoder=new e.Encoder(a),this.binary=b};e.HeaderType={TO_ADDRESS:"toAddress",FROM_ADDRESS:"fromAddress",PACKET_INDEX:"packetIndex",PACKET_COUNT:"packetCount"},e.prototype.getHeaderAsBinary=function(a){return this.encoder.getHeader(a,this.binary)},e.prototype.getHeaderAsInt=function(a){return this.encoder.getHeaderAsInt(a,this.binary)},e.prototype.getBodyAsBinary=function(){return this.encoder.getBody(this.binary)},e.prototype.getBodyAsAscii=function(a){return this.encoder.getBodyAsAscii(this.binary,a)};var f=function(a){for(var b={},c=0;c<a.length;c++){if(!a[c].hasOwnProperty("key"))throw new Error("Invalid packet format: Each field must have a key.");if(!a[c].hasOwnProperty("bits"))throw new Error("Invalid packet format: Each field must have a length.");if(b.hasOwnProperty(a[c].key))throw new Error("Invalid packet format: Field keys must be unique.");if(b[a[c].key]="used",1/0===a[c].bits)throw new Error("Invalid packet format: Infinity field length not allowed.")}};e.Encoder=function(a){f(a),this.formatSpec_=a},e.Encoder.prototype.getHeader=function(a,b){var d=0,e=0;for(b=c(b);this.formatSpec_[d].key!==a;)if(e+=this.formatSpec_[d].bits,d++,d>=this.formatSpec_.length)throw new Error('Key "'+a+'" not found in packet spec.');var f=b.slice(e,e+this.formatSpec_[d].bits);if(1/0!==this.formatSpec_[d].bits)for(;f.length<this.formatSpec_[d].bits;)f+="0";return f},e.Encoder.prototype.getHeaderAsInt=function(a,b){return d.binaryToInt(this.getHeader(a,b))},e.Encoder.prototype.getBody=function(a){return c(a).slice(e.Encoder.getHeaderLength(this.formatSpec_))},e.Encoder.getHeaderLength=function(a){return a.reduce(function(a,b){return a+b.bits},0)},e.Encoder.prototype.getBodyAsAscii=function(a,b){return d.binaryToAscii(this.getBody(a),b)},e.Encoder.prototype.makeBinaryHeaders=function(a){var b={};return this.formatSpec_.forEach(function(c){a.hasOwnProperty(c.key)&&(b[c.key]=d.intToBinary(a[c.key],c.bits))}),b},e.Encoder.prototype.concatenateBinary=function(a,b){var c=[];return this.formatSpec_.forEach(function(b){var e=a.hasOwnProperty(b.key)?a[b.key]:"";e=e.slice(0,b.bits),e=d.zeroPadLeft(e,b.bits),c.push(e)}),c.push(b),c.join("")}},{"./dataConverters":180}],180:[function(a,b,c){"use strict";a("../utils"),c.minifyBinary=function(a){return a.replace(/[^01]/g,"")},c.formatBinary=function(a,b){if(0>=b)throw new RangeError("Parameter chunkSize must be greater than zero");for(var d=c.minifyBinary(a),e=[],f=0;f<d.length;f+=b)e.push(d.substr(f,b));return e.join(" ")},c.minifyHex=function(a){return a.replace(/[^0-9A-F]/gi,"").toUpperCase()},c.minifyDecimal=function(a){return a.replace(/(^\s+|\s+$|[^0-9\s])/g,"").replace(/\s+/g," ")},c.formatHex=function(a,b){if(0>=b)throw new RangeError("Parameter chunkSize must be greater than zero");if(b%4!==0)return a;for(var d=b/4,e=c.minifyHex(a),f=[],g=0;g<e.length;g+=d)f.push(e.substr(g,d));return f.join(" ")},c.alignDecimal=function(a){if(""===a.replace(/\D/g,""))return"";var b=c.minifyDecimal(a).split(/\s+/),d=b.reduce(function(a,b){return b.length>a?b.length:a},0),e="0".repeat(d);return b.map(function(a){return(e+a).slice(-d)}).join(" ")},c.binaryToInt=function(a){return parseInt(c.minifyBinary(a),2)},c.zeroPadLeft=function(a,b){var c="0".repeat(b);return(c+a).slice(-b)},c.zeroPadRight=function(a,b){var c="0".repeat(b);return(a+c).substr(0,b)};var d=function(a,b,d){if(0>=d)throw new RangeError("Output width must be greater than zero");return c.zeroPadLeft(a.toString(b),d)};c.intToBinary=function(a,b){return d(a,2,b)},c.hexToInt=function(a){return parseInt(c.minifyHex(a),16)},c.intToHex=function(a,b){return d(a,16,b).toUpperCase()},c.hexToBinary=function(a){for(var b=c.minifyHex(a),d="",e=0;e<b.length;e++)d+=c.intToBinary(c.hexToInt(b.substr(e,1)),4);return d},c.binaryToHex=function(a){for(var b,d=4,e=[],f=c.minifyBinary(a),g=0;g<f.length;g+=d)b=c.zeroPadRight(f.substr(g,d),d),e.push(c.intToHex(c.binaryToInt(b),1));return e.join("")},c.decimalToBinary=function(a,b){return""===a.replace(/\D/g,"")?"":c.minifyDecimal(a).split(/\s+/).map(function(a){return c.intToBinary(parseInt(a,10),b)}).join("")},c.binaryToDecimal=function(a,b){for(var d,e=[],f=c.minifyBinary(a),g=0;g<f.length;g+=b)d=c.zeroPadRight(f.substr(g,b),b),e.push(c.binaryToInt(d));return e.join(" ")},c.asciiToBinary=function(a,b){for(var d=[],e=0;e<a.length;e++)d.push(c.intToBinary(a.charCodeAt(e),b));return d.join("")},c.binaryToAscii=function(a,b){if(0>=b)throw new RangeError("Parameter byteSize must be greater than zero");for(var d,e=[],f=c.minifyBinary(a),g=0;g<f.length;g+=b)d=c.zeroPadRight(f.substr(g,b),b),e.push(String.fromCharCode(c.binaryToInt(d)));return e.join("")}},{"../utils":238}],143:[function(a,b){"use strict";a("../utils");var c=a("./NetSimClientNode"),d=a("./NetSimEntity"),e=a("./NetSimMessage"),f=a("./NetSimHeartbeat"),g=a("./NetSimLogger"),h=a("../ObservableEvent"),i=g.getSingleton(),j=b.exports=function(a,b){c.call(this,a,b),this.myWire=null,this.myRouter=null,this.levelConfig_={},this.sentLog_=null,this.receivedLog_=null,this.heartbeat_=null,this.routerChange=new h,this.onNodeLostConnection_=void 0};j.inherits(c),j.create=function(a,b){d.create(j,a,function(c,d){return null!==c?void b(c,d):void f.getOrCreate(a,d.entityID,function(a,c){return null!==a?void b(a,null):(d.heartbeat_=c,d.heartbeat_.setFailureCallback(d.onFailedHeartbeat_.bind(d)),void b(null,d))})})},j.prototype.getStatus=function(){return this.status_?this.status_:"Online"},j.prototype.setDisplayName=function(a){this.displayName_=a},j.prototype.initializeSimulation=function(a,b,c){this.levelConfig_=a,this.sentLog_=b,this.receivedLog_=c;var d=this.shard_.messageTable.tableChange,e=this.onMessageTableChange_.bind(this);this.newMessageEventKey_=d.register(e),i.info("Local node registered for messageTable tableChange")},j.prototype.stopSimulation=function(){if(void 0!==this.newMessageEventKey_){var a=this.shard_.messageTable.tableChange;a.unregister(this.newMessageEventKey_),this.newMessageEventKey_=void 0,i.info("Local node registered for messageTable tableChange")}},j.prototype.tick=function(a){this.heartbeat_.tick(a),this.myRouter&&this.myRouter.tick(a)},j.prototype.onFailedHeartbeat_=function(){i.error("Heartbeat failed."),void 0!==this.onNodeLostConnection_&&this.onNodeLostConnection_()},j.prototype.setLostConnectionCallback=function(a){if(void 0!==this.onNodeLostConnection_&&void 0!==a)throw new Error("Node already has a lost connection callback.");this.onNodeLostConnection_=a},j.prototype.update=function(a){a=a||function(){};var b=this;j.superPrototype.update.call(this,function(c,d){null!==c&&(i.error("Update failed."),void 0!==b.onNodeLostConnection_&&b.onNodeLostConnection_()),a(c,d)})},j.prototype.connectToNode=function(a,b){j.superPrototype.connectToNode.call(this,a,function(a,c){a||(this.myWire=c),b(a,c)}.bind(this))},j.prototype.connectToRouter=function(a,b){b=b||function(){},this.connectToNode(a,function(c,d){return c?void b(c):(this.myRouter=a,this.myRouter.initializeSimulation(this.entityID,this.levelConfig_.routerExpectsPacketHeader),void a.requestAddress(d,this.getHostname(),function(c){return c?(d.destroy(function(){b(c)}),void(this.myWire=null)):(this.myRouter=a,this.routerChange.notifyObservers(this.myWire,this.myRouter),this.status_="Connected to "+a.getDisplayName()+" with address "+d.localAddress,void this.update(b))}.bind(this)))}.bind(this))},j.prototype.disconnectRemote=function(a){a=a||function(){};var b=this;this.myWire.destroy(function(c){return c?void a(c):(b.myWire=null,b.myRouter.update(a),b.myRouter.stopSimulation(),b.myRouter=null,void b.routerChange.notifyObservers(null,null))})},j.prototype.sendMessage=function(a,b){if(!this.myWire)return void b(new Error("Cannot send message; not connected."));var c=this.myWire.localNodeID,d=this.myWire.remoteNodeID,f=this;e.send(this.shard_,c,d,a,function(c){return c?(i.error("Failed to send message; "+c.message+": "+JSON.stringify(a)),void b(c)):(i.info("Local node sent message"),f.sentLog_&&f.sentLog_.log(a),void b(null))})},j.prototype.sendMessages=function(a,b){return 0===a.length?void b(null):void this.sendMessage(a[0],function(c,d){return null!==c?void b(c,d):void this.sendMessages(a.slice(1),b)}.bind(this))},j.prototype.onMessageTableChange_=function(a){if(!this.isProcessingMessages_){var b=a.map(function(a){return new e(this.shard_,a)}.bind(this)).filter(function(a){return a.toNodeID===this.entityID}.bind(this));0!==b.length&&(i.info("Local node received "+b.length+" messages"),this.isProcessingMessages_=!0,d.destroyEntities(b,function(a){return a?(i.error("Error pulling message off the wire: "+a.message),void(this.isProcessingMessages_=!1)):(b.forEach(function(a){this.handleMessage_(a)},this),i.info("Local node finished processing "+b.length+" messages"),void(this.isProcessingMessages_=!1))}.bind(this)))}},j.prototype.handleMessage_=function(a){this.receivedLog_&&this.receivedLog_.log(a.payload)}},{"../ObservableEvent":1,"../utils":238,"./NetSimClientNode":127,"./NetSimEntity":139,"./NetSimHeartbeat":140,"./NetSimLogger":148,"./NetSimMessage":149}],149:[function(a,b){"use strict";a("../utils");var c=a("./NetSimEntity"),d=b.exports=function(a,b){b=void 0!==b?b:{},c.call(this,a,b),this.fromNodeID=b.fromNodeID,this.toNodeID=b.toNodeID,this.payload=b.payload};d.inherits(c),d.send=function(a,b,c,e,f){var g=new d(a);g.fromNodeID=b,g.toNodeID=c,g.payload=e,g.getTable_().create(g.buildRow_(),f)},d.prototype.getTable_=function(){return this.shard_.messageTable},d.prototype.buildRow_=function(){return{fromNodeID:this.fromNodeID,toNodeID:this.toNodeID,payload:this.payload}}},{"../utils":238,"./NetSimEntity":139}],148:[function(a,b){"use strict";var c=b.exports=function(a,b){this.outputConsole_=a,this.log_=function(){},this.info=function(){},this.warn=function(){},this.error=function(){},this.setVerbosity(void 0===b?d.VERBOSE:b)},d={NONE:0,ERROR:1,WARN:2,INFO:3,VERBOSE:4};c.LogLevel=d;var e;c.getSingleton=function(){return void 0===e&&(e=new c(console,d.VERBOSE)),e},c.prototype.setVerbosity=function(a){this.log_=this.outputConsole_&&this.outputConsole_.log?Function.prototype.bind.call(this.outputConsole_.log,this.outputConsole_):function(){},this.info=a>=d.INFO?this.outputConsole_&&this.outputConsole_.info?Function.prototype.bind.call(this.outputConsole_.info,this.outputConsole_):this.log_:function(){},this.warn=a>=d.WARN?this.outputConsole_&&this.outputConsole_.warn?Function.prototype.bind.call(this.outputConsole_.warn,this.outputConsole_):this.log_:function(){},this.error=a>=d.ERROR?this.outputConsole_&&this.outputConsole_.error?Function.prototype.bind.call(this.outputConsole_.error,this.outputConsole_):this.log_:function(){}},c.prototype.log=function(a,b){switch(void 0===b&&(b=d.INFO),b){case d.ERROR:this.error(a);break;case d.WARN:this.warn(a);break;case d.INFO:this.info(a);break;default:this.log_(a)}}},{}],140:[function(a,b){"use strict";a("../utils");var c=a("./NetSimEntity"),d=6e3,e=b.exports=function(a,b){b=void 0!==b?b:{},c.call(this,a,b),this.nodeID=b.nodeID,this.time_=void 0!==b.time?b.time:Date.now(),this.intervalMs_=d,this.onFailedHeartbeat_=void 0};e.inherits(c),e.create=function(a,b){c.create(e,a,b)},e.getOrCreate=function(a,b,c){a.heartbeatTable.readAll(function(d,f){var g=f.filter(function(a){return a.nodeID==b}).sort(function(a,b){return a.time<b.time?1:-1});g.length>0?c(null,new e(a,g[0])):e.create(a,function(a,d){return null!==a?void c(a,null):(d.nodeID=b,void d.update(function(a){return null!==a?(d.destroy(),void c(a,null)):void c(null,d)}))})})},e.prototype.getTable_=function(){return this.shard_.heartbeatTable},e.prototype.buildRow_=function(){return{nodeID:this.nodeID,time:this.time_}},e.prototype.setBeatInterval=function(a){this.intervalMs_=a},e.prototype.setFailureCallback=function(a){if(void 0!==this.onFailedHeartbeat_&&void 0!==a)throw new Error("Heartbeat already has a failure callback.");this.onFailedHeartbeat_=a},e.prototype.tick=function(){Date.now()-this.time_>this.intervalMs_&&(this.time_=Date.now(),this.update(function(a){null!==a&&void 0!==this.onFailedHeartbeat_&&this.onFailedHeartbeat_()}.bind(this)))}},{"../utils":238,"./NetSimEntity":139}],127:[function(a,b){"use strict";a("../utils");var c=a("./netsimConstants").NodeType,d=a("./NetSimNode"),e=b.exports=function(a,b){d.call(this,a,b)};e.inherits(d),e.prototype.getNodeType=function(){return c.CLIENT},e.prototype.getStatus=function(){return this.status_?this.status_:"Online"}},{"../utils":238,"./NetSimNode":152,"./netsimConstants":184}],152:[function(a,b){"use strict";a("../utils");var c=a("./NetSimEntity"),d=a("./NetSimWire"),e=b.exports=function(a,b){b=void 0!==b?b:{},c.call(this,a,b),this.displayName_=b.name,this.status_=b.status,this.statusDetail_=b.statusDetail};e.inherits(c),e.prototype.getTable_=function(){return this.shard_.nodeTable},e.prototype.buildRow_=function(){return{type:this.getNodeType(),name:this.getDisplayName(),status:this.getStatus(),statusDetail:this.getStatusDetail()}},e.prototype.getDisplayName=function(){return this.displayName_?this.displayName_:"[New Node]"},e.prototype.getHostname=function(){return this.getDisplayName().replace(/[^\w\d]/g,"").toLowerCase()+this.entityID},e.prototype.getNodeType=function(){throw new Error("getNodeType method is not implemented")},e.prototype.getStatus=function(){return this.status_},e.prototype.getStatusDetail=function(){return this.statusDetail_?this.statusDetail_:""},e.prototype.connectToNode=function(a,b){b=b||function(){};var c=this;d.create(this.shard_,this.entityID,a.entityID,function(d,e){return d?void b(d,null):void a.acceptConnection(c,function(a,c){return a||!c?void e.destroy(function(){b(new Error("Connection rejected."),null)}):void b(null,e)})})},e.prototype.acceptConnection=function(a,b){b(null,!0)}},{"../utils":238,"./NetSimEntity":139,"./NetSimWire":177}],177:[function(a,b){"use strict";a("../utils");var c=a("./NetSimEntity"),d=b.exports=function(a,b){b=void 0!==b?b:{},c.call(this,a,b),this.localNodeID=b.localNodeID,this.remoteNodeID=b.remoteNodeID,this.localAddress=b.localAddress,this.remoteAddress=b.remoteAddress,this.localHostname=b.localHostname,this.remoteHostname=b.remoteHostname};d.inherits(c),d.create=function(a,b,c,e){var f=new d(a);f.localNodeID=b,f.remoteNodeID=c,f.getTable_().create(f.buildRow_(),function(b,c){return null!==b?void e(b,null):void e(null,new d(a,c))})},d.prototype.getTable_=function(){return this.shard_.wireTable},d.prototype.buildRow_=function(){return{localNodeID:this.localNodeID,remoteNodeID:this.remoteNodeID,localAddress:this.localAddress,remoteAddress:this.remoteAddress,localHostname:this.localHostname,remoteHostname:this.remoteHostname}}},{"../utils":238,"./NetSimEntity":139}],139:[function(a,b){"use strict";var c=b.exports=function(a,b){void 0===b&&(b={}),this.shard_=a,this.entityID=b.id};c.create=function(a,b,c){var d=new a(b);d.getTable_().create(d.buildRow_(),function(d,e){null===d?c(null,new a(b,e)):c(d,null)})},c.get=function(a,b,c,d){var e=new a(c);e.getTable_().read(b,function(b,e){var f=null;b||(f=new a(c,e)),d(b,f)})},c.prototype.update=function(a){a=a||function(){},this.getTable_().update(this.entityID,this.buildRow_(),a)},c.prototype.destroy=function(a){a=a||function(){},this.getTable_()["delete"](this.entityID,a)},c.prototype.getTable_=function(){throw new Error("Method getTable_ is not implemented.")},c.prototype.buildRow_=function(){return{}},c.destroyEntities=function(a,b){return 0===a.length?void b(null,!0):void a[0].destroy(function(d,e){return d?void b(d,e):void c.destroyEntities(a.slice(1),b)}.bind(this))}},{}],126:[function(a,b){"use strict";var c=a("./NetSimChunkSizeControl.html"),d=a("./netsimConstants").EncodingType,e=b.exports=function(a,b){this.rootDiv_=a,this.chunkSizeChangeCallback_=b,this.currentChunkSize_=8,this.currentUnits_=["byte"],this.render()};e.prototype.render=function(){var a=$(c({}));this.rootDiv_.html(a),this.rootDiv_.find(".chunk_size_slider").slider({value:this.currentChunkSize_,min:1,max:32,step:1,slide:this.onChunkSizeChange_.bind(this)}),this.setChunkSize(this.currentChunkSize_)},e.prototype.onChunkSizeChange_=function(a,b){var c=b.value;this.setChunkSize(c),this.chunkSizeChangeCallback_(c)},e.prototype.setChunkSize=function(a){var b=this.rootDiv_;this.currentChunkSize_=a,b.find(".chunk_size_slider").slider("option","value",a),b.find(".chunk_size_value").html(a)},e.prototype.setEncodings=function(a){this.currentUnits_.length=0,a.indexOf(d.ASCII)>-1&&this.currentUnits_.push("character"),a.indexOf(d.DECIMAL)>-1&&this.currentUnits_.push("number"),0===this.currentUnits_.length&&this.currentUnits_.push("byte"),this.rootDiv_.find(".unit_label").html(this.currentUnits_.join("/"))}},{"./NetSimChunkSizeControl.html":125,"./netsimConstants":184}],184:[function(a,b,c){"use strict";c.BITS_PER_NIBBLE=4,c.BITS_PER_BYTE=8,c.NodeType={CLIENT:"client",ROUTER:"router"},c.DnsMode={NONE:"none",MANUAL:"manual",AUTOMATIC:"automatic"},c.EncodingType={ASCII:"ascii",DECIMAL:"decimal",HEXADECIMAL:"hexadecimal",BINARY:"binary",A_AND_B:"a_and_b"},c.NetSimTabType={INSTRUCTIONS:"instructions",MY_DEVICE:"my_device",ROUTER:"router",DNS:"dns"},c.PacketUIColumnType={ENCODING_LABEL:"encodingLabel",TO_ADDRESS:"toAddress",FROM_ADDRESS:"fromAddress",PACKET_INFO:"packetInfo",MESSAGE:"message"}},{}],125:[function(require,module,exports){module.exports=function(){var t=function anonymous(locals,filters,escape){escape=escape||function(a){return String(a).replace(/&(?!\w+;)/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")};var buf=[];with(locals||{})!function(){buf.push('<div class="netsim_chunk_size_control">\n  <label for="chunk_size_slider"><span class="chunk_size_value"></span> bits per <span class="unit_label"></span></label>\n  <div class="chunk_size_slider"></div>\n</div>\n')}();return buf.join("")};return function(a){return t(a,require("ejs").filters)}}()},{ejs:259}],124:[function(a,b){"use strict";var c=a("./NetSimBandwidthControl.html"),d=a("../../locale/current/netsim"),e=2,f=18,g=1024,h=1024*g,i=1024*h,j=b.exports=function(a,b){this.rootDiv_=a,this.bandwidthChangeCallback_=b,this.bandwidth_=this.sliderValueToBandwidth_(f),this.render()};j.prototype.render=function(){var a=$(c({minValue:this.getDisplayBandwidth_(this.sliderValueToBandwidth_(e)),maxValue:this.getDisplayBandwidth_(this.sliderValueToBandwidth_(f))}));this.rootDiv_.html(a),this.rootDiv_.find(".slider").slider({value:this.bandwidthToSliderValue_(this.bandwidth_),min:e,max:f,step:1,slide:this.onSliderValueChange_.bind(this)}),this.setLabel_(this.bandwidth_)},j.prototype.bandwidthToSliderValue_=function(a){return 1/0===a?f:Math.floor(Math.log(a)/Math.LN2)},j.prototype.sliderValueToBandwidth_=function(a){return a===f?1/0:Math.pow(2,a)},j.prototype.onSliderValueChange_=function(a,b){var c=this.sliderValueToBandwidth_(b.value);this.setLabel_(c),this.bandwidthChangeCallback_(c)},j.prototype.setBandwidth=function(a){if(this.bandwidth_!==a){this.bandwidth_=a;var b=this.bandwidthToSliderValue_(a);this.rootDiv_.find(".slider").slider("option","value",b),this.setLabel_(a)}},j.prototype.setLabel_=function(a){this.rootDiv_.find(".packet_size_value").text(this.getDisplayBandwidth_(a))},j.prototype.getDisplayBandwidth_=function(a){if(1/0===a)return d.unlimited();var b=Math.floor(a/i);if(b>0)return d.x_Gbps({x:b});var c=Math.floor(a/h);if(c>0)return d.x_Mbps({x:c});var e=Math.floor(a/g);return e>0?d.x_Kbps({x:e}):d.x_bps({x:a})}},{"../../locale/current/netsim":248,"./NetSimBandwidthControl.html":123}],123:[function(require,module,exports){module.exports=function(){var t=function anonymous(locals,filters,escape){escape=escape||function(a){return String(a).replace(/&(?!\w+;)/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")};var buf=[];with(locals||{})!function(){buf.push("");require("../../locale/current/netsim");buf.push('\n<div class="netsim-bandwidth-control netsim-slider">\n  <div class="slider-inline-wrap">\n    <div class="slider"></div>\n    <div class="slider-labels">\n      <div class="max-value">',escape(maxValue),'</div>\n      <div class="min-value">',escape(minValue),'</div>\n      <div class="current-value">\n        <label for="packet-size-slider"><span class="packet_size_value"></span></label>\n      </div>\n    </div>\n  </div>\n</div>\n')}();return buf.join("")};return function(a){return t(a,require("ejs").filters)}}()},{"../../locale/current/netsim":248,ejs:259}],248:[function(a,b){b.exports=window.blockly.appLocale},{}],122:[function(a,b){"use strict";var c=b.exports=function(){this.isReady=!1,this.whenReadyCallbacks_=[],this.id=void 0,this.name=""};c.currentUser_=null,c.getCurrentUser=function(){return c.currentUser_||(c.currentUser_=new c,$.ajax({url:"/v2/user",type:"get",dataType:"json",success:function(a){c.currentUser_.initialize(a)},error:function(){c.currentUser_.initialize({isSignedIn:!1})}})),c.currentUser_},c.prototype.initialize=function(a){this.id=a.id,this.name=a.name,this.isSignedIn=a.isSignedIn!==!1,this.isReady=!0,this.whenReadyCallbacks_.forEach(function(a){a(this)}.bind(this)),this.whenReadyCallbacks_.length=0},c.prototype.whenReady=function(a){this.isReady?a(this):this.whenReadyCallbacks_.push(a)}},{}],52:[function(a,b){"use strict";a("./utils");var c=b.exports,d={NOT_STARTED:0,WORKING:1,SUCCESS:2,FAILURE:3},e=c.Command=function(){this.status_=d.NOT_STARTED};e.prototype.isStarted=function(){return this.status_!==d.NOT_STARTED},e.prototype.isFinished=function(){return this.succeeded()||this.failed()},e.prototype.succeeded=function(){return this.status_===d.SUCCESS},e.prototype.failed=function(){return this.status_===d.FAILURE},e.prototype.begin=function(){this.status_=d.WORKING,this.onBegin_()},e.prototype.succeed=function(){if(!this.isStarted())throw new Error("Command cannot succeed before it begins.");this.status_=d.SUCCESS,this.onEnd_()},e.prototype.fail=function(){if(!this.isStarted())throw new Error("Command cannot fail before it begins.");this.status_=d.FAILURE,this.onEnd_()},e.prototype.onBegin_=function(){},e.prototype.tick=function(){},e.prototype.onEnd_=function(){};var f=c.CommandSequence=function(a){e.call(this),this.commandList_=a,this.currentCommandIndex_=0};f.inherits(e),f.prototype.onBegin_=function(){this.currentCommandIndex_=0,0===this.commandList_.length&&this.succeed()},f.prototype.currentCommand=function(){return this.commandList_[this.currentCommandIndex_]},f.prototype.tick=function(a){for(;this.isStarted()&&!this.isFinished()&&this.currentCommand();)if(this.currentCommand().isStarted()?this.currentCommand().tick(a):this.currentCommand().begin(),this.currentCommand().succeeded())this.currentCommandIndex_++,void 0===this.currentCommand()&&this.succeed();else{if(!this.currentCommand().failed())break;this.fail()}}},{"./utils":238}],50:[function(a,b){"use strict";a("./utils");var c=b.exports,d=function(a){this.apiBaseUrl_=a};d.prototype.get=function(a,b){$.ajax({url:this.apiBaseUrl_+a,type:"get",dataType:"json"}).done(function(a){b(null,a)}).fail(function(a,c,d){b(new Error("textStatus: "+c+"; errorThrown: "+d),null)})},d.prototype.post=function(a,b,c){$.ajax({url:this.apiBaseUrl_+a,type:"post",contentType:"application/json; charset=utf-8",data:JSON.stringify(b)}).done(function(){c(null,null)}).fail(function(a,b,d){c(new Error("textStatus: "+b+"; errorThrown: "+d),null)})},d.prototype.postToGet=function(a,b,c){$.ajax({url:this.apiBaseUrl_+a,type:"post",contentType:"application/json; charset=utf-8",data:JSON.stringify(b)}).done(function(a){c(null,a)}).fail(function(a,b,d){c(new Error("textStatus: "+b+"; errorThrown: "+d),null)})},d.prototype["delete"]=function(a,b){$.ajax({url:this.apiBaseUrl_+a,type:"delete"}).done(function(){b(null,null)}).fail(function(a,c,d){b(new Error("textStatus: "+c+"; errorThrown: "+d),null)})},c.Channel=function(){this.requestHelper_=new d("/v3/channels")},c.Channel.prototype.readAll=function(a){this.requestHelper_.get("",a)},c.Channel.prototype.read=function(a,b){this.requestHelper_.get("/"+a,b)},c.Channel.prototype.create=function(a,b){this.requestHelper_.postToGet("",a,b)},c.Channel.prototype.update=function(a,b,c){this.requestHelper_.post("/"+a,b,c)},c.Channel.prototype["delete"]=function(a,b){this.requestHelper_["delete"]("/"+a,b)},c.SharedTable=function(a,b){c.Channel.call(this),this.requestHelper_=new d("/v3/shared-tables/"+a+"/"+b)},c.SharedTable.inherits(c.Channel),c.UserTable=function(a,b){c.Channel.call(this),this.requestHelper_=new d("/v3/user-tables/"+a+"/"+b)},c.UserTable.inherits(c.Channel),c.PropertyBag=function(a){this.requestHelper_=new d("/v3/shared-properties/"+a)},c.PropertyBag.prototype.readAll=function(a){this.requestHelper_.get("",a)},c.PropertyBag.prototype.read=function(a,b){this.requestHelper_.get("/"+a,b)},c.PropertyBag.prototype.set=function(a,b,c){this.requestHelper_.post("/"+a,b,c)},c.PropertyBag.prototype["delete"]=function(a,b){this.requestHelper_["delete"]("/"+a,b)},c.UserPropertyBag=function(a){c.PropertyBag.call(this,a),this.requestHelper_=new d("/v3/user-properties/"+a)},c.UserPropertyBag.inherits(c.PropertyBag)},{"./utils":238}],3:[function(a,b){"use strict";var c=a("./ObservableEvent"),d=window.performance&&window.performance.now?window.performance.now.bind(window.performance):Date.now,e=30,f=1e3/e,g=b.exports=function(){this.enabled=!1,this.clock=new g.Clock,this.tick_=this.buildTickMethod_(),this.tick=new c,this.render=new c};g.Clock=function(){this.time=d(),this.deltaTime=0},g.prototype.buildTickMethod_=function(){var a,b=this;return a=window.requestAnimationFrame?function(c){b.enabled&&(b.clock.deltaTime=c-b.clock.time,b.clock.time=c,b.tick.notifyObservers(b.clock),b.render.notifyObservers(b.clock),requestAnimationFrame(a))
}:function(){if(b.enabled){var c=d();b.clock.deltaTime=c-b.clock.time,b.clock.time=c,b.tick.notifyObservers(b.clock),b.render.notifyObservers(b.clock),setTimeout(a,f-b.clock.deltaTime)}}},g.prototype.begin=function(){this.enabled=!0,this.clock.time=d(),this.tick_(this.clock.time)},g.prototype.end=function(){this.enabled=!1}},{"./ObservableEvent":1}],1:[function(a,b){"use strict";var c=b.exports=function(){this.observerList_=[]};c.prototype.register=function(a){var b={toCall:a};return Object.freeze(b),this.observerList_.push(b),b},c.prototype.unregister=function(a){for(var b=0;b<this.observerList_.length;b++)if(a===this.observerList_[b])return this.observerList_.splice(b,1),!0;return!1},c.prototype.notifyObservers=function(){var a=Array.prototype.slice.call(arguments,0);this.observerList_.forEach(function(b){b.toCall.apply(void 0,a)})}},{}]},{},[182]);