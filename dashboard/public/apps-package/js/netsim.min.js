require=function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};b[g][0].call(k.exports,function(a){var c=b[g][1][a];return e(c?c:a)},k,k.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({118:[function(a){var b=a("../appMain"),c=a("../StudioApp").singleton,d=a("./netsim"),e=a("./levels"),f=a("./skins");window.netsimMain=function(a){a.skinsModule=f,a.isEditorless=!0;var g=new d;g.injectStudioApp(c),b(g,e,a)}},{"../StudioApp":2,"../appMain":3,"./levels":117,"./netsim":119,"./skins":122}],122:[function(a,b,c){var d=a("../skins");c.load=function(a,b){var c=d.load(a,b);return c}},{"../skins":125}],119:[function(a,b){"use strict";var c=a("../dom"),d=a("./page.html"),e=a("./NetSimConnection"),f=a("./NetSimLogger"),g=a("./DashboardUser"),h=a("./NetSimLobby"),i=a("./RunLoop"),j=function(){this.skin=null,this.level=null,this.heading=0,this.currentUser_=g.getCurrentUser(),this.logger_=new f(console,f.LogLevel.VERBOSE),this.connection_=null,this.runLoop_=new i};b.exports=j,j.prototype.injectStudioApp=function(a){this.studioApp_=a},j.prototype.onSendButtonClick_=function(){var a=new Date,b=document.getElementById("netsim_inputbox"),c=document.getElementById("netsim_recievelog");c.value+="["+a.toTimeString()+"] "+b.value+"\n",c.scrollTop=c.scrollHeight},j.prototype.attachHandlers_=function(){c.addClickTouchEvent(document.getElementById("netsim_sendbutton"),this.onSendButtonClick_.bind(this))},j.prototype.init=function(b){if(!this.studioApp_)throw new Error("NetSim requires a StudioApp");this.skin=b.skin,this.level=b.level,b.html=d({assetUrl:this.studioApp_.assetUrl,data:{visualization:"",localeDirection:this.studioApp_.localeDirection(),controls:a("./controls.html")({assetUrl:this.studioApp_.assetUrl})},hideRunButton:!0}),b.enableShowCode=!1,b.loadAudio=this.loadAudio_.bind(this),this.studioApp_.configureDom=this.configureDomOverride_.bind(this.studioApp_),this.studioApp_.onResize=this.onResizeOverride_.bind(this.studioApp_),this.studioApp_.init(b),this.attachHandlers_(),this.currentUser_.whenReady(function(){var a=this.currentUser_.name+"_"+(Math.floor(99*Math.random())+1);this.connection_=new e(a,this.logger_),this.runLoop_.tick.register(this.connection_,this.connection_.tick),this.logger_.log("Connection manager created.");var b=document.getElementById("netsim_lobby_container");this.lobbyControl_=h.createWithin(b,this.connection_),this.runLoop_.tick.register(this.lobbyControl_,this.lobbyControl_.tick),this.logger_.log("Lobby control created.")}.bind(this)),this.runLoop_.begin()},j.prototype.loadAudio_=function(){this.studioApp_.loadAudio(this.skin.winSound,"win"),this.studioApp_.loadAudio(this.skin.startSound,"start"),this.studioApp_.loadAudio(this.skin.failureSound,"failure")},j.prototype.configureDomOverride_=function(a){var b=document.getElementById(a.containerId);b.innerHTML=a.html},j.prototype.onResizeOverride_=function(){var a=document.getElementById("appcontainer"),b=a.parentNode,c=window.getComputedStyle(b),d=parseInt(c.width,10);a.style.top=b.offsetTop+"px",a.style.width=d+"px"}},{"../dom":43,"./DashboardUser":109,"./NetSimConnection":110,"./NetSimLobby":112,"./NetSimLogger":113,"./RunLoop":115,"./controls.html":116,"./page.html":121}],121:[function(require,module,exports){module.exports=function(){var t=function anonymous(locals,filters,escape){escape=escape||function(a){return String(a).replace(/&(?!\w+;)/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")};var buf=[];with(locals||{})!function(){buf.push("");{var a=require("../../locale/current/common");require("../../locale/current/netsim")}buf.push('\n\n<div id="rotateContainer" style="background-image: url(',escape(assetUrl("media/mobile_tutorial_turnphone.png")),')">\n  <div id="rotateText">\n    <p>',escape(a.rotateText()),"<br>",escape(a.orientationLock()),"</p>\n  </div>\n</div>\n\n");var b=function(){buf.push('  <div id="bubble" class="clearfix">\n    <table id="prompt-table">\n      <tr>\n        <td id="prompt-icon-cell">\n          <img id="prompt-icon"/>\n        </td>\n        <td id="prompt-cell">\n          <p id="prompt">\n          </p>\n        </td>\n      </tr>\n    </table>\n    <div id="ani-gif-preview-wrapper">\n      <div id="ani-gif-preview">\n        <img id="play-button" src="',escape(assetUrl("media/play-circle.png")),'"/>\n      </div>\n    </div>\n  </div>\n')};buf.push("\n");var c=function(a){buf.push("  "),a&&buf.push('    <div id="helpArea">\n      ',a,"\n    </div>\n  "),buf.push("")};buf.push('\n<div id="appcontainer">\n  <div id="netsim">\n    <div id="netsim_lobby_container"></div>\n    <hr/>\n    <textarea id="netsim_inputbox"></textarea>\n    <input id="netsim_sendbutton" type="button" value="Send" />\n    <textarea id="netsim_recievelog"></textarea>\n  </div>\n  <div id="footers" dir="',escape(data.localeDirection),'">\n    '),b(),buf.push("\n    "),c(data.helpHtml),buf.push('\n  </div>\n</div>\n\n<div class="clear"></div>\n')}();return buf.join("")};return function(a){return t(a,require("ejs").filters)}}()},{"../../locale/current/common":170,"../../locale/current/netsim":175,ejs:186}],117:[function(a,b){var c=(a("../../locale/current/netsim"),b.exports={});c.netsim_demo={freePlay:!0}},{"../../locale/current/netsim":175}],175:[function(a,b){b.exports=window.blockly.appLocale},{}],116:[function(require,module,exports){module.exports=function(){var t=function anonymous(locals,filters,escape){escape=escape||function(a){return String(a).replace(/&(?!\w+;)/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")};var buf=[];with(locals||{})!function(){buf.push('<div id="slider-cell">\n  <img id="spinner" style="visibility: hidden;" src="',escape(assetUrl("media/turtle/loading.gif")),'" height=15 width=15>\n</div>\n')}();return buf.join("")};return function(a){return t(a,require("ejs").filters)}}()},{ejs:186}],115:[function(a,b){"use strict";var c=a("./ObservableEvent"),d=window.performance&&window.performance.now?window.performance.now.bind(window.performance):Date.now,e=30,f=1e3/e,g=function(){this.enabled=!1,this.clock=new g.Clock,this.tick_=this.buildTickMethod_(),this.tick=new c,this.render=new c};b.exports=g,g.Clock=function(){this.time=d(),this.deltaTime=0},g.prototype.buildTickMethod_=function(){var a,b=this;return a=window.requestAnimationFrame?function(c){b.enabled&&(b.clock.deltaTime=c-b.clock.time,b.clock.time=c,b.tick.notifyObservers(b.clock),b.render.notifyObservers(b.clock),requestAnimationFrame(a))}:function(){if(b.enabled){var c=d();b.clock.deltaTime=c-b.clock.time,b.clock.time=c,b.tick.notifyObservers(b.clock),b.render.notifyObservers(b.clock),setTimeout(a,f-b.clock.deltaTime)}}},g.prototype.begin=function(){this.enabled=!0,this.clock.time=d(),this.tick_(this.clock.time)},g.prototype.end=function(){this.enabled=!1}},{"./ObservableEvent":114}],112:[function(a,b){"use strict";var c=a("./NetSimLobby.html"),d=5e3,e=function(a){this.connection_=a,this.connection_.statusChanges.register(this,this.refreshLobby_),this.nextAutoRefreshTime_=1/0};b.exports=e,e.createWithin=function(a,b){var d=new e(b);return a.innerHTML=c({}),d.initialize(),d},e.prototype.initialize=function(){this.bindElements_(),this.refreshInstanceList_()},e.prototype.bindElements_=function(){this.instanceSelector_=document.getElementById("netsim_instance_select"),$(this.instanceSelector_).change(this.onInstanceSelectorChange_.bind(this)),this.lobbyList_=document.getElementById("netsim_lobby_list")},e.prototype.onInstanceSelectorChange_=function(){this.connection_.isConnectedToInstance()&&(this.connection_.disconnectFromInstance(),this.nextAutoRefreshTime_=1/0),"__none"!==this.instanceSelector_.value&&this.connection_.connectToInstance(this.instanceSelector_.value)},e.prototype.refreshInstanceList_=function(){var a=this,b="demo",c=this.instanceSelector_;this.getUserSections_(function(d){return $(c).empty(),0===d.length?void $("<option>").val("__none").html("-- NONE FOUND --").appendTo(c):($("<option>").val("__none").html("-- PICK ONE --").appendTo(c),d.forEach(function(a){$("<option>").val("netsim_"+b+"_"+a.id).html(a.name).appendTo(c)}),void a.onInstanceSelectorChange_())})},e.prototype.refreshLobby_=function(){var a=this,b=this.lobbyList_;return this.connection_.isConnectedToInstance()?void this.connection_.getLobbyListing(function(c){$(b).empty(),c.sort(function(a,b){return a.name===b.name?0:a.name>b.name?1:-1}),c.forEach(function(c){var d=$("<li>");c.id===a.connection_.myLobbyRowID_?(d.addClass("netsim_lobby_own_row"),d.html(c.name+" : "+c.status+" : Me")):(d.addClass("netsim_lobby_user_row"),$("<a>").attr("href","#").html(c.name+" : "+c.status).appendTo(d)),d.appendTo(b)}),1/0===a.nextAutoRefreshTime_&&(a.nextAutoRefreshTime_=0)}):void $(b).empty()},e.prototype.getUserSections_=function(a){$.ajax({dataType:"json",url:"/v2/sections/membership",success:a})},e.prototype.tick=function(a){if(a.time>=this.nextAutoRefreshTime_)if(this.refreshLobby_(),0===this.nextAutoRefreshTime_)this.nextAutoRefreshTime_=a.time+d;else for(;this.nextAutoRefreshTime_<a.time;)this.nextAutoRefreshTime_+=d}},{"./NetSimLobby.html":111}],111:[function(require,module,exports){module.exports=function(){var t=function anonymous(locals,filters,escape){escape=escape||function(a){return String(a).replace(/&(?!\w+;)/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")};var buf=[];with(locals||{})!function(){buf.push('<div id="netsim_lobby">\n  <label for="netsim_instance_select">My Section:</label>\n  <select id="netsim_instance_select">\n    <option selected value="__none">Loading...</option>\n  </select>\n  <ul id="netsim_lobby_list"></ul>\n</div>\n')}();return buf.join("")};return function(a){return t(a,require("ejs").filters)}}()},{ejs:186}],110:[function(a,b){"use strict";var c=a("./netsimStorage"),d=a("./NetSimLogger"),e=d.LogLevel,f=a("./ObservableEvent"),g=2e3,h=3e4,i=function(a,b){this.displayName_=a,this.logger_=b,void 0===this.logger_&&(this.logger_=new d(console,e.NONE)),this.lobbyTable_=null,this.myLobbyRowID_=void 0,this.statusChanges=new f,this.nextKeepAliveTime_=1/0,window.addEventListener("beforeunload",this.onBeforeUnload_.bind(this))};b.exports=i;var j={DISCONNECTED:0,CONNECTED:1};i.ConnectionStatus=j,i.prototype.onBeforeUnload_=function(){this.isConnectedToInstance()&&this.disconnectFromInstance()},i.prototype.buildLobbyRow_=function(){return{lastPing:Date.now(),name:this.displayName_,type:"user",status:"In Lobby"}},i.prototype.connectToInstance=function(a){this.isConnectedToInstance()&&(this.logger_.log("Auto-closing previous connection...",e.WARN),this.disconnectFromInstance());var b=a+"_lobby";this.lobbyTable_=new c.SharedStorageTable(c.APP_PUBLIC_KEY,b),this.connect_()},i.prototype.disconnectFromInstance=function(){return this.isConnectedToInstance()?(this.disconnectByRowID_(this.myLobbyRowID_),void this.setConnectionStatus_(j.DISCONNECTED)):void this.logger_.log("Redundant disconnect call.",e.WARN)},i.prototype.connect_=function(){var a=this;this.lobbyTable_.insert(this.buildLobbyRow_(),function(b){b?a.setConnectionStatus_(j.CONNECTED,b.id):a.logger_.log("Failed to connect to instance",e.ERROR)})},i.prototype.disconnectByRowID_=function(a){if(!this.isConnectedToInstance())return void this.logger_.log("Can't disconnect when not connected to an instance.",e.ERROR);var b=this;this.lobbyTable_["delete"](a,function(c){c?b.logger_.log("Disconnected client "+a+" from instance.",e.INFO):b.logger_.log("Failed to disconnect client "+a+".",e.WARN)})},i.prototype.isConnectedToInstance=function(){return void 0!==this.myLobbyRowID_},i.prototype.setConnectionStatus_=function(a,b){switch(a){case j.CONNECTED:this.myLobbyRowID_=b,this.nextKeepAliveTime_=0,this.logger_.log("Connected to instance, assigned ID "+this.myLobbyRowID_,e.INFO);break;case j.DISCONNECTED:this.myLobbyRowID_=void 0,this.nextKeepAliveTime_=1/0,this.logger_.log("Disconnected from instance",e.INFO)}this.statusChanges.notifyObservers()},i.prototype.keepAlive=function(){if(!this.isConnectedToInstance())return void this.logger_.log("Can't send keepAlive, not connected to instance.",e.WARN);var a=this;this.lobbyTable_.update(this.myLobbyRowID_,this.buildLobbyRow_(),function(b){b||(a.setConnectionStatus_(j.DISCONNECTED),a.logger_.log("Reconnecting...",e.INFO),a.connect_())})},i.prototype.getLobbyListing=function(a){if(!this.isConnectedToInstance())return this.logger_.log("Can't get lobby rows, not connected to instance.",e.WARN),void a([]);var b=this.logger_;this.lobbyTable_.all(function(c){null!==c?a(c):(b.log("Lobby data request failed, using empty list.",e.WARN),a([]))})},i.prototype.tick=function(a){if(a.time>=this.nextKeepAliveTime_)if(this.keepAlive(),this.cleanLobby_(),0===this.nextKeepAliveTime_)this.nextKeepAliveTime_=a.time+g;else for(;this.nextKeepAliveTime_<a.time;)this.nextKeepAliveTime_+=g},i.prototype.cleanLobby_=function(){var a=this,b=Date.now();this.getLobbyListing(function(c){c.forEach(function(c){b-c.lastPing>=h&&a.disconnectByRowID_(c.id)})})}},{"./NetSimLogger":113,"./ObservableEvent":114,"./netsimStorage":120}],120:[function(a,b){"use strict";var c=b.exports;c.APP_PUBLIC_KEY="localhost"===window.location.hostname.split(".")[0]?"JGW2rHUp_UCMW_fQmRf6iQ==":"HQJ8GCCMGP7Yh8MrtDusIA==";var d=function(a,b){this.apiBaseUrl_="/v3/apps/"+a+"/shared-tables/"+b};c.SharedStorageTable=d,d.prototype.all=function(a){$.ajax({url:this.apiBaseUrl_,type:"get",dataType:"json"}).done(function(b){a(b)}).fail(function(){a(null)})},d.prototype.fetch=function(a,b){$.ajax({url:this.apiBaseUrl_+"/"+a,type:"get",dataType:"json"}).done(function(a){b(a)}).fail(function(){b(void 0)})},d.prototype.insert=function(a,b){$.ajax({url:this.apiBaseUrl_,type:"post",contentType:"application/json; charset=utf-8",data:JSON.stringify(a)}).done(function(a){b(a)}).fail(function(){b(void 0)})},d.prototype.update=function(a,b,c){$.ajax({url:this.apiBaseUrl_+"/"+a,type:"post",contentType:"application/json; charset=utf-8",data:JSON.stringify(b)}).done(function(){c(!0)}).fail(function(){c(!1)})},d.prototype["delete"]=function(a,b){$.ajax({url:this.apiBaseUrl_+"/"+a+"/delete",type:"post",dataType:"json"}).done(function(){b(!0)}).fail(function(){b(!1)})}},{}],114:[function(a,b){"use strict";var c=function(){this.observerList_=[]};b.exports=c,c.prototype.register=function(a,b){var c={thisArg:a,toCall:b};return Object.freeze(c),this.observerList_.push(c),c},c.prototype.unregister=function(a){for(var b=0;b<this.observerList_.length;b++)if(a===this.observerList_[b])return this.observerList_.splice(b,1),!0;return!1},c.prototype.notifyObservers=function(){var a=Array.prototype.slice.call(arguments,0);this.observerList_.forEach(function(b){b.toCall.apply(b.thisArg,a)})}},{}],113:[function(a,b){"use strict";var c=function(a,b){this.outputConsole_=a,this.log_=function(){},this.info=function(){},this.warn=function(){},this.error=function(){},this.initializeWithVerbosity_(void 0===b?d.VERBOSE:b)};b.exports=c;var d={NONE:0,ERROR:1,WARN:2,INFO:3,VERBOSE:4};c.LogLevel=d,c.prototype.initializeWithVerbosity_=function(a){this.log_=this.outputConsole_&&this.outputConsole_.log?this.outputConsole_.log.bind(this.outputConsole_):function(){},this.info=a>=d.INFO?this.outputConsole_&&this.outputConsole_.info?this.outputConsole_.info.bind(this.outputConsole_):this.log_:function(){},this.warn=a>=d.WARN?this.outputConsole_&&this.outputConsole_.warn?this.outputConsole_.warn.bind(this.outputConsole_):this.log_:function(){},this.error=a>=d.ERROR?this.outputConsole_&&this.outputConsole_.error?this.outputConsole_.error.bind(this.outputConsole_):this.log_:function(){}},c.prototype.log=function(a,b){switch(void 0===b&&(b=d.INFO),b){case d.ERROR:this.error(a);break;case d.WARN:this.warn(a);break;case d.INFO:this.info(a);break;default:this.log_(a)}}},{}],109:[function(a,b){"use strict";var c=function(){this.isReady=!1,this.whenReadyCallbacks_=[],this.id=void 0,this.name=""};b.exports=c,c.currentUser_=null,c.getCurrentUser=function(){return c.currentUser_||(c.currentUser_=new c,$.ajax({url:"/v2/user",type:"get",dataType:"json",success:function(a){c.currentUser_.initialize_(a)},error:function(){throw new Error("Unable to retrieve current user info.")}})),c.currentUser_},c.prototype.initialize_=function(a){this.id=a.id,this.name=a.name,this.isReady=!0,this.whenReadyCallbacks_.forEach(function(a){a(this)}.bind(this)),this.whenReadyCallbacks_=[]},c.prototype.whenReady=function(a){this.isReady?a(this):this.whenReadyCallbacks_.push(a)}},{}]},{},[118]);