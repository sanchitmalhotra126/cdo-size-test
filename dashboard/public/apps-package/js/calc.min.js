require=function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};b[g][0].call(k.exports,function(a){var c=b[g][1][a];return e(c?c:a)},k,k.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({32:[function(a){var b=a("../appMain");window.Calc=a("./calc");var c=a("./blocks"),d=a("../skins"),e=a("./levels");window.calcMain=function(a){a.skinsModule=d,a.blocksModule=c,b(window.Calc,e,a)}},{"../appMain":3,"../skins":108,"./blocks":27,"./calc":28,"./levels":31}],28:[function(a,b){"use strict";function c(){{var a={},b=Blockly.mainBlockSpace.getTopBlocks();b.forEach(function(b){var c=e(b);a[c.name||y]=c.expression})}return a}function d(a){if(a){if(0!==Blockly.mainBlockSpace.getTopBlocks().length)throw new Error("generateTargetExpression shouldn't be called with blocksif we already have blocks in the workspace");p.loadBlocks(a)}var b=c();return Blockly.mainBlockSpace.getTopBlocks().forEach(function(a){a.dispose()}),b}function e(a){var b;if(!a)return null;var c=a.getChildren()[0];switch(a.type){case"functional_compute":return c?e(c):new w(0);case"functional_plus":case"functional_minus":case"functional_times":case"functional_dividedby":var d=a.getTitles()[0].getValue(),f=["ARG1","ARG2"].map(function(b){var c=a.getInputTargetBlock(b);return c?e(c).expression:0});return new D(null,new w(d,f,a.id));case"functional_math_number":case"functional_math_number_dropdown":var g=a.getTitleValue("NUM")||0;return"???"===g&&(g=0),new D(null,new w(parseInt(g,10),[],a.id));case"functional_call":b=a.getCallName();var h=Blockly.Procedures.getDefinition(b,Blockly.mainBlockSpace);if(h.isVariable())return new D(null,new w(b));for(var i,j,k=[],l=0;i=a.getInput("ARG"+l);l++)j=i.connection.targetBlock(),k.push(j?e(j).expression:new w(0));return new D(null,new w(b,k));case"functional_definition":b=a.getTitleValue("NAME"),a.parameterNames_.length&&(b+="("+a.parameterNames_.join(",")+")");var m=c?e(c).expression:new w(0);return new D(b,m);case"functional_parameters_get":return new D(null,new w(a.getTitleValue("VAR")));default:throw"Unknown block type: "+a.type}}function f(){B.animating=!1,E()}function g(){for(var a=document.getElementById("userExpression"),b=a.childNodes.length-1;b>=0;b--)a.removeChild(a.childNodes[b])}function h(a){var b=!1;if(u(B.userExpressions).size()>1||u(B.targetExpressions).size()>1)throw new Error("Can only animate with single user/target");var c=B.userExpressions[y];if(!c)throw new Error("require user expression");g();for(var d=c.clone(),e=d,f=0,h=0;a>=h&&!b;h++){var j;if(f===a)j=d.getTokenListDiff(e);else if(f+1===a){var k=d.getDeepestOperation();k&&p.highlight("block_id_"+k.blockId),j=d.getTokenList(!0)}else j=d.getTokenList(!1);i("userExpression",null,j,f,"markedToken"),e=d.clone(),d.collapse()?f++:h-f>2&&(b=!0)}return b}function i(a,b,c,d,e){var f=document.getElementById(a),g=document.createElementNS(Blockly.SVG_NS,"g");f.appendChild(g);var h,i=0;b&&(h=j(g,b+" = ",i,null),i+=h);for(var k=0;k<c.length;k++)h=j(g,c[k].str,i,c[k].marked&&e),i+=h;var l=(A-g.getBoundingClientRect().width)/2,m=20*d;g.setAttribute("transform","translate("+l+", "+m+")")}function j(a,b,c,d){var e,f;return e=document.createElementNS(Blockly.SVG_NS,"text"),e.textContent=b.replace(/ /g,"_"),a.appendChild(e),f=e.getComputedTextLength?e.getComputedTextLength():0,e.textContent=b,e.setAttribute("x",c+f/2),e.setAttribute("text-anchor","middle"),d&&e.setAttribute("class",d),f}function k(a){for(var b=document.getElementById(a).cloneNode(!0),c=b.getElementsByTagName("*"),d=0;d<c.length;d++){var e=c[d];e.removeAttribute("id")}return b}function l(a){var b=document.getElementById("runButton");b.disabled=!1,B.response=a,E()}var m,n,o=b.exports,p=a("../StudioApp").singleton,o=b.exports,q=(a("../../locale/current/common"),a("../../locale/current/calc")),r=(a("../skins"),a("./levels"),a("../codegen"),a("./api"),a("../templates/page.html")),s=a("../dom"),t=a("../block_utils"),u=a("../utils").getLodash(),v=a("../timeoutList"),w=a("./expressionNode"),x=p.TestResults,y="zzz_compute";p.setCheckForEmptyBlocks(!1);var z=400,A=400,B={targetExpressions:null,userExpressions:null,animating:!1,response:null,message:null,result:null,testResults:null,currentAnimationDepth:0},C=2e3,D=function(a,b){this.name=a,this.expression=b};o.init=function(b){n=b.skin,m=b.level,o.expressions={target:null,user:null},m.scale&&void 0!==m.scale.stepSpeed&&(C=m.scale.stepSpeed),b.grayOutUndeletableBlocks=!0,b.forceInsertTopBlock="functional_compute",b.enableShowCode=!1,b.html=r({assetUrl:p.assetUrl,data:{localeDirection:p.localeDirection(),visualization:a("./visualization.html")(),controls:a("./controls.html")({assetUrl:p.assetUrl}),blockUsed:void 0,idealBlockNumber:void 0,editCode:m.editCode,blockCounterClass:"block-counter-default"}}),b.loadAudio=function(){p.loadAudio(n.winSound,"win"),p.loadAudio(n.startSound,"start"),p.loadAudio(n.failureSound,"failure")},b.afterInject=function(){var a=document.getElementById("svgCalc");a.setAttribute("width",A),a.setAttribute("height",z),m.freePlay&&document.getElementById("goalHeader").setAttribute("visibility","hidden"),Blockly.BROKEN_CONTROL_POINTS=!1,Blockly.JavaScript.addReservedWords("Calc,code");var c=m.solutionBlocks;m.solutionBlocks&&""!==m.solutionBlocks&&(c=t.forceInsertTopBlock(m.solutionBlocks,b.forceInsertTopBlock)),B.targetExpressions=d(c),u.keys(B.targetExpressions).sort().forEach(function(a,b){var c=B.targetExpressions[a],d=c.getTokenList(!1);a===y&&(a=null),i("answerExpression",a,d,b)});var e=document.getElementById("visualizationColumn");e.style.width="400px";var f=document.getElementById("resetButton");s.addClickTouchEvent(f,o.resetButtonClick)},p.init(b)},p.runButtonClick=function(){p.toggleRunReset("reset"),Blockly.mainBlockSpace.traceOn(!0),p.attempts++,o.execute()},o.resetButtonClick=function(){o.expressions.user=null,B.message=null,B.currentAnimationDepth=0,v.clearTimeouts(),B.animating=!1,g()},o.execute=function(){B.testResults=x.NO_TESTS_RUN,B.message=void 0,B.userExpressions=c(),B.result=!0,u.keys(B.targetExpressions).forEach(function(a){var b=B.targetExpressions[a],c=B.userExpressions[a];c&&c.isIdenticalTo(b)||(B.result=!1)});var a=u(B.userExpressions).size()>1;if(m.freePlay)B.result=!0,B.testResults=x.FREE_PLAY;else{var b=B.userExpressions[y],d=B.targetExpressions[y];!B.result&&!a&&b&&b.isEquivalentTo(d)?(B.testResults=x.APP_SPECIFIC_FAIL,B.message=q.equivalentExpression()):B.testResults=p.getTestResults(B.result)}var e=Blockly.Xml.blockSpaceToDom(Blockly.mainBlockSpace),h=Blockly.Xml.domToText(e),j={app:"calc",level:m.id,builder:m.builder,result:B.result,testResult:B.testResults,program:encodeURIComponent(h),onComplete:l};p.report(j),B.animating=!0,B.result&&!a?o.step():(g(),u(B.userExpressions).keys().sort().forEach(function(a,b){var c=B.userExpressions[a],d=B.targetExpressions[a]||c,e=c?c.getTokenListDiff(d):[];a===y&&(a=null),i("userExpression",a,e,b,"errorToken")}),v.setTimeout(function(){f()},C))},o.step=function(){return h(B.currentAnimationDepth)?void f():(B.currentAnimationDepth++,void v.setTimeout(function(){o.step()},C))};var E=function(){if(B.response&&!B.animating){m.extraTopBlocks=q.extraTopBlocks();var a=null;a=k("svgCalc");var b={app:"Calc",skin:n.id,response:B.response,level:m,feedbackType:B.testResults,appStrings:{reinfFeedbackMsg:q.reinfFeedbackMsg()},appDiv:a};B.message&&(b.message=B.message),p.displayFeedback(b)}}},{"../../locale/current/calc":152,"../../locale/current/common":153,"../StudioApp":2,"../block_utils":15,"../codegen":38,"../dom":40,"../skins":108,"../templates/page.html":128,"../timeoutList":134,"../utils":148,"./api":26,"./controls.html":29,"./expressionNode":30,"./levels":31,"./visualization.html":33}],33:[function(require,module,exports){module.exports=function(){var t=function anonymous(locals,filters,escape){escape=escape||function(a){return String(a).replace(/&(?!\w+;)/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")};var buf=[];with(locals||{})!function(){buf.push("");var a=require("../../locale/current/calc");buf.push('\n\n<svg xmlns="http://www.w3.org/2000/svg" version="1.1" id="svgCalc">\n  <rect x="0" y="0" width="400" height="300" fill="#33ccff"/>\n  <rect x="0" y="300" width="400" height="100" fill="#996633"/>\n  <text x="0" y="30" class="calcHeader">',escape(a.yourExpression()),'</text>\n  <g id="userExpression" class="expr" transform="translate(0, 100)">\n  </g>\n  <text x="0" y="330" class="calcHeader" id="goalHeader">',escape(a.goal()),'</text>\n  <g id="answerExpression" class="expr" transform="translate(0, 350)">\n  </g>\n</svg>\n')}();return buf.join("")};return function(a){return t(a,require("ejs").filters)}}()},{"../../locale/current/calc":152,ejs:168}],31:[function(a,b){var c=(a("../../locale/current/calc"),a("../block_utils"));b.exports={example1:{solutionBlocks:c.calcBlockXml("functional_times",[c.calcBlockXml("functional_plus",[1,2]),c.calcBlockXml("functional_plus",[3,4])]),ideal:1/0,toolbox:c.createToolbox(c.blockOfType("functional_plus")+c.blockOfType("functional_minus")+c.blockOfType("functional_times")+c.blockOfType("functional_dividedby")+c.blockOfType("functional_math_number")+'<block type="functional_math_number_dropdown">  <title name="NUM" config="0,1,2,3,4,5,6,7,8,9,10">???</title></block>'),startBlocks:"",requiredBlocks:"",freePlay:!1},custom:{answer:"",ideal:1/0,toolbox:"",startBlocks:"",requiredBlocks:"",freePlay:!1}}},{"../../locale/current/calc":152,"../block_utils":15}],29:[function(require,module,exports){module.exports=function(){var t=function anonymous(locals,filters,escape){escape=escape||function(a){return String(a).replace(/&(?!\w+;)/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")};var buf=[];with(locals||{})!function(){buf.push("");require("../../locale/current/calc"),require("../../locale/current/common");buf.push("\n")}();return buf.join("")};return function(a){return t(a,require("ejs").filters)}}()},{"../../locale/current/calc":152,"../../locale/current/common":153,ejs:168}],27:[function(a,b,c){"use strict";function d(a,b){a.Blocks.functional_compute={helpUrl:"",init:function(){h(this,e.compute(),"none",[{name:"ARG1",type:"Number"}])}},b.functional_compute=function(){var a=Blockly.JavaScript.statementToCode(this,"ARG1",!1)||0;return"Calc.compute("+a+", 'block_id_"+this.id+"');\n"}}var e=a("../../locale/current/calc"),f=(a("../../locale/current/common"),a("../sharedFunctionalBlocks")),g=a("../functionalBlockUtils"),h=g.initTitledFunctionalBlock;c.install=function(a,b){var c=(b.skin,a.Generator.get("JavaScript"));a.JavaScript=c;var e=function(b){var d=a.Variables.NAME_TYPE;return c.variableDB_.getDistinctName(b,d)};f.install(a,c,e),d(a,c,e)}},{"../../locale/current/calc":152,"../../locale/current/common":153,"../functionalBlockUtils":69,"../sharedFunctionalBlocks":107}],152:[function(a,b){b.exports=window.blockly.appLocale},{}],26:[function(a,b,c){var d=a("./expressionNode");c.compute=function(a){Calc.computedExpression=a instanceof d?a:new d(parseInt(a,10))},c.expression=function(a,b,c,e){return new d(a,[b,c],e)}},{"./expressionNode":30}],30:[function(a,b){var c=a("../utils"),d=c.getLodash(),e={ARITHMETIC:1,FUNCTION_CALL:2,VARIABLE:3,NUMBER:4},f=function(a,b,c){if(this.value=a,this.blockId=c,void 0===b&&(b=[]),!Array.isArray(b))throw new Error("Expected array");if(this.children=b.map(function(a){return a instanceof f||(a=new f(a)),a}),this.getType()===e.NUMBER&&b.length>0)throw new Error("Can't have args for number ExpressionNode");if(this.getType()===e.ARITHMETIC&&2!==b.length)throw new Error("Arithmetic ExpressionNode needs 2 args")};b.exports=f,f.ValueType=e,f.prototype.getType=function(){return-1!==["+","-","*","/"].indexOf(this.value)?e.ARITHMETIC:"string"==typeof this.value?0===this.children.length?e.VARIABLE:e.FUNCTION_CALL:"number"==typeof this.value?e.NUMBER:void 0},f.prototype.clone=function(){var a=this.children.map(function(a){return a.clone()});return new f(this.value,a,this.blockId)},f.prototype.replaceWith=function(a){if(!(a instanceof f))throw new Error("Must replaceWith ExpressionNode");a=a.clone(),this.value=a.value,this.children=a.children},f.prototype.evaluate=function(){var a=this.getType();if(a===e.VARIABLE||a===e.FUNCTION_CALL)throw new Error("Must resolve variables/functions before evaluation");if(a===e.NUMBER)return this.value;if(a!==e.ARITHMETIC)throw new Error("Unexpected error");var b=this.children[0].evaluate(),c=this.children[1].evaluate();switch(this.value){case"+":return b+c;case"-":return b-c;case"*":return b*c;case"/":return b/c;default:throw new Error("Unknown operator: "+this.value)}},f.prototype.depth=function(){for(var a=0,b=0;b<this.children.length;b++)a=Math.max(a,1+this.children[b].depth());return a},f.prototype.getDeepestOperation=function(){if(0===this.children.length)return null;for(var a=null,b=0,c=0;c<this.children.length;c++){var d=this.children[c].depth();d>b&&(b=d,a=this.children[c])}return 0===b?this:a.getDeepestOperation()},f.prototype.collapse=function(){var a=this.getDeepestOperation();return null===a?!1:this===a?(this.value=this.evaluate(),this.children=[],!0):a.collapse()},f.prototype.getTokenListDiff=function(a){var b,c=a&&this.value===a.value&&this.children.length===a.children.length,f=this.getType();if(0===this.children.length)return[new g(this.value.toString(),!c)];if(f===e.ARITHMETIC)b=[new g("(",!c)],this.children.length>0&&b.push([this.children[0].getTokenListDiff(c&&a.children[0]),new g(" "+this.value+" ",!c),this.children[1].getTokenListDiff(c&&a.children[1])]),b.push(new g(")",!c));else if(f===e.FUNCTION_CALL){b=[new g(this.value,this.value!==a.value),new g("(",!c)];for(var h=0;h<this.children.length;h++)h>0&&b.push(new g(",",!c)),b.push(this.children[h].getTokenListDiff(c&&a.children[h]));b.push(new g(")",!c))}else this.getType()===e.VARIABLE;return d.flatten(b)},f.prototype.getTokenList=function(a){var b=this.depth();if(1>=b)return this.getTokenListDiff(a?null:this);if(this.getType()!==e.ARITHMETIC)throw new Error("Unsupported");var c=this.children[1].depth()>this.children[0].depth();return d.flatten([new g("(",!1),this.children[0].getTokenList(a&&!c),new g(" "+this.value+" ",!1),this.children[1].getTokenList(a&&c),new g(")",!1)])},f.prototype.isIdenticalTo=function(a){if(!a||this.value!==a.value||this.children.length!==a.children.length)return!1;for(var b=0;b<this.children.length;b++)if(!this.children[b].isIdenticalTo(a.children[b]))return!1;return!0},f.prototype.isEquivalentTo=function(a){if(this.getType()!==e.ARITHMETIC)return this.isIdenticalTo(a);if(!a||this.value!==a.value)return!1;var b=this.children[0],c=this.children[1],d=a.children[0],f=a.children[1];return b.isEquivalentTo(d)?c.isEquivalentTo(f):b.isEquivalentTo(f)?c.isEquivalentTo(d):!1};var g=function(a,b){this.str=a,this.marked=b}},{"../utils":148}]},{},[32]);