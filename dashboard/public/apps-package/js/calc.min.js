require=function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};b[g][0].call(k.exports,function(a){var c=b[g][1][a];return e(c?c:a)},k,k.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({38:[function(a){var b=a("../appMain");window.Calc=a("./calc");var c=a("./blocks"),d=a("../skins"),e=a("./levels");window.calcMain=function(a){a.skinsModule=d,a.blocksModule=c,b(window.Calc,e,a)}},{"../appMain":5,"../skins":179,"./blocks":30,"./calc":31,"./levels":37}],31:[function(a,b){"use strict";function c(a,b){if(a instanceof E&&(a=a.expression),b instanceof E&&(b=b.expression),"string"==typeof a){var c=a!==b&&void 0!==b;return[new F(a,c)]}return a?b?a.getTokenListDiff(b):a.getTokenList(!1):null}function d(a){var b=a.computeEquation();if(b&&b.expression){var d,e=0,f=a.hasSingleFunction();if(!f&&!a.computesSingleVariable()){var g=a.sortedEquations();g.forEach(function(a){if(a.isFunction()&&g.length>1)throw new Error("Calc doesn't support goal with multiple functions or mixed functions/vars");d=a.expression.getTokenList(!1),m("answerExpression",a.signature,d,e++)})}d=b.expression.getTokenList(!1);var h=a.evaluate();if(h.err)throw h.err;f&&(d=d.concat(c(" = "+h.result.toString()))),m("answerExpression",b.signature,d,e)}}function e(a){if(a){if(0!==Blockly.mainBlockSpace.getTopBlocks().length)throw new Error("generateTargetExpression shouldn't be called with blocksif we already have blocks in the workspace");u.loadBlocks(a)}var b=new D(Blockly.mainBlockSpace.getTopBlocks());return Blockly.mainBlockSpace.getTopBlocks().forEach(function(a){a.dispose()}),b}function f(a,b){return{result:I.FAILURE,testResults:H.APP_SPECIFIC_FAIL,message:a,failedInput:b}}function g(a){if(a instanceof C.DivideByZeroError)return f(w.divideByZeroError(),null);throw a}function h(a){return a===H.QUESTION_MARKS_IN_NUMBER_FIELD||a===H.EMPTY_FUNCTIONAL_BLOCK||a===H.EXTRA_TOP_BLOCKS_FAIL}function i(){var a;k();var b=M.userSet.computeEquation();if(null!==b&&null!==b.expression){var d,e=!M.targetSet.hasSingleFunction()&&!M.targetSet.computesSingleVariable(),f=0;if(M.userSet.sortedEquations().forEach(function(a){var b=e?M.targetSet.getEquation(a.name):null;d=c(a,b),m("userExpression",a.signature,d,f++,"errorToken")}),!M.userSet.computesSingleConstant()){var g=M.targetSet&&M.targetSet.computeEquation();d=c(b,g);var h=M.userSet.evaluate(),i=!1;if(h.err){if(!(h.err instanceof C.DivideByZeroError))throw h.err;i=!0}if(!i){a=h.result.toString();var j=a;null===M.targetSet.computeEquation()||M.targetSet.computesSingleVariable()||(j=M.targetSet.evaluate().result.toString()),d=d.concat(c(" = "),c(a,j))}if(m("userExpression",null,d,f++,"errorToken"),M.failedInput){for(var l=b.expression.clone(),n=0;n<l.numChildren();n++)l.setChildValue(n,M.failedInput[n]);if(h=M.userSet.evaluateWithExpression(l),h.err){if(!(h.err instanceof C.DivideByZeroError))throw h.err;h.result=""}a=h.result.toString(),d=c(l).concat(c(" = ")).concat(c(a," ")),m("userExpression",null,d,f++,"errorToken")}}}}function j(){M.animating=!1,p()}function k(){for(var a=document.getElementById("userExpression"),b=a.childNodes.length-1;b>=0;b--)a.removeChild(a.childNodes[b])}function l(a){var b=M.userSet.computeEquation();if(!b)throw new Error("require user expression");var c=b.expression;if(!c)return!0;var d=!1;if(M.userSet.hasVariablesOrFunctions()||M.targetSet.hasVariablesOrFunctions())throw new Error("Can't animate if either user/target have functions/vars");k();for(var e=c.clone(),f=e,g=0,h=0;a>=h&&!d;h++){var i;if(g===a)i=e.getTokenListDiff(f);else if(g+1===a){var j=e.getDeepestOperation();j&&u.highlight("block_id_"+j.blockId),i=e.getTokenList(!0)}else i=e.getTokenList(!1);m("userExpression",null,i,g,"markedToken"),f=e.clone(),e.isDivZero()&&(d=!0),e.collapse()?g++:h===g+1&&(d=!0)}return d}function m(a,b,c,d,e){var f=document.getElementById(a),g=document.createElementNS(Blockly.SVG_NS,"g");f.appendChild(g);var h,i=0;b&&(h=n(g,b+" = ",i,null),i+=h);for(var j=0;j<c.length;j++)h=n(g,c[j].str,i,c[j].marked&&e),i+=h;var k=(K-g.getBoundingClientRect().width)/2,l=d*L;g.setAttribute("transform","translate("+k+", "+l+")")}function n(a,b,c,d){var e,f;return e=document.createElementNS(Blockly.SVG_NS,"text"),e.textContent=b.replace(/ /g,"_"),a.appendChild(e),f=e.getComputedTextLength?e.getComputedTextLength():0,e.textContent=b,e.setAttribute("x",c+f/2),e.setAttribute("text-anchor","middle"),d&&e.setAttribute("class",d),f}function o(a){for(var b=document.getElementById(a).cloneNode(!0),c=b.getElementsByTagName("*"),d=0;d<c.length;d++){var e=c[d];e.removeAttribute("id")}return b}function p(){if(!M.waitingForReport&&!M.animating){r.extraTopBlocks=w.extraTopBlocks();var a=null;h(M.testResults)||(a=o("svgCalc"));var b={app:"Calc",skin:s.id,response:M.response,level:r,feedbackType:M.testResults,tryAgainText:r.freePlay?v.keepPlaying():void 0,appStrings:{reinfFeedbackMsg:w.reinfFeedbackMsg()},appDiv:a};M.message&&!r.edit_blocks&&(b.message=M.message),u.displayFeedback(b)}}function q(a){var b=document.getElementById("runButton");b.disabled=!1,M.response=a,M.waitingForReport=!1,p()}var r,s,t=b.exports,u=a("../StudioApp").singleton,t=b.exports,v=a("../../locale/current/common"),w=a("../../locale/current/calc"),x=(a("../skins"),a("./levels"),a("../templates/page.html")),y=a("../dom"),z=a("../block_utils"),A=a("../utils").getLodash(),B=a("../timeoutList"),C=a("./expressionNode"),D=a("./equationSet"),E=a("./equation"),F=C.Token,G=a("./inputIterator"),H=u.TestResults,I=u.ResultType;u.setCheckForEmptyBlocks(!1);var J=400,K=400,L=20,M={targetSet:null,userSet:null,animating:!1,waitingForReport:!1,response:null,message:null,result:null,testResults:null,failedInput:null};t.appState_=M;var N=2e3;t.init=function(b){s=b.skin,r=b.level,r.scale&&void 0!==r.scale.stepSpeed&&(N=r.scale.stepSpeed),b.grayOutUndeletableBlocks=!0,b.forceInsertTopBlock="functional_compute",b.enableShowCode=!1,b.html=x({assetUrl:u.assetUrl,data:{localeDirection:u.localeDirection(),visualization:a("./visualization.html")(),controls:a("./controls.html")({assetUrl:u.assetUrl}),blockUsed:void 0,idealBlockNumber:void 0,editCode:r.editCode,blockCounterClass:"block-counter-default"}}),b.loadAudio=function(){u.loadAudio(s.winSound,"win"),u.loadAudio(s.startSound,"start"),u.loadAudio(s.failureSound,"failure")},b.afterInject=function(){var a=document.getElementById("svgCalc");a.setAttribute("width",K),a.setAttribute("height",J),r.freePlay&&document.getElementById("goalHeader").setAttribute("visibility","hidden"),Blockly.BROKEN_CONTROL_POINTS=!1,Blockly.JavaScript.addReservedWords("Calc,code");var c=r.solutionBlocks;r.solutionBlocks&&""!==r.solutionBlocks&&(c=z.forceInsertTopBlock(r.solutionBlocks,b.forceInsertTopBlock)),M.targetSet=e(c),d(M.targetSet);var f=document.getElementById("visualizationColumn");f.style.width="400px";var g=document.getElementById("resetButton");y.addClickTouchEvent(g,t.resetButtonClick)},u.init(b)},u.runButtonClick=function(){u.toggleRunReset("reset"),Blockly.mainBlockSpace.traceOn(!0),u.attempts++,t.execute()},t.resetButtonClick=function(){M.animating=!1,M.waitingForReport=!1,M.response=null,M.message=null,M.result=null,M.testResults=null,M.failedInput=null,B.clearTimeouts(),k()},t.evaluateFunction_=function(a,b){var c={result:I.UNSET,testResults:H.NO_TESTS_RUN,message:void 0,failedInput:null},d=a.computeEquation().expression.clone(),e=b.computeEquation(),f=e&&e.expression;if(!d.hasSameSignature(f)||!b.hasSingleFunction())return c.result=I.FAILURE,c.testResults=H.LEVEL_INCOMPLETE_FAIL,c;var h=a.evaluateWithExpression(d),i=b.evaluateWithExpression(d);if(h.err||i.err)return g(h.err||i.err);if(h.result!==i.result)return c.result=I.FAILURE,c.testResults=H.LEVEL_INCOMPLETE_FAIL,c;for(var j=A.range(1,101).concat(A.range(-0,-101,-1)),k=d.numChildren(),l=new G(j,k),m=function(a,b){d.setChildValue(b,a)};l.remaining()>0&&!c.failedInput;){var n=l.next();if(n.forEach(m),h=a.evaluateWithExpression(d),i=b.evaluateWithExpression(d),h.err||i.err)return g(h.err||i.err);h.result!==i.result&&(c.failedInput=A.clone(n))}return c.failedInput?(c.result=I.FAILURE,c.testResults=H.APP_SPECIFIC_FAIL,c.message=w.failedInput()):a.computeEquation().expression.isIdenticalTo(b.computeEquation().expression)?(c.result=I.SUCCESS,c.testResults=H.ALL_PASS):(c.result=I.FAILURE,c.testResults=H.APP_SPECIFIC_FAIL,c.message=w.wrongInput()),c},t.evaluateSingleVariable_=function(a,b){var c={result:I.UNSET,testResults:H.NO_TESTS_RUN,message:void 0,failedInput:null};if(!a.computeEquation().expression.isIdenticalTo(b.computeEquation().expression))return f(w.levelIncompleteError());var d=a.getConstants();if(0===d.length)throw new Error("Unexpected: single variable with no constants");if(1!==d.length)throw new Error("No support for multiple constants");for(var e=b.getConstants(),h=e.map(function(a){return a.name}),i=0;i<d.length;i++)if(-1===h.indexOf(d[i].name))return f(w.missingVariableX({"var":d[i].name}));var j=b.evaluate();if(j.err)return g(j.err);var k=j.result,l=a.clone(),m=b.clone(),n=function(a,b){var c=d[b].name;l.getEquation(c).expression.setValue(a),m.getEquation(c).expression.setValue(a)};if(j=a.evaluate(),j.err)throw j.err;var o=j.result;if(k!==o){if(d.forEach(function(a,b){var c=a.name,d=m.getEquation(c).expression.getValue();n(d,b)}),j=l.evaluate(),j.err)return g(j.err);if(k!==j.result)return f(w.wrongResult())}for(var p=A.range(1,101).concat(A.range(-0,-101,-1)),q=d.length,r=new G(p,q);r.remaining()>0&&!c.failedInput;){var s=r.next();s.forEach(n);var t=l.evaluate(),u=m.evaluate(),v=t.err||u.err;if(v)return g(v);t.result!==u.result&&(c.failedInput=A.clone(s))}if(c.failedInput){var x=w.wrongOtherValuesX({"var":d[0].name});return f(x)}return c.result=I.SUCCESS,c.testResults=H.ALL_PASS,c},t.evaluateResults_=function(a,b){var c,d,e,f={result:I.UNSET,testResults:H.NO_TESTS_RUN,message:void 0,failedInput:null};if(a.hasSingleFunction())return t.evaluateFunction_(a,b);if(a.computesSingleVariable())return t.evaluateSingleVariable_(a,b);if(b.hasVariablesOrFunctions()||a.hasVariablesOrFunctions())return a.isIdenticalTo(b)?(f.result=I.SUCCESS,f.testResults=H.ALL_PASS):(f.result=I.FAILURE,f.testResults=H.LEVEL_INCOMPLETE_FAIL),f;if(d=b.computeEquation(),e=a.computeEquation(),c=a.isIdenticalTo(b))f.result=I.SUCCESS,f.testResults=H.ALL_PASS;else{f.result=I.FAILURE;var g=f.result===I.SUCCESS;f.testResults=u.getTestResults(g),e&&d.expression&&d.expression.isEquivalentTo(e.expression)&&(f.testResults=H.APP_SPECIFIC_FAIL,f.message=w.equivalentExpression())}return f},t.execute=function(){t.generateResults_();var a=Blockly.Xml.blockSpaceToDom(Blockly.mainBlockSpace),b=Blockly.Xml.domToText(a),c={app:"calc",level:r.id,builder:r.builder,result:M.result===I.SUCCESS,testResult:M.testResults,program:encodeURIComponent(b),onComplete:q};return M.waitingForReport=!0,u.report(c),u.playAudio(M.result===I.SUCCESS?"win":"failure"),h(M.testResults)?p():(M.animating=!0,void(M.result!==I.SUCCESS||M.userSet.hasVariablesOrFunctions()||r.edit_blocks?(i(),B.setTimeout(function(){j()},N)):t.step(0)))},t.generateResults_=function(){if(M.message=void 0,u.hasExtraTopBlocks())return M.result=I.FAILURE,void(M.testResults=H.EXTRA_TOP_BLOCKS_FAIL);if(u.hasUnfilledBlock()){M.result=I.FAILURE,M.testResults=H.EMPTY_FUNCTIONAL_BLOCK;var a=A.find(Blockly.mainBlockSpace.getTopBlocks(),function(a){return"functional_compute"===a.type});return void(M.message=a&&!a.getInputTargetBlock("ARG1")?w.emptyComputeBlock():w.emptyFunctionalBlock())}if(u.hasQuestionMarksInNumberField())return M.result=I.FAILURE,void(M.testResults=H.QUESTION_MARKS_IN_NUMBER_FIELD);if(M.userSet=new D(Blockly.mainBlockSpace.getTopBlocks()),M.failedInput=null,M.userSet.hasDivZero())return M.result=I.FAILURE,M.testResults=H.APP_SPECIFIC_FAIL,void(M.message=w.divideByZeroError());if(r.freePlay||r.edit_blocks)M.result=I.SUCCESS,M.testResults=H.FREE_PLAY;else{var b=t.evaluateResults_(M.targetSet,M.userSet);M.result=b.result,M.testResults=b.testResults,M.message=b.message,M.failedInput=b.failedInput}M.testResults!==H.LEVEL_INCOMPLETE_FAIL||M.message||(M.message=w.levelIncompleteError())},t.step=function(a){var b=l(a);B.setTimeout(function(){b?(l(a+1),j()):t.step(a+1)},N)},t.__testonly__={displayGoal:d,displayComplexUserExpressions:i,appState:M}},{"../../locale/current/calc":229,"../../locale/current/common":230,"../StudioApp":4,"../block_utils":19,"../dom":48,"../skins":179,"../templates/page.html":204,"../timeoutList":210,"../utils":225,"./controls.html":32,"./equation":33,"./equationSet":34,"./expressionNode":35,"./inputIterator":36,"./levels":37,"./visualization.html":39}],39:[function(require,module,exports){module.exports=function(){var t=function anonymous(locals,filters,escape){escape=escape||function(a){return String(a).replace(/&(?!\w+;)/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")};var buf=[];with(locals||{})!function(){buf.push("");var a=require("../../locale/current/calc");buf.push('\n\n<svg xmlns="http://www.w3.org/2000/svg" version="1.1" id="svgCalc">\n  <rect x="0" y="0" width="400" height="300" fill="#33ccff"/>\n  <rect x="0" y="300" width="400" height="100" fill="#996633"/>\n  <text x="0" y="30" class="calcHeader">',escape(a.yourExpression()),'</text>\n  <g id="userExpression" class="expr" transform="translate(0, 100)">\n  </g>\n  <text x="0" y="330" class="calcHeader" id="goalHeader">',escape(a.goal()),'</text>\n  <g id="answerExpression" class="expr" transform="translate(0, 350)">\n  </g>\n</svg>\n')}();return buf.join("")};return function(a){return t(a,require("ejs").filters)}}()},{"../../locale/current/calc":229,ejs:246}],37:[function(a,b){var c=(a("../../locale/current/calc"),a("../block_utils"));b.exports={example1:{solutionBlocks:c.calcBlockXml("functional_times",[c.calcBlockXml("functional_plus",[1,2]),c.calcBlockXml("functional_plus",[3,4])]),ideal:1/0,toolbox:c.createToolbox(c.blockOfType("functional_plus")+c.blockOfType("functional_minus")+c.blockOfType("functional_times")+c.blockOfType("functional_dividedby")+c.blockOfType("functional_math_number")+'<block type="functional_math_number_dropdown">  <title name="NUM" config="0,1,2,3,4,5,6,7,8,9,10">???</title></block>'),startBlocks:"",requiredBlocks:"",freePlay:!1},custom:{answer:"",ideal:1/0,toolbox:"",startBlocks:"",requiredBlocks:"",freePlay:!1}}},{"../../locale/current/calc":229,"../block_utils":19}],36:[function(a,b){var c=function(a,b){this.numParams_=b,this.remaining_=Math.pow(a.length,b),this.availableValues_=a,this.indices_=[-1];for(var c=1;b>c;c++)this.indices_[c]=0};b.exports=c,c.prototype.next=function(){if(0===this.remaining_)throw new Error("empty");var a,b=0;do a=!1,this.indices_[b]++,this.indices_[b]===this.availableValues_.length&&(this.indices_[b]=0,b++,a=!0);while(a&&b<this.numParams_);return this.remaining_--,this.indices_.map(function(a){return this.availableValues_[a]},this)},c.prototype.remaining=function(){return this.remaining_}},{}],34:[function(a,b){function c(a){var b;if(!a)return null;var d=a.getChildren()[0];switch(a.type){case"functional_compute":return d?c(d):new f(null,[],null);case"functional_plus":case"functional_minus":case"functional_times":case"functional_dividedby":case"functional_pow":case"functional_sqrt":case"functional_squared":var g=a.getTitles()[0].getValue(),h=["ARG1"];a.getInput("ARG2")&&h.push("ARG2");var i=h.map(function(b){var d=a.getInputTargetBlock(b);return d?c(d).expression:0});return new f(null,[],new e(g,i,a.id));case"functional_math_number":case"functional_math_number_dropdown":var j=a.getTitleValue("NUM")||0;return"???"===j&&(j=0),new f(null,[],new e(parseFloat(j),[],a.id));case"functional_call":b=a.getCallName();var k=Blockly.Procedures.getDefinition(b,Blockly.mainBlockSpace);if(k.isVariable())return new f(null,[],new e(b));for(var l,m,n=[],o=0;l=a.getInput("ARG"+o);o++)m=l.connection.targetBlock(),n.push(m?c(m).expression:new e(0));return new f(null,[],new e(b,n));case"functional_definition":b=a.getTitleValue("NAME");var p=d?c(d).expression:new e(0);return new f(b,a.getVars(),p);case"functional_parameters_get":return new f(null,[],new e(a.getTitleValue("VAR")));case"functional_example":return null;default:throw"Unknown block type: "+a.type}}var d=a("../utils").getLodash(),e=a("./expressionNode"),f=a("./equation"),g=function(a){this.compute_=null,this.equations_=[],a&&a.forEach(function(a){var b=c(a);b&&this.addEquation_(b)},this)};b.exports=g,g.prototype.clone=function(){var a=new g;return a.compute_=null,this.compute_&&(a.compute_=this.compute_.clone()),a.equations_=this.equations_.map(function(a){return a.clone()}),a},g.prototype.addEquation_=function(a){if(a.name){if(this.getEquation(a.name))throw new Error("equation already exists: "+a.name);this.equations_.push(a)}else{if(this.compute_)throw new Error("compute expression already exists");this.compute_=a}},g.prototype.getEquation=function(a){if(null===a)return this.computeEquation();for(var b=0;b<this.equations_.length;b++)if(this.equations_[b].name===a)return this.equations_[b];return null},g.prototype.computeEquation=function(){return this.compute_},g.prototype.hasVariablesOrFunctions=function(){return this.equations_.length>0},g.prototype.hasSingleFunction=function(){return 1===this.equations_.length&&this.equations_[0].isFunction()?!0:!1},g.prototype.computesSingleVariable=function(){if(!this.compute_)return!1;var a=this.compute_.expression;return a.isVariable()},g.prototype.computesSingleConstant=function(){if(!this.compute_||1!==this.equations_.length)return!1;var a=this.equations_[0],b=this.compute_.expression;return b.isVariable()&&a.expression.isNumber()&&b.getValue()===a.name},g.prototype.getConstants=function(){return this.equations_.filter(function(a){return 0===a.params.length&&a.expression.isNumber()})},g.prototype.isIdenticalTo=function(a){if(this.equations_.length!==a.equations_.length)return!1;var b=a.computeEquation().expression;if(!this.compute_.expression.isIdenticalTo(b))return!1;for(var c=0;c<this.equations_.length;c++){var d=this.equations_[c],e=a.getEquation(d.name);if(!e||!d.expression.isIdenticalTo(e.expression))return!1}return!0},g.prototype.sortedEquations=function(){return this.equations_.sort(function(a,b){return a.name.localeCompare(b.name)}),this.equations_},g.prototype.hasDivZero=function(){var a=this.evaluate();return a.err&&a.err instanceof e.DivideByZeroError},g.prototype.evaluate=function(){return this.evaluateWithExpression(this.compute_.expression)},g.prototype.evaluateWithExpression=function(a){if(0===this.equations_.length)return a.evaluate();var b,c,f,g={},h=function(a){c[a]=1};do{b=!1;for(var i=0;i<this.equations_.length;i++){var j=this.equations_[i];if(j.isFunction()){if(g[j.name])continue;if(c=d.clone(g),j.params.forEach(h),f=j.expression.evaluate(c),f.err){if(f.err instanceof e.DivideByZeroError)return{err:f.err};continue}b=!0,g[j.name]={variables:j.params,expression:j.expression}}else if(void 0===g[j.name])if(f=j.expression.evaluate(g),f.err){if(f.err instanceof e.DivideByZeroError)return{err:f.err}}else b=!0,g[j.name]=f.result}}while(b);return a.evaluate(g)},g.__testonly__={getEquationFromBlock:c}},{"../utils":225,"./equation":33,"./expressionNode":35}],35:[function(a,b){function c(a){this.message=a||""}var d=a("../utils"),e=d.getLodash(),f={ARITHMETIC:1,FUNCTION_CALL:2,VARIABLE:3,NUMBER:4},g=function(a,b,c){if(this.value_=a,this.blockId_=c,void 0===b&&(b=[]),!Array.isArray(b))throw new Error("Expected array");if(this.children_=b.map(function(a){return a instanceof g||(a=new g(a)),a}),this.isNumber()&&b.length>0)throw new Error("Can't have args for number ExpressionNode");if(this.isArithmetic()&&2!==b.length&&1!==b.length)throw new Error("Arithmetic ExpressionNode needs 1 or 2 args")};b.exports=g,g.DivideByZeroError=c,g.prototype.getType_=function(){return-1!==["+","-","*","/","pow","sqrt","sqr"].indexOf(this.value_)?f.ARITHMETIC:"string"==typeof this.value_?0===this.children_.length?f.VARIABLE:f.FUNCTION_CALL:"number"==typeof this.value_?f.NUMBER:void 0},g.prototype.isArithmetic=function(){return this.getType_()===f.ARITHMETIC},g.prototype.isFunctionCall=function(){return this.getType_()===f.FUNCTION_CALL},g.prototype.isVariable=function(){return this.getType_()===f.VARIABLE},g.prototype.isNumber=function(){return this.getType_()===f.NUMBER},g.prototype.isDivZero=function(){return"/"===this.getValue()&&0===this.getChildValue(1)},g.prototype.clone=function(){var a=this.children_.map(function(a){return a.clone()});return new g(this.value_,a,this.blockId_)},g.prototype.evaluate=function(a,b){try{a=a||{},b=b||{};var e=this.getType_();if(e===f.VARIABLE){var g=d.valueOr(b[this.value_],a[this.value_]);if(void 0===g)throw new Error("No mapping for variable during evaluation");var h=this.clone();return h.setValue(g),h.evaluate(a)}if(e===f.FUNCTION_CALL){var i=d.valueOr(b[this.value_],a[this.value_]);if(void 0===i)throw new Error("No mapping for function during evaluation");if(!i.variables||!i.expression)throw new Error("Bad mapping for: "+this.value_);if(i.variables.length!==this.children_.length)throw new Error("Bad mapping for: "+this.value_);var j={};return i.variables.forEach(function(a,c){var e=this.getChildValue(c);j[a]=d.valueOr(b[e],e)},this),i.expression.evaluate(a,j)}if(e===f.NUMBER)return{result:this.value_};if(e!==f.ARITHMETIC)throw new Error("Unexpected");var k=this.children_[0].evaluate(a,b);if(k.err)throw k.err;if(k=k.result,1===this.children_.length)switch(this.value_){case"sqrt":return{result:Math.sqrt(k)};case"sqr":return{result:k*k};default:throw new Error("Unknown operator: "+this.value_)}var l=this.children_[1].evaluate(a,b);if(l.err)throw l.err;switch(l=l.result,this.value_){case"+":return{result:k+l};case"-":return{result:k-l};case"*":return{result:k*l};case"/":if(0===l)throw new c;return{result:k/l};case"pow":return{result:Math.pow(k,l)};default:throw new Error("Unknown operator: "+this.value_)}}catch(m){return{err:m}}},g.prototype.depth=function(){for(var a=0,b=0;b<this.children_.length;b++)a=Math.max(a,1+this.children_[b].depth());return a},g.prototype.getDeepestOperation=function(){if(0===this.children_.length)return null;for(var a=null,b=0,c=0;c<this.children_.length;c++){var d=this.children_[c].depth();d>b&&(b=d,a=this.children_[c])}return 0===b?this:a.getDeepestOperation()},g.prototype.collapse=function(){var a=this.getDeepestOperation();if(null===a)return!1;if(this===a){var b=this.evaluate();return b.err?!1:(this.value_=b.result,this.children_=[],!0)}return a.collapse()},g.prototype.getTokenListDiff=function(a){var b,c=a&&this.value_===a.value_&&this.children_.length===a.children_.length,d=this.getType_();if(0===this.children_.length)return[new h(this.value_.toString(),!c)];if(d===f.ARITHMETIC)b=[new h("(",!c)],this.children_.length>0&&b.push([this.children_[0].getTokenListDiff(c&&a.children_[0]),new h(" "+this.value_+" ",!c),this.children_[1].getTokenListDiff(c&&a.children_[1])]),b.push(new h(")",!c));else if(d===f.FUNCTION_CALL){b=[new h(this.value_,this.value_!==a.value_),new h("(",!c)];for(var g=0;g<this.children_.length;g++)g>0&&b.push(new h(",",!c)),b.push(this.children_[g].getTokenListDiff(c&&a.children_[g]));b.push(new h(")",!c))}else this.getType_()===f.VARIABLE;return e.flatten(b)},g.prototype.getTokenList=function(a){var b=this.depth();if(1>=b)return this.getTokenListDiff(a?null:this);if(this.getType_()!==f.ARITHMETIC)throw new Error("Unsupported");var c=this.children_[1].depth()>this.children_[0].depth();return e.flatten([new h("(",!1),this.children_[0].getTokenList(a&&!c),new h(" "+this.value_+" ",!1),this.children_[1].getTokenList(a&&c),new h(")",!1)])},g.prototype.isIdenticalTo=function(a){if(!a||this.value_!==a.value_||this.children_.length!==a.children_.length)return!1;for(var b=0;b<this.children_.length;b++)if(!this.children_[b].isIdenticalTo(a.children_[b]))return!1;return!0},g.prototype.hasSameSignature=function(a){return a?this.getType_()!==f.FUNCTION_CALL||a.getType_()!==f.FUNCTION_CALL?!1:this.value_!==a.value_?!1:this.children_.length!==a.children_.length?!1:!0:!1},g.prototype.isEquivalentTo=function(a){if(this.getType_()!==f.ARITHMETIC)return this.isIdenticalTo(a);if(!a||this.value_!==a.value_)return!1;var b=this.children_[0],c=this.children_[1],d=a.children_[0],e=a.children_[1];return b.isEquivalentTo(d)?c.isEquivalentTo(e):b.isEquivalentTo(e)?c.isEquivalentTo(d):!1},g.prototype.numChildren=function(){return this.children_.length},g.prototype.getValue=function(){return this.value_},g.prototype.setValue=function(a){var b=this.getType_();if(b!==f.VARIABLE&&b!==f.NUMBER)throw new Error("Can't modify value");this.value_=a},g.prototype.getChildValue=function(a){return this.children_[a].value_},g.prototype.setChildValue=function(a,b){return this.children_[a].setValue(b)},g.prototype.debug=function(){return 0===this.children_.length?this.value_:"("+this.value_+" "+this.children_.map(function(a){return a.debug()}).join(" ")+")"};var h=function(a,b){this.str=a,this.marked=b};g.Token=h},{"../utils":225}],33:[function(a,b){var c=function(a,b,c){if(this.name=a,this.params=b||[],this.expression=c,3!==arguments.length)throw new Error("Equation requires name, params, and expression");this.signature=this.name,this.params.length>0&&(this.signature+="("+this.params.join(",")+")")};b.exports=c,c.prototype.isFunction=function(){return this.params.length>0},c.prototype.clone=function(){return new c(this.name,this.params.slice(),this.expression.clone())}},{}],32:[function(require,module,exports){module.exports=function(){var t=function anonymous(locals,filters,escape){escape=escape||function(a){return String(a).replace(/&(?!\w+;)/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")};var buf=[];with(locals||{})!function(){buf.push("");require("../../locale/current/calc"),require("../../locale/current/common");buf.push("\n")}();return buf.join("")};return function(a){return t(a,require("ejs").filters)}}()},{"../../locale/current/calc":229,"../../locale/current/common":230,ejs:246}],30:[function(a,b,c){"use strict";function d(a,b){a.Blocks.functional_compute={helpUrl:"",init:function(){a.FunctionalBlockUtils.initTitledFunctionalBlock(this,e.evaluate(),a.BlockValueType.NONE,[{name:"ARG1",type:a.BlockValueType.NUMBER}])}},b.functional_compute=function(){var a=Blockly.JavaScript.statementToCode(this,"ARG1",!1)||0;return"Calc.compute("+a+", 'block_id_"+this.id+"');\n"}}var e=a("../../locale/current/calc"),f=(a("../../locale/current/common"),a("../sharedFunctionalBlocks"));c.install=function(a,b){var c=(b.skin,a.Generator.get("JavaScript"));a.JavaScript=c;var e=function(b){var d=a.Variables.NAME_TYPE;return c.variableDB_.getDistinctName(b,d)};f.install(a,c,e),d(a,c,e)}},{"../../locale/current/calc":229,"../../locale/current/common":230,"../sharedFunctionalBlocks":178}],229:[function(a,b){b.exports=window.blockly.appLocale},{}]},{},[38]);