<%# Note this file must be indented one level, as it is a child of 'Resources'. %>
# -----------------------------------------------
# Begin codeprojects.org resources
# 
# This template component includes resources for the codeprojects.org
# infrastructure. Currently this is mostly manually deployed.
# 
# -----------------------------------------------

<%- if rack_env?(:staging) -%>
# Developer Resources (Deployed with Staging)
LocalhostCodeprojectsRecord:
  Type: AWS::Route53::RecordSet
  Properties:
    HostedZoneId: <%= codeprojects_hostedzone_id %>
    Name: <%="localhost.#{domain}"%>
    Type: A
    TTL: 3600
    ResourceRecords:
      - 127.0.0.1
<%- end -%>

CodeprojectsCertificate:
  Type: AWS::CertificateManager::Certificate
  Properties:
    DomainName: <%= codeprojects_hostname %>
    <%- if rack_env?(:production) -%>
    SubjectAlternativeNames:
      - www.<%= codeprojects_hostname %>
    <%- end -%>
    ValidationMethod: DNS
    DomainValidationOptions:
      - DomainName: <%= codeprojects_hostname %>
        HostedZoneId: <%= codeprojects_hostedzone_id %>
      <%- if rack_env?(:production) -%>
      - DomainName: www.<%= codeprojects_hostname %>
        HostedZoneId: <%= codeprojects_hostedzone_id %>
      <%- end -%>

# -----------------------------------------------
# End codeprojects.org resources
# -----------------------------------------------
