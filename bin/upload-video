#!/usr/bin/env ruby

# Command-line wrapper script for Youtube#process.
# See Youtube#process for description.

# Usage:
# upload-video youtube_id [video_filename]

# To use this script to process all YouTube video tags in custom levels, run this command from the root folder (between =begin and =end):
=begin
grep -ERoh "(http:|https:)?\/\/(www\.)?(youtube|youtubeeducation)\.com\/embed\/([^\"\&\?\/\s]{11})" ./dashboard/config/scripts | \
  cut -d '/' -f5 | \
  sort | \
  uniq | \
  parallel bin/upload-video
=end

require_relative '../deployment'

require 'cdo/aws/s3'
require 'tmpdir'
require 'open-uri'
require 'cdo/video/youtube'

VIDEO_BUCKET = 'videos.code.org'

def usage
  puts 'Usage: upload-video youtube_id [video_filename]'
end

def main
  if ARGV.length < 1
    usage and return
  end
  id = ARGV[0]
  filename = ARGV[1]
  if id.nil?
    usage and return
  end
  Youtube.process(id, filename)
end

main
