#!/usr/bin/env ruby
require 'fileutils'

# Pulls in all strings that need to be translated. Pulls source
# files from pegasus/sites.v3/hourofcode.com and collects them
# to a single source folder i18n/locales/source.

def pull_in_files_for_translation
  orig_dir = "pegasus/sites.v3/hourofcode.com/public"
  dest_dir = "i18n/locales/source/hourofcode"

  # Copy the file containing developer-added strings
  Dir.mkdir(dest_dir) unless Dir.exist?(dest_dir)
  FileUtils.cp("pegasus/sites.v3/hourofcode.com/i18n/en.yml", dest_dir)

  # Copy the markdown files representing individual page content
  Dir.glob(File.join(orig_dir, "**/*.{md,md.partial}")).each do |file|
    dest = file.sub(orig_dir, dest_dir)
    if File.extname(dest) == '.partial'
      dest = File.join(File.dirname(dest), File.basename(dest, '.partial'))
    end

    FileUtils.mkdir_p(File.dirname(dest))
    FileUtils.cp(file, dest)
  end
end

pull_in_files_for_translation
