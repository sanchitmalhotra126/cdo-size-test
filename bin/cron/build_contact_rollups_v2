#!/usr/bin/env ruby

require_relative '../../dashboard/config/environment'
require_relative '../../dashboard/lib/contact_rollups_v2'
require 'cdo/only_one'

def main
  contact_rollups = ContactRollupsV2.new
  contact_rollups.collect_and_process_contacts
  contact_rollups.sync_new_contacts_with_pardot
  contact_rollups.sync_updated_contacts_with_pardot
ensure
  contact_rollups.report_results
end

main if only_one_running?(__FILE__)
