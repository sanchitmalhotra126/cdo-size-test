-name_s ||= nil
-headline_s ||= nil
-email_s ||= nil
-location_s ||= nil
-time_commitment_s ||= nil
-location_flexibility_ss ||= nil
-languages_ss ||= nil
-languages_other_ss ||= nil
-experience_s ||= nil
-description_s ||= nil
-linkedin_s ||= nil
-facebook_s ||= nil
-skype_s ||= nil
-helpouts_s ||= nil
-allow_contact_b ||= nil
-form ||= nil

%script{type: "text/javascript", src: "/js/sifter.min.js"}
%script{type: "text/javascript", src: "/js/microplugin.min.js"}
%script{type: "text/javascript", src: "/js/selectize.min.js"}
%script{type: "text/javascript", src: "/js/selectize-fast-click.js"}
%link{rel: "stylesheet", type: "text/css", href: "/css/selectize.bootstrap3.css"}/
%script{type: "text/javascript", src: "https://maps.googleapis.com/maps/api/js?client=#{CDO.google_maps_client_id}&sensor=false&libraries=places,geometry&v=3.7"}

/[if lt IE 9]
  %script{src: "/js/es5-shim.min.js"}

-SOLR = Solr::Server.new(host:CDO.solr_server)
-num_teachers = SOLR.query(q:"kind_s:\"HocSignup2015\" && match_volunteer_flag_b:true").getResults().getNumFound();

%h1 Volunteer for the Hour of Code
%h3{style: 'color: #00adbc; font-size: 1.125em;'}
  = "#{format_integer_with_commas(num_teachers)} teachers have signed up for the Hour of Code and would like a volunteer to help them."
%form#volunteer-engineer-submit-form{role: "form", onsubmit: "return volunteerEngineerFormSubmit()"}
  %p.form-intro-text Please enter the following information if you are a computer science student or software professional, and you’re interested in helping local teachers for the Hour of Code. Fields marked with a <span class="form-required-field">*</span> are required.
  #error-message{style: 'display: none'}

  %h2 Information shared with teachers on volunteer map

  .form-group
    %label.control-label{for: "volunteer-name"} Name
    %span.form-required-field *
    %div
      %input#volunteer-name.form-control{name: "name_s", placeholder: "Full Name", type: "text", required: true, value: name_s}/

  .form-group
    %label.control-label{for: "volunteer-headline"} Headline
    %span.form-required-field *
    %div
      %input#volunteer-headline.form-control{name: "headline_s", placeholder: "Title, Company", type: "text", required: true, value: headline_s}/

  .form-group
    %label.control-label{for: "volunteer-experience"} Experience level
    %span.form-required-field *
    %div
      %select#volunteer-experience.form-control{name: "experience_s", type: "select", required: true}
        %option{selected: experience_s.nil_or_empty?, value: ""}
        -VolunteerEngineerSubmission.experiences.each_pair do |key,label|
          %option{value: key, selected: key == experience_s}= label

  .form-group
    %label.control-label{for: "volunteer-location"} Location
    %span.form-required-field *
    %p If you enter your exact address we won't share it, just show you as a pin on map.
    %div
      %input#volunteer-location.form-control{name: "location_s", placeholder: "ZIP code, city and state/country, or street address", type: "text", required: true, value: location_s}/

  .form-group
    %label.control-label{for: "volunteer-location-flexibility"} I can help during the Hour of Code by... (select all that apply)
    %span.form-required-field *
    %div
      %select#volunteer-location-flexibility.form-control{name: "location_flexibility_ss[]", type: "select", required: true, multiple: true}
        %option{selected: location_flexibility_ss.nil_or_empty?, value: ""}
        -VolunteerEngineerSubmission.locations.each_pair do |key,label|
          %option{value: key, selected: (location_flexibility_ss||[]).include?(key)}= label

  .form-group
    .checkbox
      %label
        %input#volunteer-after-hoc{name: "volunteer_after_hoc_b", type: "checkbox", value: "1"}/
        I’m interested in volunteering after the Hour of Code

  .form-group{style: "display: none;"}
    %label.control-label{for: "volunteer-time-commitment"} Time commitment after the Hour of Code
    %div
      %select#volunteer-time-commitment.form-control{name: "time_commitment_s", type: "select", required: false}
        %option{selected: time_commitment_s.nil_or_empty?, value: ""}
        -VolunteerEngineerSubmission.commitments.each_pair do |key,label|
          %option{value: key, selected: key == time_commitment_s}= label

  .form-group
    %label.control-label{for: "volunteer-linkedin"} LinkedIn profile
    %div
      %input#volunteer-linkedin.form-control{name: "linkedin_s", placeholder: "http://www.linkedin.com/in/your_name", type: "text", required: false, value: linkedin_s}/
  .form-group
    %label.control-label{for: "volunteer-facebook"} Facebook profile
    %div
      %input#volunteer-facebook.form-control{name: "facebook_s", placeholder: "https://www.facebook.com/your_name", type: "text", required: false, value: facebook_s}/

  .form-group
    %label.control-label{for: "volunteer-description"} Description
    %span.form-required-field *
    %p Describe your computer science experience and how you would like to participate as a volunteer for local teachers.
    %div
      %textarea#volunteer-description.form-control{name: "description_s", placeholder: "Description of experience and/or participation", required: false, style: "height: 10em;"}
        =description_s
  %hr
  %h2 Information kept private and never shared

  .form-group
    %label.control-label{for: "volunteer-email"} Email address
    %span.form-required-field *
    %p Your email address will never be shared, but we'll send you requests from teachers.
    %div
      %input#volunteer-email.form-control{name: "email_s", placeholder: "Email address", type: "text", required: true, value: email_s}/

  %br
  .form-group
    %p You will be listed on a map for local teachers to contact you for the Hour of Code or other volunteer opportunities. Your email and exact address will NEVER be shared by us. But the other information (including approximate location) will be publicly viewable by local teachers.
    %div
      %label{style: 'font-weight: normal;', for: 'volunteer-allow-contact'}
        %input#volunteer-allow-contact{name: 'allow_contact_b', type: 'checkbox', value: 1, required: false, checked: true}
          I agree that teachers can contact me for volunteer opportunities (Note: your email address won't be shared)

  .form-group
    %button#btn-submit.btn.btn-default{type: "submit"} Submit

#thanks{:style=>"display: none;"}
  %p Thank you for submitting your information.

:javascript
  $(document).ready(function() {
    new google.maps.places.SearchBox(document.getElementById('volunteer-location'));

    $('#volunteer-engineer-submit-form select').selectize({
      plugins: ['fast_click']
    });

    $('#volunteer-languages').change(function() {
      if ($.inArray('other', $(this).val()) > -1) {
        $('#volunteer-languages-other-wrapper').show();
      } else {
        $('#volunteer-languages-other').val('');
        $('#volunteer-languages-other-wrapper').hide();
      }
    }).triggerHandler('change');

    $('#volunteer-after-hoc').change(function() {
      if($(this).is(':checked')) {
        $('#volunteer-time-commitment').closest('.form-group').slideDown();
      } else {
        $('#volunteer-time-commitment').closest('.form-group').slideUp();
      }
    });
  });

:javascript
  function processResponse(data)
  {
    $('#volunteer-engineer-submit-form').hide();
    $('#thanks').show();
  }

  function processError(data)
  {
    $('.has-error').removeClass('has-error');

    errors = Object.keys(data.responseJSON);
    errors_count = errors.length;

    for (i = 0; i < errors_count; ++i) {
      error_id = '#volunteer-' + errors[i].replace(/_/g, '-');
      error_id = error_id.replace(/-[sb]s?$/, '');
      $(error_id).parents('.form-group').addClass('has-error');
    }

    $('#error-message').text('An error occurred. Please check to make sure all required fields have been filled out.').show();

    $('body').scrollTop(0);
    $("#btn-submit").removeAttr('disabled');
    $("#btn-submit").removeClass("button_disabled").addClass("button_enabled");
  }

  function volunteerEngineerFormSubmit()
  {
    $("#btn-submit").attr('disabled','disabled');
    $("#btn-submit").removeClass("button_enabled").addClass("button_disabled");

    $.ajax({
      url: "/forms/VolunteerEngineerSubmission#{'/' + form.secret if form}",
      type: "post",
      dataType: "json",
      data: $('#volunteer-engineer-submit-form').serialize()
    }).done(processResponse).fail(processError);

    return false;
  }
